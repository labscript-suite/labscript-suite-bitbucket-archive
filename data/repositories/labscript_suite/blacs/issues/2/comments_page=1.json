{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2/comments/12599378.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/2#comment-12599378"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2.json"}}, "type": "issue", "id": 2, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "\"Address in use\" error when restarting"}, "content": {"raw": "Could you post the PyZMQ version that computer is using?\n\nI've seen a different error (but along similar lines) on PyZMQ v13.1.0 but it only happens occasionally. I suspect it could be to do with PyZMQ and we should perhaps investigate whether the newer version are more stable (having avoided them in the past due to incompatibilities between ZMQ v3 and v4)\n\nAlternatively, the error could just relate to a race condition between spawning the new BLACS process before closing the old one, though given you say it is repeatable and I haven't seen it on two other PCs, this makes me suspect it isn't related to that (though is probably something we should fix at some point!)", "markup": "markdown", "html": "<p>Could you post the PyZMQ version that computer is using?</p>\n<p>I've seen a different error (but along similar lines) on PyZMQ v13.1.0 but it only happens occasionally. I suspect it could be to do with PyZMQ and we should perhaps investigate whether the newer version are more stable (having avoided them in the past due to incompatibilities between ZMQ v3 and v4)</p>\n<p>Alternatively, the error could just relate to a race condition between spawning the new BLACS process before closing the old one, though given you say it is repeatable and I haven't seen it on two other PCs, this makes me suspect it isn't related to that (though is probably something we should fix at some point!)</p>", "type": "rendered"}, "created_on": "2014-09-27T06:10:38.463366+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": null, "type": "issue_comment", "id": 12599378}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2/comments/12642056.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/2#comment-12642056"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2.json"}}, "type": "issue", "id": 2, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "\"Address in use\" error when restarting"}, "content": {"raw": "I think this snippet might be what it comes down to:\n\n```\n#!python\n\nfrom zprocess import ZMQServer\n\nclass  MyServer(ZMQServer):\n    pass\n\nif __name__ == '__main__':\n    server = MyServer(9999)\n    server.shutdown()\n    server = MyServer(9999)\n\n```\n\nCould you test if this raises the same exception for you Martijn? If it does it means there's something wrong with either PyZMQ or my shutting down code. I can see that my shutting down code does have a race condition, which I will fix, and it would be good to see if this fixes your problem.\n\nPhil I also think there is a race condition in BLACS restarting (which would be there even if the shutting down had no race of its own), I know you have a delay in there to mitigate it, but I have moved the line `experiment_server.shutdown()` to within `BLACSWindow.closeEvent`, such that it happens before the `subprocess.Popen()` that launches the new instance of BLACS. Once I fix my own race condition, any remaining issues are more likely to be the library or OS's fault.", "markup": "markdown", "html": "<p>I think this snippet might be what it comes down to:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">zprocess</span> <span class=\"kn\">import</span> <span class=\"n\">ZMQServer</span>\n\n<span class=\"k\">class</span>  <span class=\"nc\">MyServer</span><span class=\"p\">(</span><span class=\"n\">ZMQServer</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;__main__&#39;</span><span class=\"p\">:</span>\n    <span class=\"n\">server</span> <span class=\"o\">=</span> <span class=\"n\">MyServer</span><span class=\"p\">(</span><span class=\"mi\">9999</span><span class=\"p\">)</span>\n    <span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">shutdown</span><span class=\"p\">()</span>\n    <span class=\"n\">server</span> <span class=\"o\">=</span> <span class=\"n\">MyServer</span><span class=\"p\">(</span><span class=\"mi\">9999</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>Could you test if this raises the same exception for you Martijn? If it does it means there's something wrong with either PyZMQ or my shutting down code. I can see that my shutting down code does have a race condition, which I will fix, and it would be good to see if this fixes your problem.</p>\n<p>Phil I also think there is a race condition in BLACS restarting (which would be there even if the shutting down had no race of its own), I know you have a delay in there to mitigate it, but I have moved the line <code>experiment_server.shutdown()</code> to within <code>BLACSWindow.closeEvent</code>, such that it happens before the <code>subprocess.Popen()</code> that launches the new instance of BLACS. Once I fix my own race condition, any remaining issues are more likely to be the library or OS's fault.</p>", "type": "rendered"}, "created_on": "2014-09-30T02:51:49.879783+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 12642056}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2/comments/12642599.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/2#comment-12642599"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2.json"}}, "type": "issue", "id": 2, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "\"Address in use\" error when restarting"}, "content": {"raw": "I have fixed the race condition in zprocess.ZMQServer.shutdown(). The port really, truly, should be free when that method returns. And since BLACS now calls that method before spawning the new copy of itself, the port really ought to be freed when the new instance tries to bind to it.\n\nSo hopefully we have a fix in zprocess 1.1.3 and BLACS revision b0e673fcc916 (latest in 1.1.0-dev branch). Note that this BLACS requires labscript_utils revision 459a1cdf851b or later (latest in 1.1.0-dev branch).\n\nIf these two changes don't fix it, then I blame PyZMQ/ZMQ/Windows.", "markup": "markdown", "html": "<p>I have fixed the race condition in zprocess.ZMQServer.shutdown(). The port really, truly, should be free when that method returns. And since BLACS now calls that method before spawning the new copy of itself, the port really ought to be freed when the new instance tries to bind to it.</p>\n<p>So hopefully we have a fix in zprocess 1.1.3 and BLACS revision <a href=\"#!/labscript_suite/blacs/commits/b0e673fcc916\" rel=\"nofollow\" class=\"ap-connect-link\">b0e673fcc916</a> (latest in 1.1.0-dev branch). Note that this BLACS requires labscript_utils revision <a href=\"#!/labscript_suite/blacs/commits/459a1cdf851b\" rel=\"nofollow\" class=\"ap-connect-link\">459a1cdf851b</a> or later (latest in 1.1.0-dev branch).</p>\n<p>If these two changes don't fix it, then I blame PyZMQ/ZMQ/Windows.</p>", "type": "rendered"}, "created_on": "2014-09-30T03:53:56.333037+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 12642599}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2/comments/55223383.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/2#comment-55223383"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2.json"}}, "type": "issue", "id": 2, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "\"Address in use\" error when restarting"}, "content": {"raw": "These sorts of issues have had lots of attention and I haven't seen the problem in a long time, so closing.", "markup": "markdown", "html": "<p>These sorts of issues have had lots of attention and I haven't seen the problem in a long time, so closing.</p>", "type": "rendered"}, "created_on": "2019-12-12T14:37:54.257367+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 55223383}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2/comments/55223385.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/2#comment-55223385"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/2.json"}}, "type": "issue", "id": 2, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "\"Address in use\" error when restarting"}, "content": {"raw": null, "markup": "markdown", "html": "", "type": "rendered"}, "created_on": "2019-12-12T14:38:01.129633+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 55223385}], "page": 1, "size": 5}