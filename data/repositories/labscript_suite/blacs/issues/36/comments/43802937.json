{"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/36/comments/43802937.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/36#comment-43802937"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/36.json"}}, "type": "issue", "id": 36, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "front panel settings not loaded correctly if blacs is not run as a module"}, "content": {"raw": "This sounds the same as issue #25, though it doesn't have the exact same symptoms so maybe it is subtly different.\n\nCould you check if the problem exists when you run`python C://full/path/to/labscript_suite/blacs/__main__.py`?\n\nThe problem ith #25 is that BLACS does a 'chdir' which invalidates the `__file__` attributes of any of its submodules, because they are relative paths (relative to the directory you started in) and are not updated by the `chdir()` operation. Python considers this a bug that was fixed in Python 3.4\n\nIf we want to fix it in our code, we should not do a chdir, and instead set a global `BLACS_DIR = os.path.dirname(os.path.abspath(__file__)` in `blacs.__init__.py` and have all code that currently uses relative paths to use an absolute path based either on `blacs.BLACS_DIR` or their own `__file__` attribute. The latter is relying on no other code anywhere in the interpreter doing a `os.chdir()` so the first is more reliable. More reliable still would be to `from labscript_utils import labscript_suite_install_dir` and set `BLACS_DIR = os.path.join(labscript_suite_install_dir, 'blacs')`. That way even an `os.chdir()` before `blacs.__init__` runs will not invalidate `BLACS_DIR` since it wont' be based on `__file__`.\n\nI'll have a go at a quick patch - will have to craft a regex to search for all strings in blacs that look like they might be filepaths...", "markup": "markdown", "html": "<p>This sounds the same as issue <a href=\"#!/labscript_suite/blacs/issues/25/error-when-starting-blacs-from-console\" rel=\"nofollow\" title=\"Error when starting BLACS from console\" class=\"ap-connect-link\"><s>#25</s></a>, though it doesn't have the exact same symptoms so maybe it is subtly different.</p>\n<p>Could you check if the problem exists when you run<code>python C://full/path/to/labscript_suite/blacs/__main__.py</code>?</p>\n<p>The problem ith <a href=\"#!/labscript_suite/blacs/issues/25/error-when-starting-blacs-from-console\" rel=\"nofollow\" title=\"Error when starting BLACS from console\" class=\"ap-connect-link\"><s>#25</s></a> is that BLACS does a 'chdir' which invalidates the <code>__file__</code> attributes of any of its submodules, because they are relative paths (relative to the directory you started in) and are not updated by the <code>chdir()</code> operation. Python considers this a bug that was fixed in Python 3.4</p>\n<p>If we want to fix it in our code, we should not do a chdir, and instead set a global <code>BLACS_DIR = os.path.dirname(os.path.abspath(__file__)</code> in <code>blacs.__init__.py</code> and have all code that currently uses relative paths to use an absolute path based either on <code>blacs.BLACS_DIR</code> or their own <code>__file__</code> attribute. The latter is relying on no other code anywhere in the interpreter doing a <code>os.chdir()</code> so the first is more reliable. More reliable still would be to <code>from labscript_utils import labscript_suite_install_dir</code> and set <code>BLACS_DIR = os.path.join(labscript_suite_install_dir, 'blacs')</code>. That way even an <code>os.chdir()</code> before <code>blacs.__init__</code> runs will not invalidate <code>BLACS_DIR</code> since it wont' be based on <code>__file__</code>.</p>\n<p>I'll have a go at a quick patch - will have to craft a regex to search for all strings in blacs that look like they might be filepaths...</p>", "type": "rendered"}, "created_on": "2018-03-08T23:19:38.505340+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2018-03-08T23:20:31.201782+00:00", "type": "issue_comment", "id": 43802937}