{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37/comments/43812246.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/37#comment-43812246"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37.json"}}, "type": "issue", "id": 37, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "Changing unitconversion parameters sets all frontpanel values to 0"}, "content": {"raw": "Our lab is already using the changes of the 'Move connections.py to labscript_utils' pull request if this is causing that behavior then I would move this issue to labscript_utils.", "markup": "markdown", "html": "<p>Our lab is already using the changes of the 'Move connections.py to labscript_utils' pull request if this is causing that behavior then I would move this issue to labscript_utils.</p>", "type": "rendered"}, "created_on": "2018-03-09T11:03:36.289917+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": null, "type": "issue_comment", "id": 43812246}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37/comments/43812628.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/37#comment-43812628"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37.json"}}, "type": "issue", "id": 37, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "Changing unitconversion parameters sets all frontpanel values to 0"}, "content": {"raw": "Firstly, I just want to say that it should not lose **all** values. That is clearly a regression that must have been introduced recently. Only those that have changed should be lost at the very least. I can see how certain ones may be lost (due to the reasons outlined below), but not why all of the values would be lost. So it's possible that there are multiple issues here that we need to untangle.\n\nI suspect a lot of the failures (like this and maybe #36) are due to the somewhat outdated code in [blacs/front_panel_settings.py](#!/labscript_suite/blacs/src/66a107e63fc012badd8b7049b5f26a145eac2d78/front_panel_settings.py?at=default&fileviewer=file-view-default#front_panel_settings.py-46).\n\nIf we look at the comments for the algorithm, it looks like it's only excepting changed to the parent device and connected port when determining whether to restore a value or not. Now, it's possible that the comments are out of date, but it's also possible that we need to more complicated exception code for the other, more recent, columns in the connection table. \n\nFor example:\n\n* a change in unit conversion probably shouldn't result in a reset of the value because the value is stored in base_units and so the actual physical value that is output by the device/channel will not change even if the unit conversion does.\n\n* Changes in shutter open state or inverted digital state probably should result in the default being restored.\n\nWe probably need to look at what other things could invalidate the connection table comparison (what else is stored in the columns that carry dictionaries/JSON?) and come up with some general rules for when to restore or not to restore. \n\nOriginally I planned to prompt for the user to choose what to restore or not to restore when there were conflicts, but that never eventuated. That's probably a bit hard to implement at the moment without significant changes to the BLACS startup algorithm (which probably needs to happen anyway, see #8)", "markup": "markdown", "html": "<p>Firstly, I just want to say that it should not lose <strong>all</strong> values. That is clearly a regression that must have been introduced recently. Only those that have changed should be lost at the very least. I can see how certain ones may be lost (due to the reasons outlined below), but not why all of the values would be lost. So it's possible that there are multiple issues here that we need to untangle.</p>\n<p>I suspect a lot of the failures (like this and maybe <a href=\"#!/labscript_suite/blacs/issues/36/front-panel-settings-not-loaded-correctly\" rel=\"nofollow\" title=\"front panel settings not loaded correctly if blacs is not run as a module\" class=\"ap-connect-link\"><s>#36</s></a>) are due to the somewhat outdated code in <a data-is-external-link=\"true\" href=\"#!/labscript_suite/blacs/src/66a107e63fc012badd8b7049b5f26a145eac2d78/front_panel_settings.py?at=default&amp;fileviewer=file-view-default#front_panel_settings.py-46\" rel=\"nofollow\">blacs/front_panel_settings.py</a>.</p>\n<p>If we look at the comments for the algorithm, it looks like it's only excepting changed to the parent device and connected port when determining whether to restore a value or not. Now, it's possible that the comments are out of date, but it's also possible that we need to more complicated exception code for the other, more recent, columns in the connection table. </p>\n<p>For example:</p>\n<ul>\n<li>\n<p>a change in unit conversion probably shouldn't result in a reset of the value because the value is stored in base_units and so the actual physical value that is output by the device/channel will not change even if the unit conversion does.</p>\n</li>\n<li>\n<p>Changes in shutter open state or inverted digital state probably should result in the default being restored.</p>\n</li>\n</ul>\n<p>We probably need to look at what other things could invalidate the connection table comparison (what else is stored in the columns that carry dictionaries/JSON?) and come up with some general rules for when to restore or not to restore. </p>\n<p>Originally I planned to prompt for the user to choose what to restore or not to restore when there were conflicts, but that never eventuated. That's probably a bit hard to implement at the moment without significant changes to the BLACS startup algorithm (which probably needs to happen anyway, see <a href=\"#!/labscript_suite/blacs/issues/8/compile-and-restart-improvements-making\" rel=\"nofollow\" title=\"&#39;Compile and restart&#39; improvements - making sure it can happen when other things are borked\" class=\"ap-connect-link\"><s>#8</s></a>)</p>", "type": "rendered"}, "created_on": "2018-03-09T11:20:50.640669+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": null, "type": "issue_comment", "id": 43812628}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37/comments/43823895.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/37#comment-43823895"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37.json"}}, "type": "issue", "id": 37, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "Changing unitconversion parameters sets all frontpanel values to 0"}, "content": {"raw": "Ok so I found the problem. It is caused by the changes made during the move of connections.py from blacs to labscript_utils. (So no mainline problem until now)\n\n```Connection.parent``` now is of type unicode and not ```Connection``` resulting in a exception when the connection table missmatch is handled in ```FronPanelSettings.handle_return_code``` which tried to access ```connection.parent.name```.", "markup": "markdown", "html": "<p>Ok so I found the problem. It is caused by the changes made during the move of connections.py from blacs to labscript_utils. (So no mainline problem until now)</p>\n<p><code>Connection.parent</code> now is of type unicode and not <code>Connection</code> resulting in a exception when the connection table missmatch is handled in <code>FronPanelSettings.handle_return_code</code> which tried to access <code>connection.parent.name</code>.</p>", "type": "rendered"}, "created_on": "2018-03-09T22:57:13.410670+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2018-03-09T22:57:37.898558+00:00", "type": "issue_comment", "id": 43823895}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37/comments/43823973.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/37#comment-43823973"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37.json"}}, "type": "issue", "id": 37, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "Changing unitconversion parameters sets all frontpanel values to 0"}, "content": {"raw": "Fantastic, thanks for debugging! That was silly of me, I was meaning to provide full backward compatibility here (other than changing string types), so I . I will fix in labscript_utils.", "markup": "markdown", "html": "<p>Fantastic, thanks for debugging! That was silly of me, I was meaning to provide full backward compatibility here (other than changing string types), so I . I will fix in labscript_utils.</p>", "type": "rendered"}, "created_on": "2018-03-09T23:08:18.072009+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 43823973}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37/comments/43823997.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/37#comment-43823997"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37.json"}}, "type": "issue", "id": 37, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "Changing unitconversion parameters sets all frontpanel values to 0"}, "content": {"raw": "Could you check if [labscript utils pull request #32](#!/labscript_suite/labscript_utils/pull-requests/32/fix-regression-in-connections-causing/diff) fixes the issue?", "markup": "markdown", "html": "<p>Could you check if <a data-is-external-link=\"true\" href=\"#!/labscript_suite/labscript_utils/pull-requests/32/fix-regression-in-connections-causing/diff\" rel=\"nofollow\">labscript utils pull request #32</a> fixes the issue?</p>", "type": "rendered"}, "created_on": "2018-03-09T23:14:24.893678+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 43823997}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37/comments/43824041.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/37#comment-43824041"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/issues/37.json"}}, "type": "issue", "id": 37, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "title": "Changing unitconversion parameters sets all frontpanel values to 0"}, "content": {"raw": "Fixed by [labscript utils pull request #32](#!/labscript_suite/labscript_utils/pull-requests/32/fix-regression-in-connections-causing/diff)", "markup": "markdown", "html": "<p>Fixed by <a data-is-external-link=\"true\" href=\"#!/labscript_suite/labscript_utils/pull-requests/32/fix-regression-in-connections-causing/diff\" rel=\"nofollow\">labscript utils pull request #32</a></p>", "type": "rendered"}, "created_on": "2018-03-09T23:22:35.585196+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 43824041}], "page": 1, "size": 6}