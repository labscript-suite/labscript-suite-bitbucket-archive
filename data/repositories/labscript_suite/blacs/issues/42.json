{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/blacs/issues/42/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/blacs/issues/42.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/issues/42/watch"}, "comments": {"href": "data/repositories/labscript_suite/blacs/issues/42/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/blacs/issues/42/connection-table-recompile-cant-handle"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/issues/42/vote"}}, "reporter": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "title": "Connection table recompile can't handle missing globals file", "component": null, "votes": 0, "watches": 1, "content": {"raw": "There is a exception in BLACS when one of the globals files is missing during recompilation of the connection table. This exception does not make its cause obvious:\r\n\r\n```\r\n#!python\r\n\r\n2018-04-26 10:42:16,874 ERROR BLACS: Got an exception:\r\nTraceback (most recent call last):\r\n  File \"/Users/janwerkmann/labscript_suite/blacs/plugins/connection_table/__init__.py\", line 188, in on_recompile_connection_table\r\n    self.BLACS['plugins'][module].menu.on_recompile_connection_table()\r\n  File \"/Users/janwerkmann/labscript_suite/blacs/plugins/connection_table/__init__.py\", line 130, in on_recompile_connection_table\r\n    CompileAndRestart(self.BLACS, globals_files, self.BLACS['exp_config'].get('paths','connection_table_py'), self.BLACS['exp_config'].get('paths','connection_table_h5'),close_notification_func=self.close_notification_func)\r\n  File \"/Users/janwerkmann/labscript_suite/blacs/compile_and_restart.py\", line 54, in __init__\r\n    self.compile()\r\n  File \"/Users/janwerkmann/labscript_suite/blacs/compile_and_restart.py\", line 76, in compile\r\n    self.globals_files, self.tempfilename, self.output_box.port, self.finished_compiling)\r\n  File \"/Users/janwerkmann/labscript_suite/runmanager/__init__.py\", line 748, in compile_labscript_with_globals_files_async\r\n    zprocess.zmq_push_multipart(stream_port, data=['stderr', error])\r\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/zprocess/clientserver.py\", line 259, in __call__\r\n    data = _typecheck_or_convert_data(data, self.dtype)\r\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/zprocess/clientserver.py\", line 75, in _typecheck_or_convert_data\r\n    raise TypeError(msg)\r\nTypeError: multipart sockets can only send an iterable of bytes objects, not <type 'list'>.\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/janwerkmann/labscript_suite/blacs/plugins/connection_table/__init__.py\", line 188, in on_recompile_connection_table\r\n    self.BLACS['plugins'][module].menu.on_recompile_connection_table()\r\n  File \"/Users/janwerkmann/labscript_suite/blacs/plugins/connection_table/__init__.py\", line 130, in on_recompile_connection_table\r\n    CompileAndRestart(self.BLACS, globals_files, self.BLACS['exp_config'].get('paths','connection_table_py'), self.BLACS['exp_config'].get('paths','connection_table_h5'),close_notification_func=self.close_notification_func)\r\n  File \"/Users/janwerkmann/labscript_suite/blacs/compile_and_restart.py\", line 54, in __init__\r\n    self.compile()\r\n  File \"/Users/janwerkmann/labscript_suite/blacs/compile_and_restart.py\", line 76, in compile\r\n    self.globals_files, self.tempfilename, self.output_box.port, self.finished_compiling)\r\n  File \"/Users/janwerkmann/labscript_suite/runmanager/__init__.py\", line 748, in compile_labscript_with_globals_files_async\r\n    zprocess.zmq_push_multipart(stream_port, data=['stderr', error])\r\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/zprocess/clientserver.py\", line 259, in __call__\r\n    data = _typecheck_or_convert_data(data, self.dtype)\r\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/zprocess/clientserver.py\", line 75, in _typecheck_or_convert_data\r\n    raise TypeError(msg)\r\nTypeError: multipart sockets can only send an iterable of bytes objects, not <type 'list'>.\r\n```", "markup": "markdown", "html": "<p>There is a exception in BLACS when one of the globals files is missing during recompilation of the connection table. This exception does not make its cause obvious:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"mi\">2018</span><span class=\"o\">-</span><span class=\"mo\">04</span><span class=\"o\">-</span><span class=\"mi\">26</span> <span class=\"mi\">10</span><span class=\"p\">:</span><span class=\"mi\">42</span><span class=\"p\">:</span><span class=\"mi\">16</span><span class=\"p\">,</span><span class=\"mi\">874</span> <span class=\"n\">ERROR</span> <span class=\"n\">BLACS</span><span class=\"p\">:</span> <span class=\"n\">Got</span> <span class=\"n\">an</span> <span class=\"n\">exception</span><span class=\"p\">:</span>\n<span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/blacs/plugins/connection_table/__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">188</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">on_recompile_connection_table</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">BLACS</span><span class=\"p\">[</span><span class=\"s1\">&#39;plugins&#39;</span><span class=\"p\">][</span><span class=\"n\">module</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">menu</span><span class=\"o\">.</span><span class=\"n\">on_recompile_connection_table</span><span class=\"p\">()</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/blacs/plugins/connection_table/__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">130</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">on_recompile_connection_table</span>\n    <span class=\"n\">CompileAndRestart</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">BLACS</span><span class=\"p\">,</span> <span class=\"n\">globals_files</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">BLACS</span><span class=\"p\">[</span><span class=\"s1\">&#39;exp_config&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;paths&#39;</span><span class=\"p\">,</span><span class=\"s1\">&#39;connection_table_py&#39;</span><span class=\"p\">),</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">BLACS</span><span class=\"p\">[</span><span class=\"s1\">&#39;exp_config&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;paths&#39;</span><span class=\"p\">,</span><span class=\"s1\">&#39;connection_table_h5&#39;</span><span class=\"p\">),</span><span class=\"n\">close_notification_func</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">close_notification_func</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/blacs/compile_and_restart.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">54</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__init__</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">compile</span><span class=\"p\">()</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/blacs/compile_and_restart.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">76</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"nb\">compile</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">globals_files</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">tempfilename</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">output_box</span><span class=\"o\">.</span><span class=\"n\">port</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">finished_compiling</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/runmanager/__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">748</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">compile_labscript_with_globals_files_async</span>\n    <span class=\"n\">zprocess</span><span class=\"o\">.</span><span class=\"n\">zmq_push_multipart</span><span class=\"p\">(</span><span class=\"n\">stream_port</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;stderr&#39;</span><span class=\"p\">,</span> <span class=\"n\">error</span><span class=\"p\">])</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/zprocess/clientserver.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">259</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__call__</span>\n    <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">_typecheck_or_convert_data</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">dtype</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/zprocess/clientserver.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">75</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_typecheck_or_convert_data</span>\n    <span class=\"k\">raise</span> <span class=\"ne\">TypeError</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">)</span>\n<span class=\"ne\">TypeError</span><span class=\"p\">:</span> <span class=\"n\">multipart</span> <span class=\"n\">sockets</span> <span class=\"n\">can</span> <span class=\"n\">only</span> <span class=\"n\">send</span> <span class=\"n\">an</span> <span class=\"n\">iterable</span> <span class=\"n\">of</span> <span class=\"nb\">bytes</span> <span class=\"n\">objects</span><span class=\"p\">,</span> <span class=\"ow\">not</span> <span class=\"o\">&lt;</span><span class=\"nb\">type</span> <span class=\"s1\">&#39;list&#39;</span><span class=\"o\">&gt;.</span>\n\n<span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/blacs/plugins/connection_table/__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">188</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">on_recompile_connection_table</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">BLACS</span><span class=\"p\">[</span><span class=\"s1\">&#39;plugins&#39;</span><span class=\"p\">][</span><span class=\"n\">module</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">menu</span><span class=\"o\">.</span><span class=\"n\">on_recompile_connection_table</span><span class=\"p\">()</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/blacs/plugins/connection_table/__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">130</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">on_recompile_connection_table</span>\n    <span class=\"n\">CompileAndRestart</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">BLACS</span><span class=\"p\">,</span> <span class=\"n\">globals_files</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">BLACS</span><span class=\"p\">[</span><span class=\"s1\">&#39;exp_config&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;paths&#39;</span><span class=\"p\">,</span><span class=\"s1\">&#39;connection_table_py&#39;</span><span class=\"p\">),</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">BLACS</span><span class=\"p\">[</span><span class=\"s1\">&#39;exp_config&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;paths&#39;</span><span class=\"p\">,</span><span class=\"s1\">&#39;connection_table_h5&#39;</span><span class=\"p\">),</span><span class=\"n\">close_notification_func</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">close_notification_func</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/blacs/compile_and_restart.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">54</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__init__</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">compile</span><span class=\"p\">()</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/blacs/compile_and_restart.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">76</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"nb\">compile</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">globals_files</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">tempfilename</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">output_box</span><span class=\"o\">.</span><span class=\"n\">port</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">finished_compiling</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/runmanager/__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">748</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">compile_labscript_with_globals_files_async</span>\n    <span class=\"n\">zprocess</span><span class=\"o\">.</span><span class=\"n\">zmq_push_multipart</span><span class=\"p\">(</span><span class=\"n\">stream_port</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;stderr&#39;</span><span class=\"p\">,</span> <span class=\"n\">error</span><span class=\"p\">])</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/zprocess/clientserver.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">259</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__call__</span>\n    <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">_typecheck_or_convert_data</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">dtype</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/zprocess/clientserver.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">75</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_typecheck_or_convert_data</span>\n    <span class=\"k\">raise</span> <span class=\"ne\">TypeError</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">)</span>\n<span class=\"ne\">TypeError</span><span class=\"p\">:</span> <span class=\"n\">multipart</span> <span class=\"n\">sockets</span> <span class=\"n\">can</span> <span class=\"n\">only</span> <span class=\"n\">send</span> <span class=\"n\">an</span> <span class=\"n\">iterable</span> <span class=\"n\">of</span> <span class=\"nb\">bytes</span> <span class=\"n\">objects</span><span class=\"p\">,</span> <span class=\"ow\">not</span> <span class=\"o\">&lt;</span><span class=\"nb\">type</span> <span class=\"s1\">&#39;list&#39;</span><span class=\"o\">&gt;.</span>\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2018-04-26T08:46:12.322114+00:00", "milestone": null, "updated_on": "2018-04-26T23:25:36.275194+00:00", "type": "issue", "id": 42}