{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/54575934.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-54575934"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12"}}, "title": "Inverted DO"}, "content": {"raw": "So I've had a think about how this fits in with future planned development \\(specifically around \"virtual devices\" which pull channels from multiple devices into a new collection on a new tab\\).\n\nI think that the following will fit better with that planned development:\n\n* The `DO` class shouldn't be passed the `inverted` value from the connection table at instantiation of the `DO` object. Instead, `inverted` should be read from the connection table in `DeviceTab.create_digital_widgets` and passed to `DO.create_widget`, so that the correct widget class can be instantiated. \n* Similarly, `DO.add_widget`should take `inverted` as a optional kwarg \\(and `DO.create_widget` should pass this in to `add_widget`\\).\n* In `DO.add_widget`, the line `widget.toggled.connect(self.set_value)` should become `widget.toggled.connect(self.set_value if not inverted else lambda state: self.set_value(not state))`\n* The additional code from `DO.set_value` is then removed \\(as is the code from `DO.__init__`\\)\n\nThis moves the inversion logic to the connection of a widget, thus allowing both inverted and non-inverted widgets to be connected to one DO object. This means virtual devices can be created with controls for either behaviour, regardless of the state of the `inverted` parameter in the connection table \\(the default presented when constructing virtual devices would be the state of the `inverted` parameter, but the user would have the option to ignore it\\)", "markup": "markdown", "html": "<p>So I've had a think about how this fits in with future planned development (specifically around \"virtual devices\" which pull channels from multiple devices into a new collection on a new tab).</p>\n<p>I think that the following will fit better with that planned development:</p>\n<ul>\n<li>The <code>DO</code> class shouldn't be passed the <code>inverted</code> value from the connection table at instantiation of the <code>DO</code> object. Instead, <code>inverted</code> should be read from the connection table in <code>DeviceTab.create_digital_widgets</code> and passed to <code>DO.create_widget</code>, so that the correct widget class can be instantiated. </li>\n<li>Similarly, <code>DO.add_widget</code>should take <code>inverted</code> as a optional kwarg (and <code>DO.create_widget</code> should pass this in to <code>add_widget</code>).</li>\n<li>In <code>DO.add_widget</code>, the line <code>widget.toggled.connect(self.set_value)</code> should become <code>widget.toggled.connect(self.set_value if not inverted else lambda state: self.set_value(not state))</code></li>\n<li>The additional code from <code>DO.set_value</code> is then removed (as is the code from <code>DO.__init__</code>)</li>\n</ul>\n<p>This moves the inversion logic to the connection of a widget, thus allowing both inverted and non-inverted widgets to be connected to one DO object. This means virtual devices can be created with controls for either behaviour, regardless of the state of the <code>inverted</code> parameter in the connection table (the default presented when constructing virtual devices would be the state of the <code>inverted</code> parameter, but the user would have the option to ignore it)</p>", "type": "rendered"}, "created_on": "2018-01-25T05:33:56.652283+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2018-01-25T05:33:56.654753+00:00", "type": "pullrequest_comment", "id": 54575934}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/54619426.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-54619426"}}, "parent": {"id": 54575934, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/54575934.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-54575934"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12"}}, "title": "Inverted DO"}, "content": {"raw": "Thanks for the comprehensive review! I applied the changes as they make a lot of sense to me. I also tested that everything still works.", "markup": "markdown", "html": "<p>Thanks for the comprehensive review! I applied the changes as they make a lot of sense to me. I also tested that everything still works.</p>", "type": "rendered"}, "created_on": "2018-01-25T13:28:07.503707+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2018-01-25T13:28:07.547856+00:00", "type": "pullrequest_comment", "id": 54619426}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57612097.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57612097"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12"}}, "title": "Inverted DO"}, "content": {"raw": "It looks like the most recent change to device\\_base\\_class.py is in the wrong place. The new code as shown in the diff appears to be in `create_dds_widgets()` rather than `create_digital_widgets()`? I can't see how this would work at all, which makes me wonder if you accidentally tested on another version of the code?\n\nOn the topic of that bit of code, it looks like we overwrite any existing setting for `inverted` as specified by the `channel_properties`. I think this should be instead `properties['kwargs']['inverted'] = bool(device.properties.get('inverted', False)) if device else properties['kwargs'].get('inverted', False)`. \n\nThis way:\n\n* the connection table supersedes the hard-coded channel properties in the device Python file if the channel exists in the connection table and defaults to False if the inverted flag does not exist in the connection table\n* If the channel is not in use in the connection table, then the developer of the device Python file can specify the inverted behaviour as the default if they want \\(requires they don't use `auto_create_widgets` but they've always had that option\\). The default behaviour if it isn't explicitly specified is again to not be inverted.\n\n", "markup": "markdown", "html": "<p>It looks like the most recent change to device_base_class.py is in the wrong place. The new code as shown in the diff appears to be in <code>create_dds_widgets()</code> rather than <code>create_digital_widgets()</code>? I can't see how this would work at all, which makes me wonder if you accidentally tested on another version of the code?</p>\n<p>On the topic of that bit of code, it looks like we overwrite any existing setting for <code>inverted</code> as specified by the <code>channel_properties</code>. I think this should be instead <code>properties['kwargs']['inverted'] = bool(device.properties.get('inverted', False)) if device else properties['kwargs'].get('inverted', False)</code>. </p>\n<p>This way:</p>\n<ul>\n<li>the connection table supersedes the hard-coded channel properties in the device Python file if the channel exists in the connection table and defaults to False if the inverted flag does not exist in the connection table</li>\n<li>If the channel is not in use in the connection table, then the developer of the device Python file can specify the inverted behaviour as the default if they want (requires they don't use <code>auto_create_widgets</code> but they've always had that option). The default behaviour if it isn't explicitly specified is again to not be inverted.</li>\n</ul>", "type": "rendered"}, "created_on": "2018-02-28T22:52:25.819109+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2018-02-28T22:52:25.824777+00:00", "type": "pullrequest_comment", "id": 57612097}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57629815.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57629815"}}, "parent": {"id": 57612097, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57612097.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57612097"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12"}}, "title": "Inverted DO"}, "content": {"raw": "Oh you are right.\n\nMust have been a copy paste error. My testing happens on our labs fork where I edit in the changes by hand\\(in the right place\\). So I actually did test this just then copied the changes in in the wrong place here.\n\nI'll fix it and do the changes to the reading of the inverted property.", "markup": "markdown", "html": "<p>Oh you are right.</p>\n<p>Must have been a copy paste error. My testing happens on our labs fork where I edit in the changes by hand(in the right place). So I actually did test this just then copied the changes in in the wrong place here.</p>\n<p>I'll fix it and do the changes to the reading of the inverted property.</p>", "type": "rendered"}, "created_on": "2018-03-01T05:37:20.532383+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2018-03-01T05:37:20.587125+00:00", "type": "pullrequest_comment", "id": 57629815}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57836467.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57836467"}}, "parent": {"id": 57612097, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57612097.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57612097"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12"}}, "title": "Inverted DO"}, "content": {"raw": "Looks like this has been addressed, are you happy to merge?\n\n(by the way bitbucket still hasn't fixed the branch closing thing, so I've been doing all the merges locally with a [script](https://bitbucket.org/site/master/issues/14116/mercurial-cross-fork-pullrequests-dont#comment-43649859))", "markup": "markdown", "html": "<p>Looks like this has been addressed, are you happy to merge?</p>\n<p>(by the way bitbucket still hasn't fixed the branch closing thing, so I've been doing all the merges locally with a <a data-is-external-link=\"true\" href=\"https://bitbucket.org/site/master/issues/14116/mercurial-cross-fork-pullrequests-dont#comment-43649859\" rel=\"nofollow\">script</a>)</p>", "type": "rendered"}, "created_on": "2018-03-03T11:45:21.053196+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2018-03-03T11:45:21.056462+00:00", "type": "pullrequest_comment", "id": 57836467}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57836529.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57836529"}}, "parent": {"id": 57836467, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57836467.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57836467"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12"}}, "title": "Inverted DO"}, "content": {"raw": "I'm happy to merge if you can pull and test first to make sure there aren't any uncaught bugs \\(the copy/paste bug has made me nervous!\\)", "markup": "markdown", "html": "<p>I'm happy to merge if you can pull and test first to make sure there aren't any uncaught bugs (the copy/paste bug has made me nervous!)</p>", "type": "rendered"}, "created_on": "2018-03-03T11:52:04.898982+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2018-03-03T11:52:04.902127+00:00", "type": "pullrequest_comment", "id": 57836529}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57837209.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57837209"}}, "parent": {"id": 57836529, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57836529.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57836529"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12"}}, "title": "Inverted DO"}, "content": {"raw": "Done. There was a missing colour in the stylesheet (when locked the buttons turned green). I tweaked the colours to be a little more consistent too.", "markup": "markdown", "html": "<p>Done. There was a missing colour in the stylesheet (when locked the buttons turned green). I tweaked the colours to be a little more consistent too.</p>", "type": "rendered"}, "created_on": "2018-03-03T13:07:45.526446+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2018-03-03T13:07:45.529691+00:00", "type": "pullrequest_comment", "id": 57837209}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57614179.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57614179"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12"}}, "title": "Inverted DO"}, "content": {"raw": "This PR should now have BLACS depend on labscript_utils 2.6", "markup": "markdown", "html": "<p>This PR should now have BLACS depend on labscript_utils 2.6</p>", "type": "rendered"}, "created_on": "2018-02-28T23:21:17.741393+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2018-02-28T23:21:17.744199+00:00", "type": "pullrequest_comment", "id": 57614179}, {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57630182.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57630182"}}, "parent": {"id": 57614179, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12/comments/57614179.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12/_/diff#comment-57614179"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/12"}}, "title": "Inverted DO"}, "content": {"raw": "done.", "markup": "markdown", "html": "<p>done.</p>", "type": "rendered"}, "created_on": "2018-03-01T05:45:56.916101+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2018-03-01T05:45:56.955181+00:00", "type": "pullrequest_comment", "id": 57630182}], "page": 1, "size": 9}