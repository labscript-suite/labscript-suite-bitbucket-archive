{"rendered": {"reason": {"raw": "Will be superseded", "markup": "markdown", "html": "<p>Will be superseded</p>", "type": "rendered"}, "description": {"raw": "Deserialise transition_to_manual of devices at the end of a shot.\r\n\r\nThis fixes the bug where a device blocking until the waits monitor has finished processing waits may deadlock because the two are not actually happening in parallel. This has limited experiments to only using a single analog input device.\r\n\r\nIt also provides a potential speedup for all experiments.\r\n\r\nI am not 100% happy with the cleanness of this code, but it is in line with how the parallelised transition_to_buffered works. I want to resist refactoring the queue manager's main loop into separate functions (I think this would make it much clearer what the responsibilities of each segment are), because this issue is a problem in a lab using the Spielman fork so I want to keep it easily mergable with a version of BLACS that diverged some time ago, which refactoring would make difficult. So I'd like to revisit this at some point, but this PR solves the immediate issue.\r\n\r\nI've done basic testing but more would be prudent.", "markup": "markdown", "html": "<p>Deserialise transition_to_manual of devices at the end of a shot.</p>\n<p>This fixes the bug where a device blocking until the waits monitor has finished processing waits may deadlock because the two are not actually happening in parallel. This has limited experiments to only using a single analog input device.</p>\n<p>It also provides a potential speedup for all experiments.</p>\n<p>I am not 100% happy with the cleanness of this code, but it is in line with how the parallelised transition_to_buffered works. I want to resist refactoring the queue manager's main loop into separate functions (I think this would make it much clearer what the responsibilities of each segment are), because this issue is a problem in a lab using the Spielman fork so I want to keep it easily mergable with a version of BLACS that diverged some time ago, which refactoring would make difficult. So I'd like to revisit this at some point, but this PR solves the immediate issue.</p>\n<p>I've done basic testing but more would be prudent.</p>", "type": "rendered"}, "title": {"raw": "Deserialise transition_to_manual", "markup": "markdown", "html": "<p>Deserialise transition_to_manual</p>", "type": "rendered"}}, "type": "pullrequest", "description": "Deserialise transition_to_manual of devices at the end of a shot.\r\n\r\nThis fixes the bug where a device blocking until the waits monitor has finished processing waits may deadlock because the two are not actually happening in parallel. This has limited experiments to only using a single analog input device.\r\n\r\nIt also provides a potential speedup for all experiments.\r\n\r\nI am not 100% happy with the cleanness of this code, but it is in line with how the parallelised transition_to_buffered works. I want to resist refactoring the queue manager's main loop into separate functions (I think this would make it much clearer what the responsibilities of each segment are), because this issue is a problem in a lab using the Spielman fork so I want to keep it easily mergable with a version of BLACS that diverged some time ago, which refactoring would make difficult. So I'd like to revisit this at some point, but this PR solves the immediate issue.\r\n\r\nI've done basic testing but more would be prudent.", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/pullrequests/47/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/diffstat/None?from_pullrequest_id=47"}, "commits": {"href": "data/repositories/labscript_suite/blacs/pullrequests/47/commits.json"}, "self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/47.json"}, "comments": {"href": "data/repositories/labscript_suite/blacs/pullrequests/47/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/pullrequests/47/merge"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/47"}, "activity": {"href": "data/repositories/labscript_suite/blacs/pullrequests/47/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/diff/None?from_pullrequest_id=47"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/pullrequests/47/approve"}, "statuses": {"href": "data/repositories/labscript_suite/blacs/pullrequests/47/statuses_page=1.json"}}, "title": "Deserialise transition_to_manual", "close_source_branch": false, "reviewers": [{"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, {"display_name": "Shaun Johnstone", "uuid": "{652df738-313d-472c-b7b5-a3f8f98a3322}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D"}, "html": {"href": "https://bitbucket.org/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/38984f1761fc67ce892911496abee619d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSJ-3.png"}}, "nickname": "shjohnst", "type": "user", "account_id": "557058:1b9a15fb-8e4f-407e-b7b9-567c5e1fa1b4"}, {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}], "id": 47, "destination": {"commit": {"hash": "5cde3d142ed8", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/5cde3d142ed8.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/5cde3d142ed8"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "created_on": "2018-07-25T18:33:27.978385+00:00", "summary": {"raw": "Deserialise transition_to_manual of devices at the end of a shot.\r\n\r\nThis fixes the bug where a device blocking until the waits monitor has finished processing waits may deadlock because the two are not actually happening in parallel. This has limited experiments to only using a single analog input device.\r\n\r\nIt also provides a potential speedup for all experiments.\r\n\r\nI am not 100% happy with the cleanness of this code, but it is in line with how the parallelised transition_to_buffered works. I want to resist refactoring the queue manager's main loop into separate functions (I think this would make it much clearer what the responsibilities of each segment are), because this issue is a problem in a lab using the Spielman fork so I want to keep it easily mergable with a version of BLACS that diverged some time ago, which refactoring would make difficult. So I'd like to revisit this at some point, but this PR solves the immediate issue.\r\n\r\nI've done basic testing but more would be prudent.", "markup": "markdown", "html": "<p>Deserialise transition_to_manual of devices at the end of a shot.</p>\n<p>This fixes the bug where a device blocking until the waits monitor has finished processing waits may deadlock because the two are not actually happening in parallel. This has limited experiments to only using a single analog input device.</p>\n<p>It also provides a potential speedup for all experiments.</p>\n<p>I am not 100% happy with the cleanness of this code, but it is in line with how the parallelised transition_to_buffered works. I want to resist refactoring the queue manager's main loop into separate functions (I think this would make it much clearer what the responsibilities of each segment are), because this issue is a problem in a lab using the Spielman fork so I want to keep it easily mergable with a version of BLACS that diverged some time ago, which refactoring would make difficult. So I'd like to revisit this at some point, but this PR solves the immediate issue.</p>\n<p>I've done basic testing but more would be prudent.</p>", "type": "rendered"}, "source": {"commit": {"hash": "d20c431b6429", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/d20c431b6429"}, "html": {"href": "#!/cbillington/blacs/commits/d20c431b6429"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "deserialise_transition_to_manual"}}, "comment_count": 10, "state": "DECLINED", "task_count": 0, "participants": [{"role": "PARTICIPANT", "participated_on": "2019-05-16T16:41:35.617895+00:00", "type": "participant", "approved": false, "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}, {"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Shaun Johnstone", "uuid": "{652df738-313d-472c-b7b5-a3f8f98a3322}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D"}, "html": {"href": "https://bitbucket.org/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/38984f1761fc67ce892911496abee619d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSJ-3.png"}}, "nickname": "shjohnst", "type": "user", "account_id": "557058:1b9a15fb-8e4f-407e-b7b9-567c5e1fa1b4"}}, {"role": "REVIEWER", "participated_on": "2018-07-31T00:11:23.860742+00:00", "type": "participant", "approved": false, "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}}, {"role": "REVIEWER", "participated_on": "2018-07-31T20:08:25.627672+00:00", "type": "participant", "approved": true, "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}}], "reason": "Will be superseded", "updated_on": "2019-05-16T16:41:44.634100+00:00", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "merge_commit": null, "closed_by": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}