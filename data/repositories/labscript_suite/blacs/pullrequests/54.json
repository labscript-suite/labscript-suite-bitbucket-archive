{"rendered": {"description": {"raw": "Add functionality for passing in import paths to worker classes instead of the worker classes themselves, so that the parent process can avoid running unnecessary imports.\r\n\r\nThis is a step in refactoring labscript_devices to allow more flexible code structuring, such as having worker classes in separate files. If in separate files that are not imported until the worker process actually starts, then we can avoid having to put all the worker imports in its `init()` method in `exec()` calls, which is ugly, whilst avoiding having to import device-specific libraries that might not exist on the computer running labscript, and once we have remote devices, might not even exist on the computer running BLACS.\r\n\r\nThis change allows BLACS tabs to change the way they define workers in the following way: \r\n\r\n```diff\r\n+++ b/DummyPseudoclock.py\tThu Sep 27 09:55:08 2018 -0400\r\n@@ -52,7 +52,11 @@\r\n class DummyPseudoclockTab(DeviceTab):\r\n     def initialise_workers(self):\r\n         worker_initialisation_kwargs = {}\r\n-        self.create_worker(\"main_worker\", DummyPseudoclockWorker, worker_initialisation_kwargs)\r\n+        self.create_worker(\r\n+            \"main_worker\",\r\n+            \"labscript_devices.DummyPseudoclock.DummyPseudoclockWorker\",\r\n+            worker_initialisation_kwargs,\r\n+        )\r\n         self.primary_worker = \"main_worker\"\r\n \r\n     @define_state(MODE_BUFFERED, True)\r\n```\r\n\r\nAn absolute import path to the worker class is required.", "markup": "markdown", "html": "<p>Add functionality for passing in import paths to worker classes instead of the worker classes themselves, so that the parent process can avoid running unnecessary imports.</p>\n<p>This is a step in refactoring labscript_devices to allow more flexible code structuring, such as having worker classes in separate files. If in separate files that are not imported until the worker process actually starts, then we can avoid having to put all the worker imports in its <code>init()</code> method in <code>exec()</code> calls, which is ugly, whilst avoiding having to import device-specific libraries that might not exist on the computer running labscript, and once we have remote devices, might not even exist on the computer running BLACS.</p>\n<p>This change allows BLACS tabs to change the way they define workers in the following way: </p>\n<div class=\"codehilite language-diff\"><pre><span></span><span class=\"gi\">+++ b/DummyPseudoclock.py   Thu Sep 27 09:55:08 2018 -0400</span>\n<span class=\"gu\">@@ -52,7 +52,11 @@</span>\n class DummyPseudoclockTab(DeviceTab):\n     def initialise_workers(self):\n         worker_initialisation_kwargs = {}\n<span class=\"gd\">-        self.create_worker(&quot;main_worker&quot;, DummyPseudoclockWorker, worker_initialisation_kwargs)</span>\n<span class=\"gi\">+        self.create_worker(</span>\n<span class=\"gi\">+            &quot;main_worker&quot;,</span>\n<span class=\"gi\">+            &quot;labscript_devices.DummyPseudoclock.DummyPseudoclockWorker&quot;,</span>\n<span class=\"gi\">+            worker_initialisation_kwargs,</span>\n<span class=\"gi\">+        )</span>\n         self.primary_worker = &quot;main_worker&quot;\n\n     @define_state(MODE_BUFFERED, True)\n</pre></div>\n\n\n<p>An absolute import path to the worker class is required.</p>", "type": "rendered"}, "title": {"raw": "Defer worker imports", "markup": "markdown", "html": "<p>Defer worker imports</p>", "type": "rendered"}}, "type": "pullrequest", "description": "Add functionality for passing in import paths to worker classes instead of the worker classes themselves, so that the parent process can avoid running unnecessary imports.\r\n\r\nThis is a step in refactoring labscript_devices to allow more flexible code structuring, such as having worker classes in separate files. If in separate files that are not imported until the worker process actually starts, then we can avoid having to put all the worker imports in its `init()` method in `exec()` calls, which is ugly, whilst avoiding having to import device-specific libraries that might not exist on the computer running labscript, and once we have remote devices, might not even exist on the computer running BLACS.\r\n\r\nThis change allows BLACS tabs to change the way they define workers in the following way: \r\n\r\n```diff\r\n+++ b/DummyPseudoclock.py\tThu Sep 27 09:55:08 2018 -0400\r\n@@ -52,7 +52,11 @@\r\n class DummyPseudoclockTab(DeviceTab):\r\n     def initialise_workers(self):\r\n         worker_initialisation_kwargs = {}\r\n-        self.create_worker(\"main_worker\", DummyPseudoclockWorker, worker_initialisation_kwargs)\r\n+        self.create_worker(\r\n+            \"main_worker\",\r\n+            \"labscript_devices.DummyPseudoclock.DummyPseudoclockWorker\",\r\n+            worker_initialisation_kwargs,\r\n+        )\r\n         self.primary_worker = \"main_worker\"\r\n \r\n     @define_state(MODE_BUFFERED, True)\r\n```\r\n\r\nAn absolute import path to the worker class is required.", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/pullrequests/54/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/diffstat/labscript_suite/blacs:db36a0fa2bfb%0Db41afcffa5e8?from_pullrequest_id=54"}, "commits": {"href": "data/repositories/labscript_suite/blacs/pullrequests/54/commits.json"}, "self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/54.json"}, "comments": {"href": "data/repositories/labscript_suite/blacs/pullrequests/54/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/pullrequests/54/merge"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/54"}, "activity": {"href": "data/repositories/labscript_suite/blacs/pullrequests/54/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/diff/labscript_suite/blacs:db36a0fa2bfb%0Db41afcffa5e8?from_pullrequest_id=54"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/blacs/pullrequests/54/approve"}, "statuses": {"href": "data/repositories/labscript_suite/blacs/pullrequests/54/statuses_page=1.json"}}, "title": "Defer worker imports", "close_source_branch": true, "reviewers": [{"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}], "id": 54, "destination": {"commit": {"hash": "b41afcffa5e8", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/b41afcffa5e8.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/b41afcffa5e8"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "created_on": "2018-09-27T13:57:16.428072+00:00", "summary": {"raw": "Add functionality for passing in import paths to worker classes instead of the worker classes themselves, so that the parent process can avoid running unnecessary imports.\r\n\r\nThis is a step in refactoring labscript_devices to allow more flexible code structuring, such as having worker classes in separate files. If in separate files that are not imported until the worker process actually starts, then we can avoid having to put all the worker imports in its `init()` method in `exec()` calls, which is ugly, whilst avoiding having to import device-specific libraries that might not exist on the computer running labscript, and once we have remote devices, might not even exist on the computer running BLACS.\r\n\r\nThis change allows BLACS tabs to change the way they define workers in the following way: \r\n\r\n```diff\r\n+++ b/DummyPseudoclock.py\tThu Sep 27 09:55:08 2018 -0400\r\n@@ -52,7 +52,11 @@\r\n class DummyPseudoclockTab(DeviceTab):\r\n     def initialise_workers(self):\r\n         worker_initialisation_kwargs = {}\r\n-        self.create_worker(\"main_worker\", DummyPseudoclockWorker, worker_initialisation_kwargs)\r\n+        self.create_worker(\r\n+            \"main_worker\",\r\n+            \"labscript_devices.DummyPseudoclock.DummyPseudoclockWorker\",\r\n+            worker_initialisation_kwargs,\r\n+        )\r\n         self.primary_worker = \"main_worker\"\r\n \r\n     @define_state(MODE_BUFFERED, True)\r\n```\r\n\r\nAn absolute import path to the worker class is required.", "markup": "markdown", "html": "<p>Add functionality for passing in import paths to worker classes instead of the worker classes themselves, so that the parent process can avoid running unnecessary imports.</p>\n<p>This is a step in refactoring labscript_devices to allow more flexible code structuring, such as having worker classes in separate files. If in separate files that are not imported until the worker process actually starts, then we can avoid having to put all the worker imports in its <code>init()</code> method in <code>exec()</code> calls, which is ugly, whilst avoiding having to import device-specific libraries that might not exist on the computer running labscript, and once we have remote devices, might not even exist on the computer running BLACS.</p>\n<p>This change allows BLACS tabs to change the way they define workers in the following way: </p>\n<div class=\"codehilite language-diff\"><pre><span></span><span class=\"gi\">+++ b/DummyPseudoclock.py   Thu Sep 27 09:55:08 2018 -0400</span>\n<span class=\"gu\">@@ -52,7 +52,11 @@</span>\n class DummyPseudoclockTab(DeviceTab):\n     def initialise_workers(self):\n         worker_initialisation_kwargs = {}\n<span class=\"gd\">-        self.create_worker(&quot;main_worker&quot;, DummyPseudoclockWorker, worker_initialisation_kwargs)</span>\n<span class=\"gi\">+        self.create_worker(</span>\n<span class=\"gi\">+            &quot;main_worker&quot;,</span>\n<span class=\"gi\">+            &quot;labscript_devices.DummyPseudoclock.DummyPseudoclockWorker&quot;,</span>\n<span class=\"gi\">+            worker_initialisation_kwargs,</span>\n<span class=\"gi\">+        )</span>\n         self.primary_worker = &quot;main_worker&quot;\n\n     @define_state(MODE_BUFFERED, True)\n</pre></div>\n\n\n<p>An absolute import path to the worker class is required.</p>", "type": "rendered"}, "source": {"commit": {"hash": "076c719f8715", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/076c719f8715"}, "html": {"href": "#!/cbillington/blacs/commits/076c719f8715"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "defer_worker_imports"}}, "comment_count": 1, "state": "MERGED", "task_count": 0, "participants": [{"role": "PARTICIPANT", "participated_on": "2018-09-27T14:12:15.257532+00:00", "type": "participant", "approved": false, "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}, {"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}}], "reason": "", "updated_on": "2018-10-01T19:10:24.981702+00:00", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "merge_commit": {"hash": "db36a0fa2bfb", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/db36a0fa2bfb.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/db36a0fa2bfb"}}}, "closed_by": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}