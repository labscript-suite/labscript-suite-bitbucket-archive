{"pagelen": 50, "values": [{"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/38472357.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-38472357"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "Excellent, cheers!", "markup": "markdown", "html": "<p>Excellent, cheers!</p>", "type": "rendered"}, "created_on": "2017-06-08T15:14:07.606591+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-06-08T15:14:07.609331+00:00", "type": "pullrequest_comment", "id": 38472357}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"update": {"description": "Bugfix to queue processing:\r\n\r\nChecking for abort/tab restarts while a shot is running is now done with a nonblocking call so that it does not prevent the 'done' signal from being received and acted upon, and does not introduce an additional 0.5 second delay *after* the done signal is received.\r\n\r\nPreviously, there was an unconditional 0.5 second delay checking for abort/restarts after the done signal was received, and there was a 50% chance of an additional zero to 0.5 second delay due to the 'done' signal arriving whilst the code was checking for abort/restart. This introduced a delay to shot processing of between 0.5 and 1 seconds, with an average of 0.625 seconds.\r\n\r\nWith this fix this part of the code no longer delays the end of a shot with waiting in this way - the only delay is actual code running not blocking `.get`() calls on queues.", "title": "Reduce average shot turnaround time by 0.625 seconds", "destination": {"commit": {"hash": "96d4e099f3c1", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/96d4e099f3c1.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/96d4e099f3c1"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "eb622809f293", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/eb622809f293"}, "html": {"href": "#!/cbillington/blacs/commits/eb622809f293"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "bugfix2"}}, "state": "MERGED", "author": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "date": "2017-06-07T23:04:35.135238+00:00"}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"approval": {"date": "2017-06-07T23:04:19.760386+00:00", "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/38411785.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-38411785"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "Ok, I'll merge this now.\n\nI'm going to log another enhancement regarding this for another speed up (issue #15) relating to the tab error state checking which is inefficient (you probably only have dummy device in your shot, so real experiments will be slower than your gif!). However, I think that's outside the scope of this pull request!", "markup": "markdown", "html": "<p>Ok, I'll merge this now.</p>\n<p>I'm going to log another enhancement regarding this for another speed up (issue <a href=\"#!/labscript_suite/blacs/issues/15/improve-shot-cycle-time-in-blacs\" rel=\"nofollow\" title=\"Improve shot cycle time in BLACS\" class=\"ap-connect-link\">#15</a>) relating to the tab error state checking which is inefficient (you probably only have dummy device in your shot, so real experiments will be slower than your gif!). However, I think that's outside the scope of this pull request!</p>", "type": "rendered"}, "created_on": "2017-06-07T23:04:16.320077+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2017-06-07T23:04:16.322366+00:00", "type": "pullrequest_comment", "id": 38411785}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"update": {"description": "Bugfix to queue processing:\r\n\r\nChecking for abort/tab restarts while a shot is running is now done with a nonblocking call so that it does not prevent the 'done' signal from being received and acted upon, and does not introduce an additional 0.5 second delay *after* the done signal is received.\r\n\r\nPreviously, there was an unconditional 0.5 second delay checking for abort/restarts after the done signal was received, and there was a 50% chance of an additional zero to 0.5 second delay due to the 'done' signal arriving whilst the code was checking for abort/restart. This introduced a delay to shot processing of between 0.5 and 1 seconds, with an average of 0.625 seconds.\r\n\r\nWith this fix this part of the code no longer delays the end of a shot with waiting in this way - the only delay is actual code running not blocking `.get`() calls on queues.", "title": "Reduce average shot turnaround time by 0.625 seconds", "destination": {"commit": {"hash": "96d4e099f3c1", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/96d4e099f3c1.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/96d4e099f3c1"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "eb622809f293", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/eb622809f293"}, "html": {"href": "#!/cbillington/blacs/commits/eb622809f293"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "bugfix2"}}, "state": "OPEN", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "date": "2017-06-07T20:11:29.068388+00:00"}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/38385967.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-38385967"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "Ah, I see what you mean. Well, why not give it no timeout? We can just `get_nowait()` rather than `get(0.5)`. Then the loop only ever blocks on waiting for 'done', and every time that times out it checks for abort without blocking.\n\nI agree this is a quick fix with no immediate downside, and since aborting is a human-done thing, (up to) 0.5 seconds is no big deal, whereas getting the shot cycle time down when humans are not touching the interface is more important.\n\nOK so I've implemented that fix and a slight refactor - back to checking conditions in the while loop predicate instead of breaks (removed all breaks). Behaviour is now that an abort or restart will be handled regardless of whether the 'done' signal was received, which seems probably right. If you've aborted you're still saying potentially don't save data or whatever, and if a device has restarted it cannot do a `transition_to_static`.\n\nLook at it go! (for a fake shot that doesn't touch h5 files, anyway)\n\n![blacs.gif](data/bitbucket.org/repo/dR5qxr/images/1765179848-result.gif)", "markup": "markdown", "html": "<p>Ah, I see what you mean. Well, why not give it no timeout? We can just <code>get_nowait()</code> rather than <code>get(0.5)</code>. Then the loop only ever blocks on waiting for 'done', and every time that times out it checks for abort without blocking.</p>\n<p>I agree this is a quick fix with no immediate downside, and since aborting is a human-done thing, (up to) 0.5 seconds is no big deal, whereas getting the shot cycle time down when humans are not touching the interface is more important.</p>\n<p>OK so I've implemented that fix and a slight refactor - back to checking conditions in the while loop predicate instead of breaks (removed all breaks). Behaviour is now that an abort or restart will be handled regardless of whether the 'done' signal was received, which seems probably right. If you've aborted you're still saying potentially don't save data or whatever, and if a device has restarted it cannot do a <code>transition_to_static</code>.</p>\n<p>Look at it go! (for a fake shot that doesn't touch h5 files, anyway)</p>\n<p><img alt=\"blacs.gif\" src=\"data/bitbucket.org/repo/dR5qxr/images/1765179848-result.gif\" /></p>", "type": "rendered"}, "created_on": "2017-06-07T16:06:13.523841+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-06-07T16:39:02.849699+00:00", "type": "pullrequest_comment", "id": 38385967}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"update": {"description": "* Allow zprocess 2+ and require labscript_utils 2.2.2 since new logging\r\n    fuctionality is used from there.\r\n\r\n* Queue bugfix: variable 'result' not initialised before used\r\n    in while loop predicate.\r\n\r\n    Incidentally a variable with the same name is used earlier (and\r\n    I don't believe that code ever sets is to 'done'), which means\r\n    this code works most of the time. But that's obivously not ideal.\r\n\r\n    (I got variable used before assignment when running a shot with no devices -\r\n    obviously not a realistic situation but worth fixing anyway)", "title": "version updates and undefined variable fix", "destination": {"commit": {"hash": "96d4e099f3c1", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/96d4e099f3c1.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/96d4e099f3c1"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "eb622809f293", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/eb622809f293"}, "html": {"href": "#!/cbillington/blacs/commits/eb622809f293"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "bugfix2"}}, "state": "OPEN", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "date": "2017-06-07T15:56:04.867282+00:00"}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/38319291.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-38319291"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "Yes, that's what I was trying to say with my second paragraph in my last comment. I'm pretty sure that the speedup will be equal to the amount of time we shorten the timeout on the second queue (the abort queue) check (the one you've highlighted in your comment - line 606). This is because the current code only introduces an unnecessary delay if the experiment finished while polling the abort queue. If it finishes while polling the first/experiment finished queue, then we don't get an unnecessary delay (well, we'd get  a small delay when aborting, but I don't think we need to worry about that!)....\n\nOh, in my last comment I mistakenly said we'd still be IO bound by line 606, I meant 601! (I guess I mean comparatively, we're IO bound by the queue with the longest timeout). So the first/experiment finished queue has a 0.5 second timeout, and then the second/abort queue could have a 0.01 second timeout, which makes the total loop time 0.51 seconds. Aborting will happen in 0.51 seconds of a problem and experiment detection will happen in ~0.01 seconds (because the first queue returns the data as soon as it happens, so it can only ever be blocked for the length of the timeout for the other queue)*.\n\n* not taking into account overheads from thread switching, etc.\n\nBut yes, we should definitely refactor this part of the queue in order to make it as fast as it can be and not bound by the arbitrary numbers specified as timeouts. But the above makes it a quick fix with no immediate down-sides I think?", "markup": "markdown", "html": "<p>Yes, that's what I was trying to say with my second paragraph in my last comment. I'm pretty sure that the speedup will be equal to the amount of time we shorten the timeout on the second queue (the abort queue) check (the one you've highlighted in your comment - line 606). This is because the current code only introduces an unnecessary delay if the experiment finished while polling the abort queue. If it finishes while polling the first/experiment finished queue, then we don't get an unnecessary delay (well, we'd get  a small delay when aborting, but I don't think we need to worry about that!)....</p>\n<p>Oh, in my last comment I mistakenly said we'd still be IO bound by line 606, I meant 601! (I guess I mean comparatively, we're IO bound by the queue with the longest timeout). So the first/experiment finished queue has a 0.5 second timeout, and then the second/abort queue could have a 0.01 second timeout, which makes the total loop time 0.51 seconds. Aborting will happen in 0.51 seconds of a problem and experiment detection will happen in ~0.01 seconds (because the first queue returns the data as soon as it happens, so it can only ever be blocked for the length of the timeout for the other queue)*.</p>\n<ul>\n<li>not taking into account overheads from thread switching, etc.</li>\n</ul>\n<p>But yes, we should definitely refactor this part of the queue in order to make it as fast as it can be and not bound by the arbitrary numbers specified as timeouts. But the above makes it a quick fix with no immediate down-sides I think?</p>", "type": "rendered"}, "created_on": "2017-06-06T23:54:49.572843+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2017-06-06T23:54:49.575408+00:00", "type": "pullrequest_comment", "id": 38319291}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"update": {"description": "* Allow zprocess 2+ and require labscript_utils 2.2.2 since new logging\r\n    fuctionality is used from there.\r\n\r\n* Queue bugfix: variable 'result' not initialised before used\r\n    in while loop predicate.\r\n\r\n    Incidentally a variable with the same name is used earlier (and\r\n    I don't believe that code ever sets is to 'done'), which means\r\n    this code works most of the time. But that's obivously not ideal.\r\n\r\n    (I got variable used before assignment when running a shot with no devices -\r\n    obviously not a realistic situation but worth fixing anyway)", "title": "version updates and undefined variable fix", "destination": {"commit": {"hash": "96d4e099f3c1", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/96d4e099f3c1.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/96d4e099f3c1"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "d1a6658ab8ef", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/d1a6658ab8ef"}, "html": {"href": "#!/cbillington/blacs/commits/d1a6658ab8ef"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "bugfix2"}}, "state": "OPEN", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "date": "2017-06-06T20:19:09.435229+00:00"}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/38303278.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-38303278"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "Oh wow, we have 0.5 second timeouts on two different queues being read in a loop?\n\nOK, if it's fine to break out immediately upon 'done' being received, then we don't even need the `experiment_finished` variable, so I've just changed it to `break` once it sees the 'done' message.\n\nAnd it certainly does seem to speed things up by 0.5 seconds, which is very nice!\n\nI think there is the potential for more speedup though, queue readings not happening because another queue is being read with an 0.5 second timeout is unnecessary. I'll file a bug report to remove remaining potential delays like this - I think shots are probably still 0.5 seconds longer than needed because the abort-checking is blocking the end-of-experiment-checking, that is, when we're in the line:\n\n```\n#!python\n\n# Poll self.current_queue for abort signal from button or device restart\ndevice_name, result = self.current_queue.get(timeout=0.5)   \n```\n\nwe are not checking for experiment end, and so we won't notice for up to 0.5 seconds that the experiment has ended.\n\nThe two queues should be merged in some way so that the queue manager is waiting for any event that arrives regardless of the source, in the manner of the unix `select()` call.", "markup": "markdown", "html": "<p>Oh wow, we have 0.5 second timeouts on two different queues being read in a loop?</p>\n<p>OK, if it's fine to break out immediately upon 'done' being received, then we don't even need the <code>experiment_finished</code> variable, so I've just changed it to <code>break</code> once it sees the 'done' message.</p>\n<p>And it certainly does seem to speed things up by 0.5 seconds, which is very nice!</p>\n<p>I think there is the potential for more speedup though, queue readings not happening because another queue is being read with an 0.5 second timeout is unnecessary. I'll file a bug report to remove remaining potential delays like this - I think shots are probably still 0.5 seconds longer than needed because the abort-checking is blocking the end-of-experiment-checking, that is, when we're in the line:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"c1\"># Poll self.current_queue for abort signal from button or device restart</span>\n<span class=\"n\">device_name</span><span class=\"p\">,</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_queue</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">timeout</span><span class=\"o\">=</span><span class=\"mf\">0.5</span><span class=\"p\">)</span>   \n</pre></div>\n\n\n<p>we are not checking for experiment end, and so we won't notice for up to 0.5 seconds that the experiment has ended.</p>\n<p>The two queues should be merged in some way so that the queue manager is waiting for any event that arrives regardless of the source, in the manner of the unix <code>select()</code> call.</p>", "type": "rendered"}, "created_on": "2017-06-06T18:44:53.128964+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-06-06T18:44:53.131248+00:00", "type": "pullrequest_comment", "id": 38303278}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"update": {"description": "* Allow zprocess 2+ and require labscript_utils 2.2.2 since new logging\r\n    fuctionality is used from there.\r\n\r\n* Queue bugfix: variable 'result' not initialised before used\r\n    in while loop predicate.\r\n\r\n    Incidentally a variable with the same name is used earlier (and\r\n    I don't believe that code ever sets is to 'done'), which means\r\n    this code works most of the time. But that's obivously not ideal.\r\n\r\n    (I got variable used before assignment when running a shot with no devices -\r\n    obviously not a realistic situation but worth fixing anyway)", "title": "version updates and undefined variable fix", "destination": {"commit": {"hash": "96d4e099f3c1", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/96d4e099f3c1.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/96d4e099f3c1"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "048dbf9534f7", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/048dbf9534f7"}, "html": {"href": "#!/cbillington/blacs/commits/048dbf9534f7"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "bugfix2"}}, "state": "OPEN", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "date": "2017-06-06T18:39:05.431937+00:00"}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/37706782.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-37706782"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "I think you could add `continue` after line 601 (the assignment of `experiment_finished`)? We don't need to check if a device has been restarted since the last loop because the queue this information gets put in is then checked as part of the code that calls `transition_to_static` (line 709 onwards) anyway, so the device restart would still be caught there. Doing this would speed up the cycle time by 0.5 seconds from what I can tell (by bypassing line 606 on the last iteration). Does that seem right?\n\nWe could also shorten the timeout of line 606 (but not 601) in order to make the detection of the end of experiment faster without adding too much CPU overhead (by remaining IO bound by line 606).\n\nThoughts? I know it's wandering off topic a bit, but I think some of this is still a consequence of fixing the variable names in the loop.", "markup": "markdown", "html": "<p>I think you could add <code>continue</code> after line 601 (the assignment of <code>experiment_finished</code>)? We don't need to check if a device has been restarted since the last loop because the queue this information gets put in is then checked as part of the code that calls <code>transition_to_static</code> (line 709 onwards) anyway, so the device restart would still be caught there. Doing this would speed up the cycle time by 0.5 seconds from what I can tell (by bypassing line 606 on the last iteration). Does that seem right?</p>\n<p>We could also shorten the timeout of line 606 (but not 601) in order to make the detection of the end of experiment faster without adding too much CPU overhead (by remaining IO bound by line 606).</p>\n<p>Thoughts? I know it's wandering off topic a bit, but I think some of this is still a consequence of fixing the variable names in the loop.</p>", "type": "rendered"}, "created_on": "2017-05-27T06:11:05.557609+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2017-05-27T06:11:05.560232+00:00", "type": "pullrequest_comment", "id": 37706782}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/37690838.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-37690838"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "All good?", "markup": "markdown", "html": "<p>All good?</p>", "type": "rendered"}, "created_on": "2017-05-26T17:29:41.270250+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-05-26T17:29:41.273037+00:00", "type": "pullrequest_comment", "id": 37690838}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/37433802.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-37433802"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "So I introduced a boolean `experiment_finished` which is equal to `(experiment_finished_queue.get(timeout=0.5) == 'done')`, rather than storing the result of `experiment_finished_queue.get(timeout=0.5)`. So now the code does `while not experiment_finished:`", "markup": "markdown", "html": "<p>So I introduced a boolean <code>experiment_finished</code> which is equal to <code>(experiment_finished_queue.get(timeout=0.5) == 'done')</code>, rather than storing the result of <code>experiment_finished_queue.get(timeout=0.5)</code>. So now the code does <code>while not experiment_finished:</code></p>", "type": "rendered"}, "created_on": "2017-05-23T14:50:39.327356+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-05-23T14:50:39.332167+00:00", "type": "pullrequest_comment", "id": 37433802}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"update": {"description": "* Allow zprocess 2+ and require labscript_utils 2.2.2 since new logging\r\n    fuctionality is used from there.\r\n\r\n* Queue bugfix: variable 'result' not initialised before used\r\n    in while loop predicate.\r\n\r\n    Incidentally a variable with the same name is used earlier (and\r\n    I don't believe that code ever sets is to 'done'), which means\r\n    this code works most of the time. But that's obivously not ideal.\r\n\r\n    (I got variable used before assignment when running a shot with no devices -\r\n    obviously not a realistic situation but worth fixing anyway)", "title": "version updates and undefined variable fix", "destination": {"commit": {"hash": "96d4e099f3c1", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/96d4e099f3c1.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/96d4e099f3c1"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "6a4298e8a3cc", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/6a4298e8a3cc"}, "html": {"href": "#!/cbillington/blacs/commits/6a4298e8a3cc"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "bugfix2"}}, "state": "OPEN", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "date": "2017-05-23T14:48:51.008175+00:00"}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/37374883.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-37374883"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "Sounds good, I can do that.", "markup": "markdown", "html": "<p>Sounds good, I can do that.</p>", "type": "rendered"}, "created_on": "2017-05-22T23:03:40.612150+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-05-22T23:03:40.614091+00:00", "type": "pullrequest_comment", "id": 37374883}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"comment": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/37374833.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-37374833"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "Hmm, there seem to be 6 instances of `result` now between lines 598 and 610 in queue.py, but the first 3 are for one thing and the second 3 are for another. Can I suggest we fix that as well with a variable rename for 3 of the 6 instances?", "markup": "markdown", "html": "<p>Hmm, there seem to be 6 instances of <code>result</code> now between lines 598 and 610 in queue.py, but the first 3 are for one thing and the second 3 are for another. Can I suggest we fix that as well with a variable rename for 3 of the 6 instances?</p>", "type": "rendered"}, "created_on": "2017-05-22T23:01:52.886417+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2017-05-22T23:01:52.888621+00:00", "type": "pullrequest_comment", "id": 37374833}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"update": {"description": "* Allow zprocess 2+ and require labscript_utils 2.2.2 since new logging\r\n    fuctionality is used from there.\r\n\r\n* Queue bugfix: variable 'result' not initialised before used\r\n    in while loop predicate.\r\n\r\n    Incidentally a variable with the same name is used earlier (and\r\n    I don't believe that code ever sets is to 'done'), which means\r\n    this code works most of the time. But that's obivously not ideal.\r\n\r\n    (I got variable used before assignment when running a shot with no devices -\r\n    obviously not a realistic situation but worth fixing anyway)", "title": "version updates and undefined variable fix", "destination": {"commit": {"hash": "96d4e099f3c1", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/96d4e099f3c1.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/96d4e099f3c1"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "7abb8c784bd8", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/7abb8c784bd8"}, "html": {"href": "#!/cbillington/blacs/commits/7abb8c784bd8"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "bugfix2"}}, "state": "OPEN", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "date": "2017-05-22T22:34:37.469772+00:00"}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"update": {"description": "* Allow zprocess 2+ and require labscript_utils 2.2.2 since new logging\r\n    fuctionality is used from there.\r\n\r\n* Queue bugfix: variable 'result' not initialised before used\r\n    in while loop predicate.\r\n\r\n    Incidentally a variable with the same name is used earlier (and\r\n    I don't believe that code ever sets is to 'done'), which means\r\n    this code works most of the time. But that's obivously not ideal.\r\n\r\n    (I got variable used before assignment when running a shot with no devices -\r\n    obviously not a realistic situation but worth fixing anyway)", "title": "version updates and undefined variable fix", "destination": {"commit": {"hash": "96d4e099f3c1", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/96d4e099f3c1.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/96d4e099f3c1"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "7abb8c784bd8", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/7abb8c784bd8"}, "html": {"href": "#!/cbillington/blacs/commits/7abb8c784bd8"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "bugfix2"}}, "state": "OPEN", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "date": "2017-05-22T21:09:31.930068+00:00"}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}, {"update": {"description": "* Allow zprocess 2+ and require labscript_utils 2.2.2 since new logging\r\n    fuctionality is used from there.\r\n\r\n* Queue bugfix: variable 'result' not initialised before used\r\n    in while loop predicate.\r\n\r\n    Incidentally a variable with the same name is used earlier (and\r\n    I don't believe that code ever sets is to 'done'), which means\r\n    this code works most of the time. But that's obivously not ideal.\r\n\r\n    (I got variable used before assignment when running a shot with no devices -\r\n    obviously not a realistic situation but worth fixing anyway)", "title": "version updates and undefined variable fix", "destination": {"commit": {"hash": "96d4e099f3c1", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/blacs/commit/96d4e099f3c1.json"}, "html": {"href": "#!/labscript_suite/blacs/commits/96d4e099f3c1"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/blacs.json"}, "html": {"href": "#!/labscript_suite/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}ts=249915"}}, "type": "repository", "name": "BLACS", "full_name": "labscript_suite/blacs", "uuid": "{50ed1eb9-8c1b-4afe-a8b8-8e0a33b39a05}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "7abb8c784bd8", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs/commit/7abb8c784bd8"}, "html": {"href": "#!/cbillington/blacs/commits/7abb8c784bd8"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/blacs"}, "html": {"href": "#!/cbillington/blacs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}ts=python"}}, "type": "repository", "name": "BLACS", "full_name": "cbillington/blacs", "uuid": "{1ffc697c-0cdc-43c3-b124-343fa9d9cc95}"}, "branch": {"name": "bugfix2"}}, "state": "OPEN", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "date": "2017-05-22T21:09:31.901484+00:00"}, "pull_request": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}}]}