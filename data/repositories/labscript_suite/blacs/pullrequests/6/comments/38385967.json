{"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6/comments/38385967.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6/_/diff#comment-38385967"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 6, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/6.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/6"}}, "title": "Reduce average shot turnaround time by 0.625 seconds"}, "content": {"raw": "Ah, I see what you mean. Well, why not give it no timeout? We can just `get_nowait()` rather than `get(0.5)`. Then the loop only ever blocks on waiting for 'done', and every time that times out it checks for abort without blocking.\n\nI agree this is a quick fix with no immediate downside, and since aborting is a human-done thing, (up to) 0.5 seconds is no big deal, whereas getting the shot cycle time down when humans are not touching the interface is more important.\n\nOK so I've implemented that fix and a slight refactor - back to checking conditions in the while loop predicate instead of breaks (removed all breaks). Behaviour is now that an abort or restart will be handled regardless of whether the 'done' signal was received, which seems probably right. If you've aborted you're still saying potentially don't save data or whatever, and if a device has restarted it cannot do a `transition_to_static`.\n\nLook at it go! (for a fake shot that doesn't touch h5 files, anyway)\n\n![blacs.gif](data/bitbucket.org/repo/dR5qxr/images/1765179848-result.gif)", "markup": "markdown", "html": "<p>Ah, I see what you mean. Well, why not give it no timeout? We can just <code>get_nowait()</code> rather than <code>get(0.5)</code>. Then the loop only ever blocks on waiting for 'done', and every time that times out it checks for abort without blocking.</p>\n<p>I agree this is a quick fix with no immediate downside, and since aborting is a human-done thing, (up to) 0.5 seconds is no big deal, whereas getting the shot cycle time down when humans are not touching the interface is more important.</p>\n<p>OK so I've implemented that fix and a slight refactor - back to checking conditions in the while loop predicate instead of breaks (removed all breaks). Behaviour is now that an abort or restart will be handled regardless of whether the 'done' signal was received, which seems probably right. If you've aborted you're still saying potentially don't save data or whatever, and if a device has restarted it cannot do a <code>transition_to_static</code>.</p>\n<p>Look at it go! (for a fake shot that doesn't touch h5 files, anyway)</p>\n<p><img alt=\"blacs.gif\" src=\"data/bitbucket.org/repo/dR5qxr/images/1765179848-result.gif\" /></p>", "type": "rendered"}, "created_on": "2017-06-07T16:06:13.523841+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-06-07T16:39:02.849699+00:00", "type": "pullrequest_comment", "id": 38385967}