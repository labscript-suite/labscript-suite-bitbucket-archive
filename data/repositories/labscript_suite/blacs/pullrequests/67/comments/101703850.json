{"links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/67/comments/101703850.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/67/_/diff#comment-101703850"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 67, "links": {"self": {"href": "data/repositories/labscript_suite/blacs/pullrequests/67.json"}, "html": {"href": "#!/labscript_suite/blacs/pull-requests/67"}}, "title": "Implement remote workers in BLACS"}, "content": {"raw": "Cool. Two issues I noticed:\n\n1. Starting blacs without zlock server running fails. The two occurrences of `except zmq.ZMQError` in ls\\_zprocess.py of labscript\\_utils now need to be `except TimeoutError`.\n2. If communication with the zlock server is lost before closing blacs, it hangs on close with the following traceback, and `INFO BLACS: destroy called` filling the terminal.\n\n```\nTraceback (most recent call last):\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\qtutils\\invoke_in_main.py\", line 61, in event\r\n    result = event.fn(*event.args, **event.kwargs)\r\n  File \"C:\\labscript_suite\\blacs\\__main__.py\", line 678, in on_save_exit\r\n    self.front_panel_settings.save_front_panel_to_h5(self.settings_path,data[0],data[1],data[2],data[3],{\"overwrite\":True},force_new_conn_table=True)\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\qtutils\\invoke_in_main.py\", line 228, in f\r\n    return inmain(fn, *args, **kwargs)\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\qtutils\\invoke_in_main.py\", line 102, in inmain\r\n    return fn(*args, **kwargs)\r\n  File \"C:\\labscript_suite\\blacs\\front_panel_settings.py\", line 284, in save_front_panel_to_h5\r\n    with h5py.File(current_file,'r+') as hdf5_file:\r\n  File \"C:\\labscript_suite\\labscript_utils\\h5_lock.py\", line 41, in __init__\r\n    self.zlock.acquire()\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\zprocess\\zlock\\__init__.py\", line 243, in acquire\r\n    self._client_id = self.client.acquire(self.key, timeout, read_only)\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\zprocess\\zlock\\__init__.py\", line 161, in acquire\r\n    raise zmq.ZMQError('No response from zlock server: timed out')\r\nzmq.error.ZMQError: No response from zlock server: timed out\n```", "markup": "markdown", "html": "<p>Cool. Two issues I noticed:</p>\n<ol>\n<li>Starting blacs without zlock server running fails. The two occurrences of <code>except zmq.ZMQError</code> in ls_zprocess.py of labscript_utils now need to be <code>except TimeoutError</code>.</li>\n<li>If communication with the zlock server is lost before closing blacs, it hangs on close with the following traceback, and <code>INFO BLACS: destroy called</code> filling the terminal.</li>\n</ol>\n<div class=\"codehilite\"><pre><span></span>Traceback (most recent call last):\n  File &quot;C:\\ProgramData\\Anaconda3\\lib\\site-packages\\qtutils\\invoke_in_main.py&quot;, line 61, in event\n    result = event.fn(*event.args, **event.kwargs)\n  File &quot;C:\\labscript_suite\\blacs\\__main__.py&quot;, line 678, in on_save_exit\n    self.front_panel_settings.save_front_panel_to_h5(self.settings_path,data[0],data[1],data[2],data[3],{&quot;overwrite&quot;:True},force_new_conn_table=True)\n  File &quot;C:\\ProgramData\\Anaconda3\\lib\\site-packages\\qtutils\\invoke_in_main.py&quot;, line 228, in f\n    return inmain(fn, *args, **kwargs)\n  File &quot;C:\\ProgramData\\Anaconda3\\lib\\site-packages\\qtutils\\invoke_in_main.py&quot;, line 102, in inmain\n    return fn(*args, **kwargs)\n  File &quot;C:\\labscript_suite\\blacs\\front_panel_settings.py&quot;, line 284, in save_front_panel_to_h5\n    with h5py.File(current_file,&#39;r+&#39;) as hdf5_file:\n  File &quot;C:\\labscript_suite\\labscript_utils\\h5_lock.py&quot;, line 41, in __init__\n    self.zlock.acquire()\n  File &quot;C:\\ProgramData\\Anaconda3\\lib\\site-packages\\zprocess\\zlock\\__init__.py&quot;, line 243, in acquire\n    self._client_id = self.client.acquire(self.key, timeout, read_only)\n  File &quot;C:\\ProgramData\\Anaconda3\\lib\\site-packages\\zprocess\\zlock\\__init__.py&quot;, line 161, in acquire\n    raise zmq.ZMQError(&#39;No response from zlock server: timed out&#39;)\nzmq.error.ZMQError: No response from zlock server: timed out\n</pre></div>", "type": "rendered"}, "created_on": "2019-05-12T23:24:08.737123+00:00", "user": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, "updated_on": "2019-05-12T23:24:08.744541+00:00", "type": "pullrequest_comment", "id": 101703850}