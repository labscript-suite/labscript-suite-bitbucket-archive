{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/installer.json"}, "html": {"href": "#!/labscript_suite/installer"}, "avatar": {"href": "data/bytebucket.org/ravatar/{65cd9685-3e8c-4275-9b89-1a7873b341d0}ts=python"}}, "type": "repository", "name": "installer", "full_name": "labscript_suite/installer", "uuid": "{65cd9685-3e8c-4275-9b89-1a7873b341d0}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/installer/issues/30/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/installer/issues/30.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/installer/issues/30/watch"}, "comments": {"href": "data/repositories/labscript_suite/installer/issues/30/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/installer/issues/30/change-sudo-behaviour-on-unix"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/installer/issues/30/vote"}}, "reporter": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "title": "Change sudo behaviour on unix", "component": null, "votes": 0, "watches": 1, "content": {"raw": "So far, if you want to install the labscript suite with system Python on unix, you need to run the installer with `sudo`, so that it has permission to write the `.pth` file to the site-packages dir.\r\n\r\nHowever, I just ran the installer with sudo, and it had the side effect of picking `/root/labscript_suite` as the default install directory. Other settings based on the home directory are presumably wrong too.\r\n\r\nI'm not sure if this is distro-specific (don't remember it being a problem on Ubuntu), or whether sudo itself has changed, but in either case we should probably not be inspecting the `$HOME `environment variable while running under sudo, in case it is wrong.\r\n\r\nThe fix, which is probably a good idea anyway, would be to create the .pth file as a temporary file, then run a 'sudo mv' command that will prompt for the user's password just for that command. Then the rest of the script won't be running as root, which is safer. The user also won't accidentally run the script without root only to find they have to run it again after getting a permissions error.\r\n\r\nThe code should probably try to run `mv` without sudo first, running it again with sudo only if it gets a permission error.", "markup": "markdown", "html": "<p>So far, if you want to install the labscript suite with system Python on unix, you need to run the installer with <code>sudo</code>, so that it has permission to write the <code>.pth</code> file to the site-packages dir.</p>\n<p>However, I just ran the installer with sudo, and it had the side effect of picking <code>/root/labscript_suite</code> as the default install directory. Other settings based on the home directory are presumably wrong too.</p>\n<p>I'm not sure if this is distro-specific (don't remember it being a problem on Ubuntu), or whether sudo itself has changed, but in either case we should probably not be inspecting the <code>$HOME</code>environment variable while running under sudo, in case it is wrong.</p>\n<p>The fix, which is probably a good idea anyway, would be to create the .pth file as a temporary file, then run a 'sudo mv' command that will prompt for the user's password just for that command. Then the rest of the script won't be running as root, which is safer. The user also won't accidentally run the script without root only to find they have to run it again after getting a permissions error.</p>\n<p>The code should probably try to run <code>mv</code> without sudo first, running it again with sudo only if it gets a permission error.</p>", "type": "rendered"}, "assignee": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "state": "new", "version": null, "edited_on": null, "created_on": "2019-08-20T21:13:55.435226+00:00", "milestone": null, "updated_on": "2019-08-20T21:13:55.435226+00:00", "type": "issue", "id": 30}