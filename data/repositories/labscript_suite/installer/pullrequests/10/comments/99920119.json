{"links": {"self": {"href": "data/repositories/labscript_suite/installer/pullrequests/10/comments/99920119.json"}, "html": {"href": "#!/labscript_suite/installer/pull-requests/10/_/diff#comment-99920119"}}, "parent": {"id": 99919855, "links": {"self": {"href": "data/repositories/labscript_suite/installer/pullrequests/10/comments/99919855.json"}, "html": {"href": "#!/labscript_suite/installer/pull-requests/10/_/diff#comment-99919855"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 10, "links": {"self": {"href": "data/repositories/labscript_suite/installer/pullrequests/10.json"}, "html": {"href": "#!/labscript_suite/installer/pull-requests/10"}}, "title": "configparser dependency, and dependency cleanups."}, "content": {"raw": "Seems to work:\n\n```python\ndef executable_paths():\n    \"\"\"Return the targets of all shortcuts in the start menu that point to an .exe or\n    .bat file, as a dictionary such as {\"some_program.exe\": <full_path>}. \"\"\"\n    from win32com.shell import shell, shellcon\n    import os\n    import win32com.client \n    wscript_shell = win32com.client.Dispatch(\"WScript.Shell\")\n    START = shell.SHGetFolderPath(0, shellcon.CSIDL_STARTMENU, None, 0)\n    COMMON_START = shell.SHGetFolderPath(0, shellcon.CSIDL_COMMON_STARTMENU, None, 0)\n    paths = {}\n    for folder in [START, COMMON_START]:\n        for root, _, files in os.walk(folder):\n            for name in files:\n                if name.lower().endswith('.lnk'):\n                    shortcut = wscript_shell.CreateShortCut(os.path.join(root, name))\n                    target = shortcut.Targetpath\n                    if os.path.splitext(target)[1].lower() in ['.exe', '.bat']:\n                        paths[os.path.basename(target)] = target\n    return paths\n\n\npaths = executable_paths()\nprint(paths['sublime_text.exe'])\nprint(paths['hdfview.bat'])\n```\n\nprints:\n\n\u200c\n\n```\nC:\\Program Files\\Sublime Text 3\\sublime_text.exe\nC:\\Users\\bilbo\\AppData\\Local\\HDF_Group\\HDFView\\3.1.0\\hdfview.bat\n```\n\n\u200c", "markup": "markdown", "html": "<p>Seems to work:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">executable_paths</span><span class=\"p\">():</span>\n    <span class=\"sd\">&quot;&quot;&quot;Return the targets of all shortcuts in the start menu that point to an .exe or</span>\n<span class=\"sd\">    .bat file, as a dictionary such as {&quot;some_program.exe&quot;: &lt;full_path&gt;}. &quot;&quot;&quot;</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">win32com.shell</span> <span class=\"kn\">import</span> <span class=\"n\">shell</span><span class=\"p\">,</span> <span class=\"n\">shellcon</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">os</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">win32com.client</span> \n    <span class=\"n\">wscript_shell</span> <span class=\"o\">=</span> <span class=\"n\">win32com</span><span class=\"o\">.</span><span class=\"n\">client</span><span class=\"o\">.</span><span class=\"n\">Dispatch</span><span class=\"p\">(</span><span class=\"s2\">&quot;WScript.Shell&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">START</span> <span class=\"o\">=</span> <span class=\"n\">shell</span><span class=\"o\">.</span><span class=\"n\">SHGetFolderPath</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">shellcon</span><span class=\"o\">.</span><span class=\"n\">CSIDL_STARTMENU</span><span class=\"p\">,</span> <span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n    <span class=\"n\">COMMON_START</span> <span class=\"o\">=</span> <span class=\"n\">shell</span><span class=\"o\">.</span><span class=\"n\">SHGetFolderPath</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">shellcon</span><span class=\"o\">.</span><span class=\"n\">CSIDL_COMMON_STARTMENU</span><span class=\"p\">,</span> <span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n    <span class=\"n\">paths</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"k\">for</span> <span class=\"n\">folder</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">START</span><span class=\"p\">,</span> <span class=\"n\">COMMON_START</span><span class=\"p\">]:</span>\n        <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">files</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span><span class=\"p\">(</span><span class=\"n\">folder</span><span class=\"p\">):</span>\n            <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">files</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">endswith</span><span class=\"p\">(</span><span class=\"s1\">&#39;.lnk&#39;</span><span class=\"p\">):</span>\n                    <span class=\"n\">shortcut</span> <span class=\"o\">=</span> <span class=\"n\">wscript_shell</span><span class=\"o\">.</span><span class=\"n\">CreateShortCut</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">))</span>\n                    <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">shortcut</span><span class=\"o\">.</span><span class=\"n\">Targetpath</span>\n                    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">splitext</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"s1\">&#39;.exe&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.bat&#39;</span><span class=\"p\">]:</span>\n                        <span class=\"n\">paths</span><span class=\"p\">[</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">basename</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)]</span> <span class=\"o\">=</span> <span class=\"n\">target</span>\n    <span class=\"k\">return</span> <span class=\"n\">paths</span>\n\n\n<span class=\"n\">paths</span> <span class=\"o\">=</span> <span class=\"n\">executable_paths</span><span class=\"p\">()</span>\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">paths</span><span class=\"p\">[</span><span class=\"s1\">&#39;sublime_text.exe&#39;</span><span class=\"p\">])</span>\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">paths</span><span class=\"p\">[</span><span class=\"s1\">&#39;hdfview.bat&#39;</span><span class=\"p\">])</span>\n</pre></div>\n\n\n<p>prints:</p>\n<p>\u200c</p>\n<div class=\"codehilite\"><pre><span></span>C:\\Program Files\\Sublime Text 3\\sublime_text.exe\nC:\\Users\\bilbo\\AppData\\Local\\HDF_Group\\HDFView\\3.1.0\\hdfview.bat\n</pre></div>\n\n\n<p>\u200c</p>", "type": "rendered"}, "created_on": "2019-04-25T04:29:19.439469+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2019-04-25T04:29:19.454526+00:00", "type": "pullrequest_comment", "id": 99920119}