{"links": {"self": {"href": "data/repositories/labscript_suite/labscript/issues/46/comments/43939773.json"}, "html": {"href": "#!/labscript_suite/labscript/issues/46#comment-43939773"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript/issues/46.json"}}, "type": "issue", "id": 46, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript.json"}, "html": {"href": "#!/labscript_suite/labscript"}, "avatar": {"href": "data/bytebucket.org/ravatar/{48848b08-1db5-463b-bbdc-911beadf8bbf}ts=249917"}}, "type": "repository", "name": "labscript", "full_name": "labscript_suite/labscript", "uuid": "{48848b08-1db5-463b-bbdc-911beadf8bbf}"}, "title": "Ramps can over-/undershoot their final value"}, "content": {"raw": "Here is a minimal example:\n\n```\n#!python\n\nfrom labscript import *\nfrom labscript_devices.PulseBlaster_SP2_24_100_32k import PulseBlaster_SP2_24_100_32k\nfrom labscript_devices.NI_PCIe_6363 import NI_PCIe_6363\n\n\n# Connection Table\nPulseBlaster_SP2_24_100_32k(   name='pulse_blaster')\nClockLine(  name='A1_clockline', pseudoclock=pulse_blaster.pseudoclock,   connection='flag 0')\nNI_PCIe_6363(name='ni_card_0', parent_device=A1_clockline, clock_terminal='ni_pcie_6363_0/PFI0', MAX_name='ni_pcie_6363_0', acquisition_rate=100e3)\nAnalogOut(  name='Pushout_Frequency',           parent_device=ni_card_0,                connection='ao2', limits=(0,10), default_value=5.67)\nAnalogOut(  name='Pushout_Amplitude',           parent_device=ni_card_0,                connection='ao3', limits=(0,10), default_value=0.0)\n\nstart()\nt=1.8061896326530613\nramp_samplerate = 16000.0\nPushout_Amplitude.  ramp(t, duration=0.25, initial=5.00, final=0, samplerate=ramp_samplerate)\nt += 0.25 + 0.01\nstop(t)\n\n```\n\nThis should result in \n\n\n```\n#!\n\nTraceback (most recent call last):\n  File \"script.py\", line 18, in <module>\n  File \"/Users/janwerkmann/labscript_suite/labscript/labscript.py\", line 2143, in stop\n    generate_code()\n  File \"/Users/janwerkmann/labscript_suite/labscript/labscript.py\", line 2045, in generate_code\n    device.generate_code(hdf5_file)\n  File \"/Users/janwerkmann/labscript_suite/labscript_devices/PulseBlaster_No_DDS.py\", line 73, in generate_code\n    PseudoclockDevice.generate_code(self, hdf5_file)\n  File \"/Users/janwerkmann/labscript_suite/labscript/labscript.py\", line 963, in generate_code\n    self.do_checks(outputs)\n  File \"/Users/janwerkmann/labscript_suite/labscript/labscript.py\", line 943, in do_checks\n    output.do_checks(self.trigger_times)\n  File \"/Users/janwerkmann/labscript_suite/labscript/labscript.py\", line 1128, in do_checks\n    self.add_instruction(instruction['end time'], instruction['function'](instruction['end time']-instruction['initial time']), instruction['units'])\n  File \"/Users/janwerkmann/labscript_suite/labscript/labscript.py\", line 1107, in add_instruction\n    raise LabscriptError('You cannot program the value %s (base units) to %s as it falls outside the limits (%d to %d)'%(str(instruction), self.name, self.limits[0], self.limits[1]))\nLabscriptError: You cannot program the value -4.4408920985e-15 (base units) to Pushout_Amplitude as it falls outside the limits (0 to 10)\nCompilation aborted.\n```", "markup": "markdown", "html": "<p>Here is a minimal example:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">labscript</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n<span class=\"kn\">from</span> <span class=\"nn\">labscript_devices.PulseBlaster_SP2_24_100_32k</span> <span class=\"kn\">import</span> <span class=\"n\">PulseBlaster_SP2_24_100_32k</span>\n<span class=\"kn\">from</span> <span class=\"nn\">labscript_devices.NI_PCIe_6363</span> <span class=\"kn\">import</span> <span class=\"n\">NI_PCIe_6363</span>\n\n\n<span class=\"c1\"># Connection Table</span>\n<span class=\"n\">PulseBlaster_SP2_24_100_32k</span><span class=\"p\">(</span>   <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;pulse_blaster&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">ClockLine</span><span class=\"p\">(</span>  <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;A1_clockline&#39;</span><span class=\"p\">,</span> <span class=\"n\">pseudoclock</span><span class=\"o\">=</span><span class=\"n\">pulse_blaster</span><span class=\"o\">.</span><span class=\"n\">pseudoclock</span><span class=\"p\">,</span>   <span class=\"n\">connection</span><span class=\"o\">=</span><span class=\"s1\">&#39;flag 0&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">NI_PCIe_6363</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;ni_card_0&#39;</span><span class=\"p\">,</span> <span class=\"n\">parent_device</span><span class=\"o\">=</span><span class=\"n\">A1_clockline</span><span class=\"p\">,</span> <span class=\"n\">clock_terminal</span><span class=\"o\">=</span><span class=\"s1\">&#39;ni_pcie_6363_0/PFI0&#39;</span><span class=\"p\">,</span> <span class=\"n\">MAX_name</span><span class=\"o\">=</span><span class=\"s1\">&#39;ni_pcie_6363_0&#39;</span><span class=\"p\">,</span> <span class=\"n\">acquisition_rate</span><span class=\"o\">=</span><span class=\"mf\">100e3</span><span class=\"p\">)</span>\n<span class=\"n\">AnalogOut</span><span class=\"p\">(</span>  <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;Pushout_Frequency&#39;</span><span class=\"p\">,</span>           <span class=\"n\">parent_device</span><span class=\"o\">=</span><span class=\"n\">ni_card_0</span><span class=\"p\">,</span>                <span class=\"n\">connection</span><span class=\"o\">=</span><span class=\"s1\">&#39;ao2&#39;</span><span class=\"p\">,</span> <span class=\"n\">limits</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">10</span><span class=\"p\">),</span> <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"mf\">5.67</span><span class=\"p\">)</span>\n<span class=\"n\">AnalogOut</span><span class=\"p\">(</span>  <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;Pushout_Amplitude&#39;</span><span class=\"p\">,</span>           <span class=\"n\">parent_device</span><span class=\"o\">=</span><span class=\"n\">ni_card_0</span><span class=\"p\">,</span>                <span class=\"n\">connection</span><span class=\"o\">=</span><span class=\"s1\">&#39;ao3&#39;</span><span class=\"p\">,</span> <span class=\"n\">limits</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">10</span><span class=\"p\">),</span> <span class=\"n\">default_value</span><span class=\"o\">=</span><span class=\"mf\">0.0</span><span class=\"p\">)</span>\n\n<span class=\"n\">start</span><span class=\"p\">()</span>\n<span class=\"n\">t</span><span class=\"o\">=</span><span class=\"mf\">1.8061896326530613</span>\n<span class=\"n\">ramp_samplerate</span> <span class=\"o\">=</span> <span class=\"mf\">16000.0</span>\n<span class=\"n\">Pushout_Amplitude</span><span class=\"o\">.</span>  <span class=\"n\">ramp</span><span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">duration</span><span class=\"o\">=</span><span class=\"mf\">0.25</span><span class=\"p\">,</span> <span class=\"n\">initial</span><span class=\"o\">=</span><span class=\"mf\">5.00</span><span class=\"p\">,</span> <span class=\"n\">final</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">samplerate</span><span class=\"o\">=</span><span class=\"n\">ramp_samplerate</span><span class=\"p\">)</span>\n<span class=\"n\">t</span> <span class=\"o\">+=</span> <span class=\"mf\">0.25</span> <span class=\"o\">+</span> <span class=\"mf\">0.01</span>\n<span class=\"n\">stop</span><span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>This should result in </p>\n<div class=\"codehilite\"><pre><span></span>Traceback (most recent call last):\n  File &quot;script.py&quot;, line 18, in &lt;module&gt;\n  File &quot;/Users/janwerkmann/labscript_suite/labscript/labscript.py&quot;, line 2143, in stop\n    generate_code()\n  File &quot;/Users/janwerkmann/labscript_suite/labscript/labscript.py&quot;, line 2045, in generate_code\n    device.generate_code(hdf5_file)\n  File &quot;/Users/janwerkmann/labscript_suite/labscript_devices/PulseBlaster_No_DDS.py&quot;, line 73, in generate_code\n    PseudoclockDevice.generate_code(self, hdf5_file)\n  File &quot;/Users/janwerkmann/labscript_suite/labscript/labscript.py&quot;, line 963, in generate_code\n    self.do_checks(outputs)\n  File &quot;/Users/janwerkmann/labscript_suite/labscript/labscript.py&quot;, line 943, in do_checks\n    output.do_checks(self.trigger_times)\n  File &quot;/Users/janwerkmann/labscript_suite/labscript/labscript.py&quot;, line 1128, in do_checks\n    self.add_instruction(instruction[&#39;end time&#39;], instruction[&#39;function&#39;](instruction[&#39;end time&#39;]-instruction[&#39;initial time&#39;]), instruction[&#39;units&#39;])\n  File &quot;/Users/janwerkmann/labscript_suite/labscript/labscript.py&quot;, line 1107, in add_instruction\n    raise LabscriptError(&#39;You cannot program the value %s (base units) to %s as it falls outside the limits (%d to %d)&#39;%(str(instruction), self.name, self.limits[0], self.limits[1]))\nLabscriptError: You cannot program the value -4.4408920985e-15 (base units) to Pushout_Amplitude as it falls outside the limits (0 to 10)\nCompilation aborted.\n</pre></div>", "type": "rendered"}, "created_on": "2018-03-15T17:41:10.471341+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": null, "type": "issue_comment", "id": 43939773}