{"links": {"self": {"href": "data/repositories/labscript_suite/labscript/pullrequests/11/comments/39233940.json"}, "html": {"href": "#!/labscript_suite/labscript/pull-requests/11/_/diff#comment-39233940"}}, "parent": {"id": 39233264, "links": {"self": {"href": "data/repositories/labscript_suite/labscript/pullrequests/11/comments/39233264.json"}, "html": {"href": "#!/labscript_suite/labscript/pull-requests/11/_/diff#comment-39233264"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 11, "links": {"self": {"href": "data/repositories/labscript_suite/labscript/pullrequests/11.json"}, "html": {"href": "#!/labscript_suite/labscript/pull-requests/11"}}, "title": "Added the ability to split ramps."}, "content": {"raw": "Looks like the PulseBlaster converts to an integer like [this](https://github.com/imrehg/SpinAPI/blob/master/spinapi_src/spinapi.c#L900):\n\n\n```\n#!C\n\npb_inst_pbonly64 (__int64 flags, int inst, int inst_data, double length)\n{\n  unsigned int delay;\n  double pb_clock, clock_period;\n\n  spinerr = noerr;\n\n  pb_clock = board[cur_board].clock * board[cur_board].pb_clock_mult;\n  clock_period = 1.0 / pb_clock;\n\n  delay = (unsigned int) rint ((length * pb_clock) - 3.0);\n```\n\nWhich looks to be rounding down to a multiple of the clock period rather than rounding nearest (could be rounding up, but it's definitely not rounding nearest else that 3.0 would be a half-integer).", "markup": "markdown", "html": "<p>Looks like the PulseBlaster converts to an integer like <a data-is-external-link=\"true\" href=\"https://github.com/imrehg/SpinAPI/blob/master/spinapi_src/spinapi.c#L900\" rel=\"nofollow\">this</a>:</p>\n<div class=\"codehilite language-c\"><pre><span></span><span class=\"n\">pb_inst_pbonly64</span> <span class=\"p\">(</span><span class=\"kr\">__int64</span> <span class=\"n\">flags</span><span class=\"p\">,</span> <span class=\"kt\">int</span> <span class=\"n\">inst</span><span class=\"p\">,</span> <span class=\"kt\">int</span> <span class=\"n\">inst_data</span><span class=\"p\">,</span> <span class=\"kt\">double</span> <span class=\"n\">length</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n  <span class=\"kt\">unsigned</span> <span class=\"kt\">int</span> <span class=\"n\">delay</span><span class=\"p\">;</span>\n  <span class=\"kt\">double</span> <span class=\"n\">pb_clock</span><span class=\"p\">,</span> <span class=\"n\">clock_period</span><span class=\"p\">;</span>\n\n  <span class=\"n\">spinerr</span> <span class=\"o\">=</span> <span class=\"n\">noerr</span><span class=\"p\">;</span>\n\n  <span class=\"n\">pb_clock</span> <span class=\"o\">=</span> <span class=\"n\">board</span><span class=\"p\">[</span><span class=\"n\">cur_board</span><span class=\"p\">].</span><span class=\"n\">clock</span> <span class=\"o\">*</span> <span class=\"n\">board</span><span class=\"p\">[</span><span class=\"n\">cur_board</span><span class=\"p\">].</span><span class=\"n\">pb_clock_mult</span><span class=\"p\">;</span>\n  <span class=\"n\">clock_period</span> <span class=\"o\">=</span> <span class=\"mf\">1.0</span> <span class=\"o\">/</span> <span class=\"n\">pb_clock</span><span class=\"p\">;</span>\n\n  <span class=\"n\">delay</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kt\">unsigned</span> <span class=\"kt\">int</span><span class=\"p\">)</span> <span class=\"n\">rint</span> <span class=\"p\">((</span><span class=\"n\">length</span> <span class=\"o\">*</span> <span class=\"n\">pb_clock</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"mf\">3.0</span><span class=\"p\">);</span>\n</pre></div>\n\n\n<p>Which looks to be rounding down to a multiple of the clock period rather than rounding nearest (could be rounding up, but it's definitely not rounding nearest else that 3.0 would be a half-integer).</p>", "type": "rendered"}, "created_on": "2017-06-21T03:11:36.385831+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-06-21T03:17:47.351079+00:00", "type": "pullrequest_comment", "id": 39233940}