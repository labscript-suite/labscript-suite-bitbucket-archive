{"links": {"self": {"href": "data/repositories/labscript_suite/labscript/pullrequests/19/comments/42254698.json"}, "html": {"href": "#!/labscript_suite/labscript/pull-requests/19/_/diff#comment-42254698"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 19, "links": {"self": {"href": "data/repositories/labscript_suite/labscript/pullrequests/19.json"}, "html": {"href": "#!/labscript_suite/labscript/pull-requests/19"}}, "title": "Shutter checks"}, "content": {"raw": "I think there is a bug here. On line 1613, don't you want `if self.actual_times[next_time]['time'] < self.actual_times[time]['time']`? Otherwise you're comparing a time with a delay to one without. You want to ensure that when you order by user commanded time, the instruction times are in the same order.\n\nAlso, we shouldn't be raising a warning just because the sequence of shutter commands doesn't follow open -> close -> open -> close -> ...\nWe have a significant number of scripts that contain sections logic that can be switched on/off with booleans. As such, some combinations will follow open -> close but some might do something like open -> open -> close (for instance the case where the first open in in an optional section, but there is not time to close and open before the following section of code.\n\nAlso, I'm just going to flag here that `self.actual_times` will become unnecessary in the next major version of labscript when we introduce a proper instruction class that automatically keeps track of all these things internally.", "markup": "markdown", "html": "<p>I think there is a bug here. On line 1613, don't you want <code>if self.actual_times[next_time]['time'] &lt; self.actual_times[time]['time']</code>? Otherwise you're comparing a time with a delay to one without. You want to ensure that when you order by user commanded time, the instruction times are in the same order.</p>\n<p>Also, we shouldn't be raising a warning just because the sequence of shutter commands doesn't follow open -&gt; close -&gt; open -&gt; close -&gt; ...\nWe have a significant number of scripts that contain sections logic that can be switched on/off with booleans. As such, some combinations will follow open -&gt; close but some might do something like open -&gt; open -&gt; close (for instance the case where the first open in in an optional section, but there is not time to close and open before the following section of code.</p>\n<p>Also, I'm just going to flag here that <code>self.actual_times</code> will become unnecessary in the next major version of labscript when we introduce a proper instruction class that automatically keeps track of all these things internally.</p>", "type": "rendered"}, "created_on": "2017-08-07T02:12:10.597500+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2017-08-07T02:12:10.600056+00:00", "type": "pullrequest_comment", "id": 42254698}