{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices.json"}, "html": {"href": "#!/labscript_suite/labscript_devices"}, "avatar": {"href": "data/bytebucket.org/ravatar/{30c94cb1-feec-4534-8885-92452023c9c9}ts=python"}}, "type": "repository", "name": "labscript_devices", "full_name": "labscript_suite/labscript_devices", "uuid": "{30c94cb1-feec-4534-8885-92452023c9c9}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/labscript_devices/issues/28/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/labscript_devices/issues/28.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/issues/28/watch"}, "comments": {"href": "data/repositories/labscript_suite/labscript_devices/issues/28/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/issues/28/pulseblaster-long-delay-instructions-only"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/issues/28/vote"}}, "reporter": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "title": "PulseBlaster long delay instructions only work for PulseBlaster devices with a 13.33ns resolution", "component": null, "votes": 0, "watches": 1, "content": {"raw": "We have a bunch of hard-coded instances of 55 seconds in the PulseBlaster labscript class. This number is used to determine when to switch between normal delay and long delay instructions. That code is used by all the other PulseBlaster variants (via subclassing), however the 55 second number is actually 13.333ns * 2^32, where 2^32 indicates that the instruction delay is actually stored as a 32-bit integer inside the PulseBlaster (corroborated by the manual) and 13.333ns is half of the `clock_resolution` attribute of `PseudoclockDevice`s.\r\n\r\nWe should update the code to handle the switch between normal delay and long delay instructions based on the instruction length going over `2**32*self.clock_resolution/2` rather than 55 seconds.\r\n\r\nWe should probably also note that I think Shaun has been wanting PulseBlasters which only use internal outputs (and not `ClockLines`) to be able to have a clock resolution of half that specified at the moment, and so a fix for this may conflict with any parallel changes that Shaun works on.", "markup": "markdown", "html": "<p>We have a bunch of hard-coded instances of 55 seconds in the PulseBlaster labscript class. This number is used to determine when to switch between normal delay and long delay instructions. That code is used by all the other PulseBlaster variants (via subclassing), however the 55 second number is actually 13.333ns * 2^32, where 2^32 indicates that the instruction delay is actually stored as a 32-bit integer inside the PulseBlaster (corroborated by the manual) and 13.333ns is half of the <code>clock_resolution</code> attribute of <code>PseudoclockDevice</code>s.</p>\n<p>We should update the code to handle the switch between normal delay and long delay instructions based on the instruction length going over <code>2**32*self.clock_resolution/2</code> rather than 55 seconds.</p>\n<p>We should probably also note that I think Shaun has been wanting PulseBlasters which only use internal outputs (and not <code>ClockLines</code>) to be able to have a clock resolution of half that specified at the moment, and so a fix for this may conflict with any parallel changes that Shaun works on.</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2018-09-30T05:27:28.094554+00:00", "milestone": null, "updated_on": "2018-09-30T05:27:28.094554+00:00", "type": "issue", "id": 28}