{"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/issues/35/comments/52704655.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/issues/35#comment-52704655"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/issues/35.json"}}, "type": "issue", "id": 35, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices.json"}, "html": {"href": "#!/labscript_suite/labscript_devices"}, "avatar": {"href": "data/bytebucket.org/ravatar/{30c94cb1-feec-4534-8885-92452023c9c9}ts=python"}}, "type": "repository", "name": "labscript_devices", "full_name": "labscript_suite/labscript_devices", "uuid": "{30c94cb1-feec-4534-8885-92452023c9c9}"}, "title": "Novatech DDS9m digital-gate being inappropriately held to DDS table pseudoclock"}, "content": {"raw": "Thanks Chris. I\u2019ll try your MWE in a minute, and the reversion, but for now I\u2019m documenting the error I am seeing\u2026\n\nThe labscript output is: \n\n```\nt = 19.973200000 s: Stern-Gerlach kick\nWARNING: State of digital quantity MOT_repump_gate at t=19.9622s has already been set to low. Overwriting to high. (note: all values in base units where relevant)\nt = 19.963200000 s: fluorescence exposure\nt = 20.073310000 s: Close MOT shutter after fluorescence probe pulse\nt = 20.163310000 s: Zeeman loaded MOT\nt = 20.163310000 s: LF + HF amps active\nt = 23.243310000 s: Open Faraday shutter for alignment purposes...\nt = 23.243310000 s: experiment ends\nTraceback (most recent call last):\nFile \"crossed_beam_bec.py\", line 963, in <module>\nFile \"C:\\labscript_suite\\labscript\\labscript.py\", line 2350, in stop\ngenerate_code()\nFile \"C:\\labscript_suite\\labscript\\labscript.py\", line 2226, in generate_code\ndevice.generate_code(hdf5_file)\nFile \"C:\\labscript_suite\\labscript_devices\\PulseBlaster.py\", line 610, in generate_code\nPseudoclockDevice.generate_code(self, hdf5_file)\nFile \"C:\\labscript_suite\\labscript\\labscript.py\", line 1097, in generate_code\nDevice.generate_code(self, hdf5_file)\nFile \"C:\\labscript_suite\\labscript\\labscript.py\", line 477, in generate_code\ndevice.generate_code(hdf5_file)\nFile \"C:\\labscript_suite\\labscript\\labscript.py\", line 920, in generate_code\nself.generate_clock()\nFile \"C:\\labscript_suite\\labscript\\labscript.py\", line 890, in generate_clock\nall_change_times, change_times = self.collect_change_times(all_outputs, outputs_by_clockline)\nFile \"C:\\labscript_suite\\labscript\\labscript.py\", line 679, in collect_change_times\n'One or more connected devices on ClockLine %s cannot support update delays shorter than %s sec.'%(clock_line.name, str(1.0/clock_line.clock_limit)))\nlabscript.labscript.LabscriptError: Commands have been issued to devices attached to pulseblaster_0_pseudoclock at t= 19.9632 s and 19.96324 s. One or more connected devices on ClockLine pulseblaster_0_novatech_clock cannot support update delays shorter than 0.0001001001001001001 sec.\nCompilation aborted.\n```\n\n  \nThis happens at 19.9632s, which is at the time we print \u201cfluorescence exposure\u201d \\(line 3\\). The relevant labscript is:\n\n```\n # fluorescence exposure\r\n    print_time(t, 'fluorescence exposure')\r\n    avt_makog030b_0.expose('fluorescence', t, 'fluorescence', exposure_time=fluoro_exposure_time)\r\n    MOT_shutter.open(t-shutter_buffer)\r\n    MOT.setamp(t, MOT_imaging_amplitude)\r\n    MOT.setfreq(t, MOT_imaging_detuning, 'd_MHz') # go on resonance\r\n    #t += 10e-6\r\n    MOT.enable(t)\r\n    t += fluoro_exposure_time\r\n    MOT.disable(t-10e-6)\r\n    MOT_repump.disable(t-10e-6)\n```\n\nIndeed, the traceback clearly complains about times 19.963200 and 19.963240 s, i.e. separation by 40us. \n\nThat corresponds to line 8,9,10 in the labscript above. fluoro\\_exposure\\_time in this test was equal to 50us, and so the delay between MOT.enable\\(\\) and MOT.disable\\(\\) was 40us. \n\nHowever, the following works fine:\n\n\u200c\n\n```\n    ## MOT.setamp(t, MOT_imaging_amplitude)\r\n    ## MOT.setfreq(t, MOT_imaging_detuning, 'd_MHz') # go on resonance\r\n    ## t += 10e-6\r\n    MOT.enable(t)\r\n    t += fluoro_exposure_time\r\n    MOT.disable(t-10e-6)\r\n    ## MOT_repump.disable(t-10e-6)\n```\n\nSo it is not simply the short fluoro\\_exposure\\_time \\(50us\\) on the enable line. This is consistent with Chris\u2019s MWE.\n\nUncommenting the ## MOT.setamp\\(\u2026\\) line in the above then fails to compile as above. \n\nPutting t\\+=1e-3 above or below that setamp line doesn\u2019t help.\n\nAnd, worse, the times mentioned in the traceback become intermediate times  that t is never set set to in the code\u2026", "markup": "markdown", "html": "<p>Thanks Chris. I\u2019ll try your MWE in a minute, and the reversion, but for now I\u2019m documenting the error I am seeing\u2026</p>\n<p>The labscript output is: </p>\n<div class=\"codehilite\"><pre><span></span>t = 19.973200000 s: Stern-Gerlach kick\nWARNING: State of digital quantity MOT_repump_gate at t=19.9622s has already been set to low. Overwriting to high. (note: all values in base units where relevant)\nt = 19.963200000 s: fluorescence exposure\nt = 20.073310000 s: Close MOT shutter after fluorescence probe pulse\nt = 20.163310000 s: Zeeman loaded MOT\nt = 20.163310000 s: LF + HF amps active\nt = 23.243310000 s: Open Faraday shutter for alignment purposes...\nt = 23.243310000 s: experiment ends\nTraceback (most recent call last):\nFile &quot;crossed_beam_bec.py&quot;, line 963, in &lt;module&gt;\nFile &quot;C:\\labscript_suite\\labscript\\labscript.py&quot;, line 2350, in stop\ngenerate_code()\nFile &quot;C:\\labscript_suite\\labscript\\labscript.py&quot;, line 2226, in generate_code\ndevice.generate_code(hdf5_file)\nFile &quot;C:\\labscript_suite\\labscript_devices\\PulseBlaster.py&quot;, line 610, in generate_code\nPseudoclockDevice.generate_code(self, hdf5_file)\nFile &quot;C:\\labscript_suite\\labscript\\labscript.py&quot;, line 1097, in generate_code\nDevice.generate_code(self, hdf5_file)\nFile &quot;C:\\labscript_suite\\labscript\\labscript.py&quot;, line 477, in generate_code\ndevice.generate_code(hdf5_file)\nFile &quot;C:\\labscript_suite\\labscript\\labscript.py&quot;, line 920, in generate_code\nself.generate_clock()\nFile &quot;C:\\labscript_suite\\labscript\\labscript.py&quot;, line 890, in generate_clock\nall_change_times, change_times = self.collect_change_times(all_outputs, outputs_by_clockline)\nFile &quot;C:\\labscript_suite\\labscript\\labscript.py&quot;, line 679, in collect_change_times\n&#39;One or more connected devices on ClockLine %s cannot support update delays shorter than %s sec.&#39;%(clock_line.name, str(1.0/clock_line.clock_limit)))\nlabscript.labscript.LabscriptError: Commands have been issued to devices attached to pulseblaster_0_pseudoclock at t= 19.9632 s and 19.96324 s. One or more connected devices on ClockLine pulseblaster_0_novatech_clock cannot support update delays shorter than 0.0001001001001001001 sec.\nCompilation aborted.\n</pre></div>\n\n\n<p>This happens at 19.9632s, which is at the time we print \u201cfluorescence exposure\u201d (line 3). The relevant labscript is:</p>\n<div class=\"codehilite\"><pre><span></span> # fluorescence exposure\n    print_time(t, &#39;fluorescence exposure&#39;)\n    avt_makog030b_0.expose(&#39;fluorescence&#39;, t, &#39;fluorescence&#39;, exposure_time=fluoro_exposure_time)\n    MOT_shutter.open(t-shutter_buffer)\n    MOT.setamp(t, MOT_imaging_amplitude)\n    MOT.setfreq(t, MOT_imaging_detuning, &#39;d_MHz&#39;) # go on resonance\n    #t += 10e-6\n    MOT.enable(t)\n    t += fluoro_exposure_time\n    MOT.disable(t-10e-6)\n    MOT_repump.disable(t-10e-6)\n</pre></div>\n\n\n<p>Indeed, the traceback clearly complains about times 19.963200 and 19.963240 s, i.e. separation by 40us. </p>\n<p>That corresponds to line 8,9,10 in the labscript above. fluoro_exposure_time in this test was equal to 50us, and so the delay between MOT.enable() and MOT.disable() was 40us. </p>\n<p>However, the following works fine:</p>\n<p>\u200c</p>\n<div class=\"codehilite\"><pre><span></span>    ## MOT.setamp(t, MOT_imaging_amplitude)\n    ## MOT.setfreq(t, MOT_imaging_detuning, &#39;d_MHz&#39;) # go on resonance\n    ## t += 10e-6\n    MOT.enable(t)\n    t += fluoro_exposure_time\n    MOT.disable(t-10e-6)\n    ## MOT_repump.disable(t-10e-6)\n</pre></div>\n\n\n<p>So it is not simply the short fluoro_exposure_time (50us) on the enable line. This is consistent with Chris\u2019s MWE.</p>\n<p>Uncommenting the ## MOT.setamp(\u2026) line in the above then fails to compile as above. </p>\n<p>Putting t+=1e-3 above or below that setamp line doesn\u2019t help.</p>\n<p>And, worse, the times mentioned in the traceback become intermediate times  that t is never set set to in the code\u2026</p>", "type": "rendered"}, "created_on": "2019-06-24T05:47:39.593592+00:00", "user": {"display_name": "Lincoln Turner", "uuid": "{7e35ca32-09d7-4a25-a548-32edef727dda}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B7e35ca32-09d7-4a25-a548-32edef727dda%7D"}, "html": {"href": "https://bitbucket.org/%7B7e35ca32-09d7-4a25-a548-32edef727dda%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/2ac774c664cd58fc011cc65e0980b4c1d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsLT-3.png"}}, "nickname": "lincolndturner", "type": "user", "account_id": "5b46a53d845e7e2cdff75ad3"}, "updated_on": "2019-06-25T06:25:13.947995+00:00", "type": "issue_comment", "id": 52704655}