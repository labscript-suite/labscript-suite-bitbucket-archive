{"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/13/comments/37874294.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/13/_/diff#comment-37874294"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 13, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/13.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/13"}}, "title": "Pulseblaster check MaxInstructions"}, "content": {"raw": "Hi Rene,\n\nThanks for contributing to the labscript suite!\n\nFirstly, could you please add myself and @cbillington as reviewers for this pull request? Unfortunately only the person who makes the pull request can set this.\n\nIn regards to the pull request itself: I think it makes sense to check like this. We had originally intended to use the `firmware` keyword argument to determine the maximum number of instructions, but then never implemented it because the spinapi was not returning the firmware version correctly so we couldn't actually ever implement the check with the hardware. \n\nIt seems that 4000 is the standard number of instructions for most PulseBlaster products, although I suspect that we may have some early versions of the PulseBlasterDDS-II-300 that support more, so I think that is a sensible default. \n\nCould you also fix the following issues with your code:\n\n* The error message currently has the number `4000` hard coded. Could you make it use `self.max_instructions` instead?\n* The other PulseBlaster classes use this one as a base. I think they all have 4000 instructions except for the PulseBlaster_SP2_24_100_32k which I suspect supports 32,000 instructions. Could you modify that labscript class too so that it sets `max_instructions` correctly and doesn't break the use of that device? You'll probably want to add something like this to the `PulseBlaster_SP2_24_100_32k` class:\n```\n#!python\n\ndef __init__(self, *args, **kwargs):\n    if 'max_instructions' not in kwargs:\n        kwargs['max_instructions'] = 32000\n    PulseBlaster_No_DDS.__init__(self, *args, **kwargs)\n```\n\n* I think we should also discuss with @cbillington whether `max_instructions` should be stored in the `device_properties` or the `connection_table_properties` and whether we should remove the `firmware` keyword (but this might break compatibility if other groups are using it for some reason).\n\nThanks!", "markup": "markdown", "html": "<p>Hi Rene,</p>\n<p>Thanks for contributing to the labscript suite!</p>\n<p>Firstly, could you please add myself and @cbillington as reviewers for this pull request? Unfortunately only the person who makes the pull request can set this.</p>\n<p>In regards to the pull request itself: I think it makes sense to check like this. We had originally intended to use the <code>firmware</code> keyword argument to determine the maximum number of instructions, but then never implemented it because the spinapi was not returning the firmware version correctly so we couldn't actually ever implement the check with the hardware. </p>\n<p>It seems that 4000 is the standard number of instructions for most PulseBlaster products, although I suspect that we may have some early versions of the PulseBlasterDDS-II-300 that support more, so I think that is a sensible default. </p>\n<p>Could you also fix the following issues with your code:</p>\n<ul>\n<li>The error message currently has the number <code>4000</code> hard coded. Could you make it use <code>self.max_instructions</code> instead?</li>\n<li>The other PulseBlaster classes use this one as a base. I think they all have 4000 instructions except for the PulseBlaster_SP2_24_100_32k which I suspect supports 32,000 instructions. Could you modify that labscript class too so that it sets <code>max_instructions</code> correctly and doesn't break the use of that device? You'll probably want to add something like this to the <code>PulseBlaster_SP2_24_100_32k</code> class:</li>\n</ul>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"s1\">&#39;max_instructions&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n        <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s1\">&#39;max_instructions&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">32000</span>\n    <span class=\"n\">PulseBlaster_No_DDS</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<ul>\n<li>I think we should also discuss with @cbillington whether <code>max_instructions</code> should be stored in the <code>device_properties</code> or the <code>connection_table_properties</code> and whether we should remove the <code>firmware</code> keyword (but this might break compatibility if other groups are using it for some reason).</li>\n</ul>\n<p>Thanks!</p>", "type": "rendered"}, "created_on": "2017-05-31T00:17:19.600531+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2017-05-31T00:17:19.609018+00:00", "type": "pullrequest_comment", "id": 37874294}