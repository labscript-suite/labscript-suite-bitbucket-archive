{"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/38/comments/71478694.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/38/_/diff#comment-71478694"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 38, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/38.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/38"}}, "title": "Python3 RFBlaster"}, "content": {"raw": "Turns out I was unable to reproduce the bug because I was testing this in Python 3. In Python 2, I still get this traceback during `transition_to_buffered`:\n\n```python\n2018-07-31 14:35:05,697 ERROR BLACS.rf_blaster_2_main_worker.worker: Exception in job:\r\nTraceback (most recent call last):\r\n  File \"C:\\labscript_suite\\labscript_devices\\RFBlaster.py\", line 418, in transition_to_buffered\r\n    self.http_request(form)\r\n  File \"C:\\labscript_suite\\labscript_devices\\RFBlaster.py\", line 454, in http_request\r\n    page = b''.join(urlopen(req, timeout=self.timeout).readlines())\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\urllib2.py\", line 154, in urlopen\r\n    return opener.open(url, data, timeout)\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\urllib2.py\", line 429, in open\r\n    response = self._open(req, data)\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\urllib2.py\", line 447, in _open\r\n    '_open', req)\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\urllib2.py\", line 407, in _call_chain\r\n    result = func(*args)\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\urllib2.py\", line 1228, in http_open\r\n    return self.do_open(httplib.HTTPConnection, req)\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\urllib2.py\", line 1195, in do_open\r\n    h.request(req.get_method(), req.get_selector(), req.data, headers)\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\httplib.py\", line 1042, in request\r\n    self._send_request(method, url, body, headers)\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\httplib.py\", line 1082, in _send_request\r\n    self.endheaders(body)\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\httplib.py\", line 1038, in endheaders\r\n    self._send_output(message_body)\r\n  File \"C:\\ProgramData\\Anaconda2\\lib\\httplib.py\", line 880, in _send_output\r\n    msg += message_body\r\nUnicodeDecodeError: 'ascii' codec can't decode byte 0xe0 in position 277: ordinal not in range(128)\n```\n\nThis does not occur when removing the `unicode_literals` import.", "markup": "markdown", "html": "<p>Turns out I was unable to reproduce the bug because I was testing this in Python 3. In Python 2, I still get this traceback during <code>transition_to_buffered</code>:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"mi\">2018</span><span class=\"o\">-</span><span class=\"mo\">07</span><span class=\"o\">-</span><span class=\"mi\">31</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">35</span><span class=\"p\">:</span><span class=\"mo\">05</span><span class=\"p\">,</span><span class=\"mi\">697</span> <span class=\"n\">ERROR</span> <span class=\"n\">BLACS</span><span class=\"o\">.</span><span class=\"n\">rf_blaster_2_main_worker</span><span class=\"o\">.</span><span class=\"n\">worker</span><span class=\"p\">:</span> <span class=\"ne\">Exception</span> <span class=\"ow\">in</span> <span class=\"n\">job</span><span class=\"p\">:</span>\n<span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\labscript_suite\\labscript_devices\\RFBlaster.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">418</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">transition_to_buffered</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">http_request</span><span class=\"p\">(</span><span class=\"n\">form</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\labscript_suite\\labscript_devices\\RFBlaster.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">454</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">http_request</span>\n    <span class=\"n\">page</span> <span class=\"o\">=</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">urlopen</span><span class=\"p\">(</span><span class=\"n\">req</span><span class=\"p\">,</span> <span class=\"n\">timeout</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">timeout</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">readlines</span><span class=\"p\">())</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\urllib2.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">154</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">urlopen</span>\n    <span class=\"k\">return</span> <span class=\"n\">opener</span><span class=\"o\">.</span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">timeout</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\urllib2.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">429</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"nb\">open</span>\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_open</span><span class=\"p\">(</span><span class=\"n\">req</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\urllib2.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">447</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_open</span>\n    <span class=\"s1\">&#39;_open&#39;</span><span class=\"p\">,</span> <span class=\"n\">req</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\urllib2.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">407</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_call_chain</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">func</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\urllib2.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1228</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">http_open</span>\n    <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">do_open</span><span class=\"p\">(</span><span class=\"n\">httplib</span><span class=\"o\">.</span><span class=\"n\">HTTPConnection</span><span class=\"p\">,</span> <span class=\"n\">req</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\urllib2.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1195</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">do_open</span>\n    <span class=\"n\">h</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"p\">(</span><span class=\"n\">req</span><span class=\"o\">.</span><span class=\"n\">get_method</span><span class=\"p\">(),</span> <span class=\"n\">req</span><span class=\"o\">.</span><span class=\"n\">get_selector</span><span class=\"p\">(),</span> <span class=\"n\">req</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">headers</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\httplib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1042</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">request</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_send_request</span><span class=\"p\">(</span><span class=\"n\">method</span><span class=\"p\">,</span> <span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">body</span><span class=\"p\">,</span> <span class=\"n\">headers</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\httplib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1082</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_send_request</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">endheaders</span><span class=\"p\">(</span><span class=\"n\">body</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\httplib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1038</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">endheaders</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_send_output</span><span class=\"p\">(</span><span class=\"n\">message_body</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\ProgramData\\Anaconda2\\lib\\httplib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">880</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_send_output</span>\n    <span class=\"n\">msg</span> <span class=\"o\">+=</span> <span class=\"n\">message_body</span>\n<span class=\"ne\">UnicodeDecodeError</span><span class=\"p\">:</span> <span class=\"s1\">&#39;ascii&#39;</span> <span class=\"n\">codec</span> <span class=\"n\">can</span><span class=\"s1\">&#39;t decode byte 0xe0 in position 277: ordinal not in range(128)</span>\n</pre></div>\n\n\n<p>This does not occur when removing the <code>unicode_literals</code> import.</p>", "type": "rendered"}, "created_on": "2018-07-31T04:41:24.175057+00:00", "user": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, "updated_on": "2018-07-31T04:41:24.183648+00:00", "type": "pullrequest_comment", "id": 71478694}