{"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/43/comments/78862474.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/43/_/diff#comment-78862474"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 43, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/43.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/43"}}, "title": "LightCrafter"}, "content": {"raw": "I was looking at this again today.\n\n`ImageSet.expand_timeseries` needs fixing as per your comment \\(in the code\\) suggesting it will break if you ramp on another channel at the same time as updating the image. \n\nI'm not sure whether we should try and risk modifying `fastflatten` \\(which would mean replacing the two calls to `iterable(element)` with `isinstance(element, (array, list))`\\) or just add more logic to `ImageSet.expand_timeseries` following the base class implementation, but ignoring the section for when the instruction is a `dict` and modifying the remaining code to not need to use fastflatten \\(which probably means extending a numpy array dynamically within a loop over `all_times`\\).\n\nThe first option is probably better, but maybe @cbillington could say whether he sees any unforseen consequences of doing what I suggest?  \n\nAlso, you should set the dtype attribute of `ImageSet`. That probably depends on the size of the image though, so maybe should also be set by the parent in `add_device`?", "markup": "markdown", "html": "<p>I was looking at this again today.</p>\n<p><code>ImageSet.expand_timeseries</code> needs fixing as per your comment (in the code) suggesting it will break if you ramp on another channel at the same time as updating the image. </p>\n<p>I'm not sure whether we should try and risk modifying <code>fastflatten</code> (which would mean replacing the two calls to <code>iterable(element)</code> with <code>isinstance(element, (array, list))</code>) or just add more logic to <code>ImageSet.expand_timeseries</code> following the base class implementation, but ignoring the section for when the instruction is a <code>dict</code> and modifying the remaining code to not need to use fastflatten (which probably means extending a numpy array dynamically within a loop over <code>all_times</code>).</p>\n<p>The first option is probably better, but maybe @cbillington could say whether he sees any unforseen consequences of doing what I suggest?  </p>\n<p>Also, you should set the dtype attribute of <code>ImageSet</code>. That probably depends on the size of the image though, so maybe should also be set by the parent in <code>add_device</code>?</p>", "type": "rendered"}, "created_on": "2018-10-12T01:06:48.638777+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2018-10-12T01:06:48.652536+00:00", "type": "pullrequest_comment", "id": 78862474}