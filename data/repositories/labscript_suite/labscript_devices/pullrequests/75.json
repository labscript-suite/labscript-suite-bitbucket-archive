{"rendered": {"description": {"raw": "## Symptoms\r\n\r\n* RfBlaster device drivers are not working under Py3. BLACS tabs read status but cannot set static freq/amp/phase on the kloned webserver. Nor can they seem to upload binary compiled DDS data to the RfB RAM. Suspect error is in RFBlaster.py multipart form POSTing code. \r\n\r\n## Bug\r\n\r\nProbably in string handling in assembling the HTTP POST request.\r\n\r\n## Solution\r\n\r\nChanged RFBlaster.py BLACStab to use [requests ](https://2.python-requests.org/en/master/)[packa](http://packa.ge)ge, rather than homebrewed multipart form uploader plus urllib2 and friends. Requests is the defacto standard web client library.\r\n\r\nI kept this python2 compatible \\(perhaps\\) up to the commit tagged as such. I didn\u2019t realise tags shouldn\u2019t be used intra-branch - sorry. \r\n\r\nAfter that, it\u2019s Python-3 only. I cleaned out a bunch of defunct code and the BLACS tab is shorter.\r\n\r\n## Testing\r\n\r\nStatic control works. Buffered works. Dipole laser, controlled by rfB0 AOMs, comes on and seems to do dipole evap ramp OK. Will test on atoms shortly.\r\n\r\n## Side effects\r\n\r\nI did not change any of the labscript class, or the h5 file write code. \r\n\r\nCode that reads rfblaster binary \u2018data\u2019 from h5 file change in final rev to remove h5deprecationwarning not to use .value but to use the \\[\\(\\)\\] syntax instead. Seems to work.\r\n\r\n## TODO\r\n\r\nWe are still using constant-length strings in h5 files to store BLOBs, whereas h5py new standard is to use OPAQUE h5 dtype for this. Eventually these will be \u201copen\u201dable a la files, and so could be passed directly to requests.", "markup": "markdown", "html": "<h2 id=\"markdown-header-symptoms\">Symptoms</h2>\n<ul>\n<li>RfBlaster device drivers are not working under Py3. BLACS tabs read status but cannot set static freq/amp/phase on the kloned webserver. Nor can they seem to upload binary compiled DDS data to the RfB RAM. Suspect error is in RFBlaster.py multipart form POSTing code. </li>\n</ul>\n<h2 id=\"markdown-header-bug\">Bug</h2>\n<p>Probably in string handling in assembling the HTTP POST request.</p>\n<h2 id=\"markdown-header-solution\">Solution</h2>\n<p>Changed RFBlaster.py BLACStab to use <a data-is-external-link=\"true\" href=\"https://2.python-requests.org/en/master/\" rel=\"nofollow\">requests </a><a data-is-external-link=\"true\" href=\"http://packa.ge\" rel=\"nofollow\">packa</a>ge, rather than homebrewed multipart form uploader plus urllib2 and friends. Requests is the defacto standard web client library.</p>\n<p>I kept this python2 compatible (perhaps) up to the commit tagged as such. I didn\u2019t realise tags shouldn\u2019t be used intra-branch - sorry. </p>\n<p>After that, it\u2019s Python-3 only. I cleaned out a bunch of defunct code and the BLACS tab is shorter.</p>\n<h2 id=\"markdown-header-testing\">Testing</h2>\n<p>Static control works. Buffered works. Dipole laser, controlled by rfB0 AOMs, comes on and seems to do dipole evap ramp OK. Will test on atoms shortly.</p>\n<h2 id=\"markdown-header-side-effects\">Side effects</h2>\n<p>I did not change any of the labscript class, or the h5 file write code. </p>\n<p>Code that reads rfblaster binary \u2018data\u2019 from h5 file change in final rev to remove h5deprecationwarning not to use .value but to use the [()] syntax instead. Seems to work.</p>\n<h2 id=\"markdown-header-todo\">TODO</h2>\n<p>We are still using constant-length strings in h5 files to store BLOBs, whereas h5py new standard is to use OPAQUE h5 dtype for this. Eventually these will be \u201copen\u201dable a la files, and so could be passed directly to requests.</p>", "type": "rendered"}, "title": {"raw": "RfBlasterPy3 bugfix", "markup": "markdown", "html": "<p>RfBlasterPy3 bugfix</p>", "type": "rendered"}}, "type": "pullrequest", "description": "## Symptoms\r\n\r\n* RfBlaster device drivers are not working under Py3. BLACS tabs read status but cannot set static freq/amp/phase on the kloned webserver. Nor can they seem to upload binary compiled DDS data to the RfB RAM. Suspect error is in RFBlaster.py multipart form POSTing code. \r\n\r\n## Bug\r\n\r\nProbably in string handling in assembling the HTTP POST request.\r\n\r\n## Solution\r\n\r\nChanged RFBlaster.py BLACStab to use [requests ](https://2.python-requests.org/en/master/)[packa](http://packa.ge)ge, rather than homebrewed multipart form uploader plus urllib2 and friends. Requests is the defacto standard web client library.\r\n\r\nI kept this python2 compatible \\(perhaps\\) up to the commit tagged as such. I didn\u2019t realise tags shouldn\u2019t be used intra-branch - sorry. \r\n\r\nAfter that, it\u2019s Python-3 only. I cleaned out a bunch of defunct code and the BLACS tab is shorter.\r\n\r\n## Testing\r\n\r\nStatic control works. Buffered works. Dipole laser, controlled by rfB0 AOMs, comes on and seems to do dipole evap ramp OK. Will test on atoms shortly.\r\n\r\n## Side effects\r\n\r\nI did not change any of the labscript class, or the h5 file write code. \r\n\r\nCode that reads rfblaster binary \u2018data\u2019 from h5 file change in final rev to remove h5deprecationwarning not to use .value but to use the \\[\\(\\)\\] syntax instead. Seems to work.\r\n\r\n## TODO\r\n\r\nWe are still using constant-length strings in h5 files to store BLOBs, whereas h5py new standard is to use OPAQUE h5 dtype for this. Eventually these will be \u201copen\u201dable a la files, and so could be passed directly to requests.", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/pullrequests/75/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/diffstat/labscript_suite/labscript_devices:b679acacbc1a%0Df55ba5a76098?from_pullrequest_id=75"}, "commits": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/75/commits.json"}, "self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/75.json"}, "comments": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/75/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/pullrequests/75/merge"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/75"}, "activity": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/75/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/diff/labscript_suite/labscript_devices:b679acacbc1a%0Df55ba5a76098?from_pullrequest_id=75"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/pullrequests/75/approve"}, "statuses": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/75/statuses_page=1.json"}}, "title": "RfBlasterPy3 bugfix", "close_source_branch": true, "reviewers": [{"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}], "id": 75, "destination": {"commit": {"hash": "f55ba5a76098", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/commit/f55ba5a76098.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/commits/f55ba5a76098"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices.json"}, "html": {"href": "#!/labscript_suite/labscript_devices"}, "avatar": {"href": "data/bytebucket.org/ravatar/{30c94cb1-feec-4534-8885-92452023c9c9}ts=python"}}, "type": "repository", "name": "labscript_devices", "full_name": "labscript_suite/labscript_devices", "uuid": "{30c94cb1-feec-4534-8885-92452023c9c9}"}, "branch": {"name": "default"}}, "created_on": "2019-06-27T06:24:11.633908+00:00", "summary": {"raw": "## Symptoms\r\n\r\n* RfBlaster device drivers are not working under Py3. BLACS tabs read status but cannot set static freq/amp/phase on the kloned webserver. Nor can they seem to upload binary compiled DDS data to the RfB RAM. Suspect error is in RFBlaster.py multipart form POSTing code. \r\n\r\n## Bug\r\n\r\nProbably in string handling in assembling the HTTP POST request.\r\n\r\n## Solution\r\n\r\nChanged RFBlaster.py BLACStab to use [requests ](https://2.python-requests.org/en/master/)[packa](http://packa.ge)ge, rather than homebrewed multipart form uploader plus urllib2 and friends. Requests is the defacto standard web client library.\r\n\r\nI kept this python2 compatible \\(perhaps\\) up to the commit tagged as such. I didn\u2019t realise tags shouldn\u2019t be used intra-branch - sorry. \r\n\r\nAfter that, it\u2019s Python-3 only. I cleaned out a bunch of defunct code and the BLACS tab is shorter.\r\n\r\n## Testing\r\n\r\nStatic control works. Buffered works. Dipole laser, controlled by rfB0 AOMs, comes on and seems to do dipole evap ramp OK. Will test on atoms shortly.\r\n\r\n## Side effects\r\n\r\nI did not change any of the labscript class, or the h5 file write code. \r\n\r\nCode that reads rfblaster binary \u2018data\u2019 from h5 file change in final rev to remove h5deprecationwarning not to use .value but to use the \\[\\(\\)\\] syntax instead. Seems to work.\r\n\r\n## TODO\r\n\r\nWe are still using constant-length strings in h5 files to store BLOBs, whereas h5py new standard is to use OPAQUE h5 dtype for this. Eventually these will be \u201copen\u201dable a la files, and so could be passed directly to requests.", "markup": "markdown", "html": "<h2 id=\"markdown-header-symptoms\">Symptoms</h2>\n<ul>\n<li>RfBlaster device drivers are not working under Py3. BLACS tabs read status but cannot set static freq/amp/phase on the kloned webserver. Nor can they seem to upload binary compiled DDS data to the RfB RAM. Suspect error is in RFBlaster.py multipart form POSTing code. </li>\n</ul>\n<h2 id=\"markdown-header-bug\">Bug</h2>\n<p>Probably in string handling in assembling the HTTP POST request.</p>\n<h2 id=\"markdown-header-solution\">Solution</h2>\n<p>Changed RFBlaster.py BLACStab to use <a data-is-external-link=\"true\" href=\"https://2.python-requests.org/en/master/\" rel=\"nofollow\">requests </a><a data-is-external-link=\"true\" href=\"http://packa.ge\" rel=\"nofollow\">packa</a>ge, rather than homebrewed multipart form uploader plus urllib2 and friends. Requests is the defacto standard web client library.</p>\n<p>I kept this python2 compatible (perhaps) up to the commit tagged as such. I didn\u2019t realise tags shouldn\u2019t be used intra-branch - sorry. </p>\n<p>After that, it\u2019s Python-3 only. I cleaned out a bunch of defunct code and the BLACS tab is shorter.</p>\n<h2 id=\"markdown-header-testing\">Testing</h2>\n<p>Static control works. Buffered works. Dipole laser, controlled by rfB0 AOMs, comes on and seems to do dipole evap ramp OK. Will test on atoms shortly.</p>\n<h2 id=\"markdown-header-side-effects\">Side effects</h2>\n<p>I did not change any of the labscript class, or the h5 file write code. </p>\n<p>Code that reads rfblaster binary \u2018data\u2019 from h5 file change in final rev to remove h5deprecationwarning not to use .value but to use the [()] syntax instead. Seems to work.</p>\n<h2 id=\"markdown-header-todo\">TODO</h2>\n<p>We are still using constant-length strings in h5 files to store BLOBs, whereas h5py new standard is to use OPAQUE h5 dtype for this. Eventually these will be \u201copen\u201dable a la files, and so could be passed directly to requests.</p>", "type": "rendered"}, "source": {"commit": {"hash": "4ce709c1b1f9", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/monashspinor/labscript_devices/commit/4ce709c1b1f9"}, "html": {"href": "#!/monashspinor/labscript_devices/commits/4ce709c1b1f9"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/monashspinor/labscript_devices"}, "html": {"href": "#!/monashspinor/labscript_devices"}, "avatar": {"href": "data/bytebucket.org/ravatar/{be4c7d93-6a88-4228-b761-162375a0fb62}ts=python"}}, "type": "repository", "name": "labscript_devices", "full_name": "monashspinor/labscript_devices", "uuid": "{be4c7d93-6a88-4228-b761-162375a0fb62}"}, "branch": {"name": "RfBlasterPy3-bugfix"}}, "comment_count": 7, "state": "MERGED", "task_count": 0, "participants": [{"role": "PARTICIPANT", "participated_on": "2019-07-06T11:44:55.278089+00:00", "type": "participant", "approved": false, "user": {"display_name": "Lincoln Turner", "uuid": "{7e35ca32-09d7-4a25-a548-32edef727dda}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B7e35ca32-09d7-4a25-a548-32edef727dda%7D"}, "html": {"href": "https://bitbucket.org/%7B7e35ca32-09d7-4a25-a548-32edef727dda%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/2ac774c664cd58fc011cc65e0980b4c1d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsLT-3.png"}}, "nickname": "lincolndturner", "type": "user", "account_id": "5b46a53d845e7e2cdff75ad3"}}, {"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}}, {"role": "REVIEWER", "participated_on": "2019-07-05T18:24:03.637860+00:00", "type": "participant", "approved": true, "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}, {"role": "PARTICIPANT", "participated_on": "2019-07-05T06:35:04.193200+00:00", "type": "participant", "approved": false, "user": {"display_name": "Shaun Johnstone", "uuid": "{652df738-313d-472c-b7b5-a3f8f98a3322}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D"}, "html": {"href": "https://bitbucket.org/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/38984f1761fc67ce892911496abee619d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSJ-3.png"}}, "nickname": "shjohnst", "type": "user", "account_id": "557058:1b9a15fb-8e4f-407e-b7b9-567c5e1fa1b4"}}], "reason": "", "updated_on": "2019-07-06T11:44:55.278089+00:00", "author": {"display_name": "Lincoln Turner", "uuid": "{7e35ca32-09d7-4a25-a548-32edef727dda}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B7e35ca32-09d7-4a25-a548-32edef727dda%7D"}, "html": {"href": "https://bitbucket.org/%7B7e35ca32-09d7-4a25-a548-32edef727dda%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/2ac774c664cd58fc011cc65e0980b4c1d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsLT-3.png"}}, "nickname": "lincolndturner", "type": "user", "account_id": "5b46a53d845e7e2cdff75ad3"}, "merge_commit": {"hash": "b679acacbc1a", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/commit/b679acacbc1a.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/commits/b679acacbc1a"}}}, "closed_by": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}