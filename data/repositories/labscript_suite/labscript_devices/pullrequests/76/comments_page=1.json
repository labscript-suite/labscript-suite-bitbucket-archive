{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/76/comments/108462399.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/76/_/diff#comment-108462399"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 76, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/76.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/76"}}, "title": "More flexible NI DAQmx wait monitor functionality."}, "content": {"raw": "So this is working, and we found a few issues running it in the lab over the last week that have now been resolved. They were minor bugs plus the fact that the PulseBlaster could not detect the end of a shot without a wait monitor unless it was using `programming_scheme='pb_stop_programming/STOP'`. So this PR is now not just the DAQmx devices, it's for compatibility of both DAQmx and PulseBlasters with wait monitors being optional.\n\nOne thing I'm not super sure about is allowing the timeout device to be a different device. Doing so means one worker is interacting with the hardware correspinding to a different device! This works, since NI DAQmx lets you just pass in the name of any device for a task, but it does introduce a race condition whereby the device using that channel in manual mode must transition to buffered mode (releasing its hold on the channel) before the wait monitor device transitions to buffered and tries to use the task. And similarly at the end of a shot with transition_to_buffered. This can easily be sidestepped by specifying start_order and stop_order to have the devices transition to buffered and manual mode in the right order, but this would need to be documented. I think I want to leave this functionality in, but document it. So I won't merge this until after writing about it in the docstring of the labscript device class.\n\nHappy to hear anyone else's opinions.", "markup": "markdown", "html": "<p>So this is working, and we found a few issues running it in the lab over the last week that have now been resolved. They were minor bugs plus the fact that the PulseBlaster could not detect the end of a shot without a wait monitor unless it was using <code>programming_scheme='pb_stop_programming/STOP'</code>. So this PR is now not just the DAQmx devices, it's for compatibility of both DAQmx and PulseBlasters with wait monitors being optional.</p>\n<p>One thing I'm not super sure about is allowing the timeout device to be a different device. Doing so means one worker is interacting with the hardware correspinding to a different device! This works, since NI DAQmx lets you just pass in the name of any device for a task, but it does introduce a race condition whereby the device using that channel in manual mode must transition to buffered mode (releasing its hold on the channel) before the wait monitor device transitions to buffered and tries to use the task. And similarly at the end of a shot with transition_to_buffered. This can easily be sidestepped by specifying start_order and stop_order to have the devices transition to buffered and manual mode in the right order, but this would need to be documented. I think I want to leave this functionality in, but document it. So I won't merge this until after writing about it in the docstring of the labscript device class.</p>\n<p>Happy to hear anyone else's opinions.</p>", "type": "rendered"}, "created_on": "2019-07-08T16:35:52.451304+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2019-07-08T16:35:52.459722+00:00", "type": "pullrequest_comment", "id": 108462399}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/76/comments/127542423.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/76/_/diff#comment-127542423"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 76, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/76.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/76"}}, "title": "More flexible NI DAQmx wait monitor functionality."}, "content": {"raw": "Done. Rather than just document it, the issue is now enforced by code that checks start\\_order and stop\\_order at compile time.\n\nAnd I was bitten by not having the PulseBlaster detecting end-of-experiment without a wait monitor because I forgot that code was here\u2026\n\nmerging.", "markup": "markdown", "html": "<p>Done. Rather than just document it, the issue is now enforced by code that checks start_order and stop_order at compile time.</p>\n<p>And I was bitten by not having the PulseBlaster detecting end-of-experiment without a wait monitor because I forgot that code was here\u2026</p>\n<p>merging.</p>", "type": "rendered"}, "created_on": "2019-12-05T05:38:53.629592+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2019-12-05T05:38:53.637984+00:00", "type": "pullrequest_comment", "id": 127542423}], "page": 1, "size": 2}