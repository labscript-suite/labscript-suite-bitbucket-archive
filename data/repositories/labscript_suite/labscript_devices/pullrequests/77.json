{"rendered": {"description": {"raw": "If restart was clicked whilst continuously acquiring, the ImageReceiver could\r\nbe waiting on the previous frame to be updated, and thus would not respond to\r\nthe request to shutdown. However since shutdown() was called from the main thread,\r\nit would be waiting forever.\r\n\r\nNow it regularly checks self.stopping (an attribute set bt the parent class\r\nzprocess.ZMQServer when a shutdown has been requested) while waiting for the\r\nupdate event to process, so that it does not deadlock.\r\n\r\nAlso, if the update event runs but finds that it has already been shut down,\r\nit does nothing, since the Qt widgets may have been destroyed already.\r\n\r\nI found this bug whilst trying to reproduce issue #36, but this seems different so is probably not a solution to that issue.", "markup": "markdown", "html": "<p>If restart was clicked whilst continuously acquiring, the ImageReceiver could\nbe waiting on the previous frame to be updated, and thus would not respond to\nthe request to shutdown. However since shutdown() was called from the main thread,\nit would be waiting forever.</p>\n<p>Now it regularly checks self.stopping (an attribute set bt the parent class\nzprocess.ZMQServer when a shutdown has been requested) while waiting for the\nupdate event to process, so that it does not deadlock.</p>\n<p>Also, if the update event runs but finds that it has already been shut down,\nit does nothing, since the Qt widgets may have been destroyed already.</p>\n<p>I found this bug whilst trying to reproduce issue <a href=\"#!/labscript_suite/labscript_devices/issues/36/blacs-hang-with-continuous-camera\" rel=\"nofollow\" title=\"BLACS hang with continuous camera acquisitions\" class=\"ap-connect-link\"><s>#36</s></a>, but this seems different so is probably not a solution to that issue.</p>", "type": "rendered"}, "title": {"raw": "Fix a deadlock restarting IMAQdxCamera.", "markup": "markdown", "html": "<p>Fix a deadlock restarting IMAQdxCamera.</p>", "type": "rendered"}}, "type": "pullrequest", "description": "If restart was clicked whilst continuously acquiring, the ImageReceiver could\r\nbe waiting on the previous frame to be updated, and thus would not respond to\r\nthe request to shutdown. However since shutdown() was called from the main thread,\r\nit would be waiting forever.\r\n\r\nNow it regularly checks self.stopping (an attribute set bt the parent class\r\nzprocess.ZMQServer when a shutdown has been requested) while waiting for the\r\nupdate event to process, so that it does not deadlock.\r\n\r\nAlso, if the update event runs but finds that it has already been shut down,\r\nit does nothing, since the Qt widgets may have been destroyed already.\r\n\r\nI found this bug whilst trying to reproduce issue #36, but this seems different so is probably not a solution to that issue.", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/pullrequests/77/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/diffstat/labscript_suite/labscript_devices:962e4d3229d8%0Db679acacbc1a?from_pullrequest_id=77"}, "commits": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/77/commits.json"}, "self": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/77.json"}, "comments": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/77/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/pullrequests/77/merge"}, "html": {"href": "#!/labscript_suite/labscript_devices/pull-requests/77"}, "activity": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/77/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/diff/labscript_suite/labscript_devices:962e4d3229d8%0Db679acacbc1a?from_pullrequest_id=77"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_devices/pullrequests/77/approve"}, "statuses": {"href": "data/repositories/labscript_suite/labscript_devices/pullrequests/77/statuses_page=1.json"}}, "title": "Fix a deadlock restarting IMAQdxCamera.", "close_source_branch": true, "reviewers": [{"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, {"display_name": "Philip Starkey", "uuid": "{0147401a-13ed-4e39-a0d0-63108c18738b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D"}, "html": {"href": "https://bitbucket.org/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/fa0698c306b3470c00717c146b5296e9d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "philipstarkey", "type": "user", "account_id": "557058:2f99420c-1dbd-4837-952c-82c421b8fbdd"}], "id": 77, "destination": {"commit": {"hash": "b679acacbc1a", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/commit/b679acacbc1a.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/commits/b679acacbc1a"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices.json"}, "html": {"href": "#!/labscript_suite/labscript_devices"}, "avatar": {"href": "data/bytebucket.org/ravatar/{30c94cb1-feec-4534-8885-92452023c9c9}ts=python"}}, "type": "repository", "name": "labscript_devices", "full_name": "labscript_suite/labscript_devices", "uuid": "{30c94cb1-feec-4534-8885-92452023c9c9}"}, "branch": {"name": "default"}}, "created_on": "2019-07-03T20:36:54.399654+00:00", "summary": {"raw": "If restart was clicked whilst continuously acquiring, the ImageReceiver could\r\nbe waiting on the previous frame to be updated, and thus would not respond to\r\nthe request to shutdown. However since shutdown() was called from the main thread,\r\nit would be waiting forever.\r\n\r\nNow it regularly checks self.stopping (an attribute set bt the parent class\r\nzprocess.ZMQServer when a shutdown has been requested) while waiting for the\r\nupdate event to process, so that it does not deadlock.\r\n\r\nAlso, if the update event runs but finds that it has already been shut down,\r\nit does nothing, since the Qt widgets may have been destroyed already.\r\n\r\nI found this bug whilst trying to reproduce issue #36, but this seems different so is probably not a solution to that issue.", "markup": "markdown", "html": "<p>If restart was clicked whilst continuously acquiring, the ImageReceiver could\nbe waiting on the previous frame to be updated, and thus would not respond to\nthe request to shutdown. However since shutdown() was called from the main thread,\nit would be waiting forever.</p>\n<p>Now it regularly checks self.stopping (an attribute set bt the parent class\nzprocess.ZMQServer when a shutdown has been requested) while waiting for the\nupdate event to process, so that it does not deadlock.</p>\n<p>Also, if the update event runs but finds that it has already been shut down,\nit does nothing, since the Qt widgets may have been destroyed already.</p>\n<p>I found this bug whilst trying to reproduce issue <a href=\"#!/labscript_suite/labscript_devices/issues/36/blacs-hang-with-continuous-camera\" rel=\"nofollow\" title=\"BLACS hang with continuous camera acquisitions\" class=\"ap-connect-link\"><s>#36</s></a>, but this seems different so is probably not a solution to that issue.</p>", "type": "rendered"}, "source": {"commit": {"hash": "453cc019b61b", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/labscript_devices/commit/453cc019b61b"}, "html": {"href": "#!/cbillington/labscript_devices/commits/453cc019b61b"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/labscript_devices"}, "html": {"href": "#!/cbillington/labscript_devices"}, "avatar": {"href": "data/bytebucket.org/ravatar/{a2db461e-24e6-495e-a15d-8b80435f721e}ts=python"}}, "type": "repository", "name": "labscript_devices", "full_name": "cbillington/labscript_devices", "uuid": "{a2db461e-24e6-495e-a15d-8b80435f721e}"}, "branch": {"name": "bugfix"}}, "comment_count": 0, "state": "MERGED", "task_count": 0, "participants": [{"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}}, {"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Philip Starkey", "uuid": "{0147401a-13ed-4e39-a0d0-63108c18738b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D"}, "html": {"href": "https://bitbucket.org/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/fa0698c306b3470c00717c146b5296e9d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "philipstarkey", "type": "user", "account_id": "557058:2f99420c-1dbd-4837-952c-82c421b8fbdd"}}], "reason": "", "updated_on": "2019-07-08T16:36:12.244673+00:00", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "merge_commit": {"hash": "962e4d3229d8", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/labscript_devices/commit/962e4d3229d8.json"}, "html": {"href": "#!/labscript_suite/labscript_devices/commits/962e4d3229d8"}}}, "closed_by": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}