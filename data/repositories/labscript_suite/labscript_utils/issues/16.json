{"priority": "critical", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils.json"}, "html": {"href": "#!/labscript_suite/labscript_utils"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68347210-fb1e-4b58-86c0-bd2c04396e63}ts=249922"}}, "type": "repository", "name": "labscript_utils", "full_name": "labscript_suite/labscript_utils", "uuid": "{68347210-fb1e-4b58-86c0-bd2c04396e63}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/labscript_utils/issues/16/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/labscript_utils/issues/16.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/issues/16/watch"}, "comments": {"href": "data/repositories/labscript_suite/labscript_utils/issues/16/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/issues/16/double-import-denier-breaks-python3-stuff"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/issues/16/vote"}}, "reporter": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "title": "Double import denier breaks python3 stuff", "component": null, "votes": 0, "watches": 1, "content": {"raw": "In modules where labscrupt_utils is imported the command ```python -m module_name_here``` leads to a exception:\r\n\r\n```\r\n#!python\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/janwerkmann/anaconda/envs/snowflakes/lib/python3.6/runpy.py\", line 185, in _run_module_as_main\r\n    mod_name, mod_spec, code = _get_module_details(mod_name, _Error)\r\n  File \"/Users/janwerkmann/anaconda/envs/snowflakes/lib/python3.6/runpy.py\", line 142, in _get_module_details\r\n    return _get_module_details(pkg_main_name, error)\r\n  File \"/Users/janwerkmann/anaconda/envs/snowflakes/lib/python3.6/runpy.py\", line 155, in _get_module_details\r\n    code = loader.get_code(mod_name)\r\n\r\n```\r\n\r\nI did a bit of debugging and it seems to be caused by loader being of type <labscript_utils.double_import_denier.Loader object at 0x10e910438>. So we should maybe fix that for python 3 compat. \r\nFun fact ```python filepath_to_module``` still works.", "markup": "markdown", "html": "<p>In modules where labscrupt_utils is imported the command <code>python -m module_name_here</code> leads to a exception:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/envs/snowflakes/lib/python3.6/runpy.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">185</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_run_module_as_main</span>\n    <span class=\"n\">mod_name</span><span class=\"p\">,</span> <span class=\"n\">mod_spec</span><span class=\"p\">,</span> <span class=\"n\">code</span> <span class=\"o\">=</span> <span class=\"n\">_get_module_details</span><span class=\"p\">(</span><span class=\"n\">mod_name</span><span class=\"p\">,</span> <span class=\"n\">_Error</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/envs/snowflakes/lib/python3.6/runpy.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">142</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_get_module_details</span>\n    <span class=\"k\">return</span> <span class=\"n\">_get_module_details</span><span class=\"p\">(</span><span class=\"n\">pkg_main_name</span><span class=\"p\">,</span> <span class=\"n\">error</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/envs/snowflakes/lib/python3.6/runpy.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">155</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_get_module_details</span>\n    <span class=\"n\">code</span> <span class=\"o\">=</span> <span class=\"n\">loader</span><span class=\"o\">.</span><span class=\"n\">get_code</span><span class=\"p\">(</span><span class=\"n\">mod_name</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>I did a bit of debugging and it seems to be caused by loader being of type &lt;labscript_utils.double_import_denier.Loader object at 0x10e910438&gt;. So we should maybe fix that for python 3 compat. \nFun fact <code>python filepath_to_module</code> still works.</p>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2018-03-21T10:58:53.743882+00:00", "milestone": null, "updated_on": "2018-03-22T06:07:50.911116+00:00", "type": "issue", "id": 16}