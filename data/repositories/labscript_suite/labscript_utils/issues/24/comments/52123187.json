{"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/issues/24/comments/52123187.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/issues/24#comment-52123187"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/issues/24.json"}}, "type": "issue", "id": 24, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils.json"}, "html": {"href": "#!/labscript_suite/labscript_utils"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68347210-fb1e-4b58-86c0-bd2c04396e63}ts=249922"}}, "type": "repository", "name": "labscript_utils", "full_name": "labscript_suite/labscript_utils", "uuid": "{68347210-fb1e-4b58-86c0-bd2c04396e63}"}, "title": "Can't save integer connection table properties that come from globals"}, "content": {"raw": "The bug report for Python is here:\n\nhttps://bugs.python.org/issue24313\n\nThe cause is that numpy integers do not inherit from Python integers on Python 3, because Python integers no longer have a fixed size. In Python 2 there were ints and long ints, and the matching numpy dtypes inherited from them. But no such thing is possible in Python 3. Some cooperation between numpy and Python could make it work, but the bug report is old and there is a decent workaround, so I suspect no fix is coming any time soon.\n\nThe workaround is this:\n\n```\ndef default(o):\n    if isinstance(o, np.integer): return int(o)\n    raise TypeError\n\nimport json\nimport numpy as np\njson.dumps([np.int64(0)], default=default)\n```\n\nI'll make the change to `labscript_utils.properties`.", "markup": "markdown", "html": "<p>The bug report for Python is here:</p>\n<p><a href=\"https://bugs.python.org/issue24313\" rel=\"nofollow\" class=\"ap-connect-link\">https://bugs.python.org/issue24313</a></p>\n<p>The cause is that numpy integers do not inherit from Python integers on Python 3, because Python integers no longer have a fixed size. In Python 2 there were ints and long ints, and the matching numpy dtypes inherited from them. But no such thing is possible in Python 3. Some cooperation between numpy and Python could make it work, but the bug report is old and there is a decent workaround, so I suspect no fix is coming any time soon.</p>\n<p>The workaround is this:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">default</span><span class=\"p\">(</span><span class=\"n\">o</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">integer</span><span class=\"p\">):</span> <span class=\"k\">return</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">o</span><span class=\"p\">)</span>\n    <span class=\"k\">raise</span> <span class=\"ne\">TypeError</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">json</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"kn\">as</span> <span class=\"nn\">np</span>\n<span class=\"n\">json</span><span class=\"o\">.</span><span class=\"kp\">dumps</span><span class=\"p\">([</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">int64</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)],</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"n\">default</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>I'll make the change to <code>labscript_utils.properties</code>.</p>", "type": "rendered"}, "created_on": "2019-05-14T14:55:31.183325+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 52123187}