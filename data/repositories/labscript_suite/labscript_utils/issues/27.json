{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils.json"}, "html": {"href": "#!/labscript_suite/labscript_utils"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68347210-fb1e-4b58-86c0-bd2c04396e63}ts=249922"}}, "type": "repository", "name": "labscript_utils", "full_name": "labscript_suite/labscript_utils", "uuid": "{68347210-fb1e-4b58-86c0-bd2c04396e63}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/labscript_utils/issues/27/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/labscript_utils/issues/27.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/issues/27/watch"}, "comments": {"href": "data/repositories/labscript_suite/labscript_utils/issues/27/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/issues/27/toolpalette_layout_widgets-appears-to"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/issues/27/vote"}}, "reporter": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "title": "ToolPalette._layout_widgets() appears to recurse, causing a stack overflow", "component": null, "votes": 0, "watches": 1, "content": {"raw": "A lab here at NIST got a \"Python has stopped working\" error upon starting BLACS today. Starting Python as `python -X faulthander -m blacs` revealed it to be a stack overflow in `ToolPalette._layout_widgets()`, line 348:\r\n```\r\nself.setMinimumSize(QSize(self.minimumSize().width(), total_height))\r\n```\r\n\r\nAdding a printline to inspect the dimensions of the `QSize()` object revealed that `_layout_widgets()` was being called a large number of times prior to the crash, with the dimensions alternating back and forth between two values. \r\n\r\nI added a counter to print the recursion depth and confirm that the method is recursing, but I made a syntax error and BLACS started successfully (having caught the error), modifying its save file and widget geometries such that the stack overflow no longer occurred. So unfortunately I lost the ability to reproduce the problem, as it is sensitive to the widget geometries.\r\n\r\nJust documenting what I found here. `ToolPalette._layout_widgets()` seems to be recursing and not converging on a fixed layout geometry that would break the cycle. If I see it again I will backup BLACS save file and connection table file to create a reliable reproducer of the problem.\r\n\r\nOthers have reported similar crashes before, but they have not been stack overflows, they have been segfaults that looked to be bugs in Qt. This one actually is plausibly our fault which means we may be able to fix it.", "markup": "markdown", "html": "<p>A lab here at NIST got a \"Python has stopped working\" error upon starting BLACS today. Starting Python as <code>python -X faulthander -m blacs</code> revealed it to be a stack overflow in <code>ToolPalette._layout_widgets()</code>, line 348:</p>\n<div class=\"codehilite\"><pre><span></span>self.setMinimumSize(QSize(self.minimumSize().width(), total_height))\n</pre></div>\n\n\n<p>Adding a printline to inspect the dimensions of the <code>QSize()</code> object revealed that <code>_layout_widgets()</code> was being called a large number of times prior to the crash, with the dimensions alternating back and forth between two values. </p>\n<p>I added a counter to print the recursion depth and confirm that the method is recursing, but I made a syntax error and BLACS started successfully (having caught the error), modifying its save file and widget geometries such that the stack overflow no longer occurred. So unfortunately I lost the ability to reproduce the problem, as it is sensitive to the widget geometries.</p>\n<p>Just documenting what I found here. <code>ToolPalette._layout_widgets()</code> seems to be recursing and not converging on a fixed layout geometry that would break the cycle. If I see it again I will backup BLACS save file and connection table file to create a reliable reproducer of the problem.</p>\n<p>Others have reported similar crashes before, but they have not been stack overflows, they have been segfaults that looked to be bugs in Qt. This one actually is plausibly our fault which means we may be able to fix it.</p>", "type": "rendered"}, "assignee": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "state": "new", "version": null, "edited_on": null, "created_on": "2019-10-30T21:03:28.643792+00:00", "milestone": null, "updated_on": "2019-10-31T13:39:22.089138+00:00", "type": "issue", "id": 27}