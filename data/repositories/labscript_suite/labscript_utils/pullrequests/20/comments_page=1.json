{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/41962242.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-41962242"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 20, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20"}}, "title": "qtutils 2.0.0 support and experimental PyQt5 support"}, "content": {"raw": "No problems show up in Qt4 for me so far.\n\nIn Qt5 I'm finding it extremely easy to \"lose\" tabs in BLACS when dragging them around (which is a problem with the dragdroptab in labscript_utils.qtwidgets). This bug exists in PyQt4 as well but seems far easier to trigger by accident in PyQt5. I have worked out how to make it happen reliably on both Qt4 and Qt5 though (at least on my system), so I'll file an issue. I thought there was an issue filed about it already but I think it was slightly different, so I'll file another one and maybe have a go at fixing it.\n\nThe issue exists in PyQt4 regardless of this pull request so I don't think it should block merging this.", "markup": "markdown", "html": "<p>No problems show up in Qt4 for me so far.</p>\n<p>In Qt5 I'm finding it extremely easy to \"lose\" tabs in BLACS when dragging them around (which is a problem with the dragdroptab in labscript_utils.qtwidgets). This bug exists in PyQt4 as well but seems far easier to trigger by accident in PyQt5. I have worked out how to make it happen reliably on both Qt4 and Qt5 though (at least on my system), so I'll file an issue. I thought there was an issue filed about it already but I think it was slightly different, so I'll file another one and maybe have a go at fixing it.</p>\n<p>The issue exists in PyQt4 regardless of this pull request so I don't think it should block merging this.</p>", "type": "rendered"}, "created_on": "2017-08-02T01:36:06.321159+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-08-02T01:36:06.324629+00:00", "type": "pullrequest_comment", "id": 41962242}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/41976836.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-41976836"}}, "parent": {"id": 41962242, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/41962242.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-41962242"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 20, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20"}}, "title": "qtutils 2.0.0 support and experimental PyQt5 support"}, "content": {"raw": "Might this be linked to #13 in some way? \n\nAlso whats the reproducible way of creating the bug? I'd also like to do some testing.", "markup": "markdown", "html": "<p>Might this be linked to <a href=\"#!/labscript_suite/labscript_utils/issues/13/dragdroptabs-behave-strange\" rel=\"nofollow\" title=\"dragdroptabs behave strange\" class=\"ap-connect-link\"><s>#13</s></a> in some way? </p>\n<p>Also whats the reproducible way of creating the bug? I'd also like to do some testing.</p>", "type": "rendered"}, "created_on": "2017-08-02T07:43:08.928787+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2017-08-02T07:43:44.498363+00:00", "type": "pullrequest_comment", "id": 41976836}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/42024447.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-42024447"}}, "parent": {"id": 41976836, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/41976836.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-41976836"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 20, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20"}}, "title": "qtutils 2.0.0 support and experimental PyQt5 support"}, "content": {"raw": "Actually I lied - I really thought I had it reproducible, but it turned out not to be the case.\n\nNo, I think it's separate from that issue - that issue seems to be just that macOS allows dragging tabs that aren't the current tab, whereas on other platforms clicking and dragging a tab always makes it the current tab. The code assumes it's the current tab being dragged when actually it might not be on macOS. I think that one's easily fixed.\n\nPhil (who wrote it) is aware it has issues and requires some reworking, and I was playing with it last night and familiarised myself with what's going on mostly, and so I might be able to help fix both issues.", "markup": "markdown", "html": "<p>Actually I lied - I really thought I had it reproducible, but it turned out not to be the case.</p>\n<p>No, I think it's separate from that issue - that issue seems to be just that macOS allows dragging tabs that aren't the current tab, whereas on other platforms clicking and dragging a tab always makes it the current tab. The code assumes it's the current tab being dragged when actually it might not be on macOS. I think that one's easily fixed.</p>\n<p>Phil (who wrote it) is aware it has issues and requires some reworking, and I was playing with it last night and familiarised myself with what's going on mostly, and so I might be able to help fix both issues.</p>", "type": "rendered"}, "created_on": "2017-08-02T15:51:20.647518+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-08-02T15:51:20.652064+00:00", "type": "pullrequest_comment", "id": 42024447}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/42034605.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-42034605"}}, "parent": {"id": 42024447, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/42024447.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-42024447"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 20, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20"}}, "title": "qtutils 2.0.0 support and experimental PyQt5 support"}, "content": {"raw": "If you've figured out more or fixed it I'd be interested in what's causing the problem of losing tabs.", "markup": "markdown", "html": "<p>If you've figured out more or fixed it I'd be interested in what's causing the problem of losing tabs.</p>", "type": "rendered"}, "created_on": "2017-08-02T17:58:08.612670+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2017-08-02T17:58:08.663750+00:00", "type": "pullrequest_comment", "id": 42034605}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/42119530.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-42119530"}}, "parent": {"id": 42034605, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/42034605.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-42034605"}}, "depth": 4}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 20, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20"}}, "title": "qtutils 2.0.0 support and experimental PyQt5 support"}, "content": {"raw": "I made another implementation of drag-drop tabs based on Phil's code, and I'm not sure what was wrong in PyQt4 but my reimplementation doesn't appear to have remaining problems problem there (in linux at least). The remaining problem in PyQt5 is that events are being processed re-entrantly. That is, if during event processing (for a 'drag enter' for example), you call code that manipulates the GUI (like adding a tab), this can trigger further events that will be processed immediately, and so the event handler you are already running may be called again, essentially recursively. This can invalidate state that original event handler  was assuming, such as instance attributes and the state of the GUI itself.\n\nSo the code needs to be written with the possibility of re-entrancy in mind. I might try something like a context manager that catches the drag events and defers processing them until after the context exits, or something like that, or otherwise make the code re-check its assumptions before acting everywhere it is relevant. This drag-drop tab stuff is definitely non-trivial! There's a reason you don't find draggable tabs in any open source Qt projects if you go looking for them...\n\nThis re-entrancy could also possibly be considered a bug in Qt5 (ot PyQt5, I'm not sure). The [documentation for Qt](http://doc.qt.io/qt-5.6/qdragleaveevent.html) says for DragLeave events:\n\n> This event is always preceded by a QDragEnterEvent and a series of QDragMoveEvents. It is not sent if a QDropEvent is sent instead.\n\nWhich appears to not be true, since I seem to be pretty easily able to get the code to make multiple QDragLeave events without anything in between (without even finishing processing the previous QDragLeave).\n\nAnyway I think I should be able to fix it and hopefully have a robust dragdrop tab implementation by the end of it.", "markup": "markdown", "html": "<p>I made another implementation of drag-drop tabs based on Phil's code, and I'm not sure what was wrong in PyQt4 but my reimplementation doesn't appear to have remaining problems problem there (in linux at least). The remaining problem in PyQt5 is that events are being processed re-entrantly. That is, if during event processing (for a 'drag enter' for example), you call code that manipulates the GUI (like adding a tab), this can trigger further events that will be processed immediately, and so the event handler you are already running may be called again, essentially recursively. This can invalidate state that original event handler  was assuming, such as instance attributes and the state of the GUI itself.</p>\n<p>So the code needs to be written with the possibility of re-entrancy in mind. I might try something like a context manager that catches the drag events and defers processing them until after the context exits, or something like that, or otherwise make the code re-check its assumptions before acting everywhere it is relevant. This drag-drop tab stuff is definitely non-trivial! There's a reason you don't find draggable tabs in any open source Qt projects if you go looking for them...</p>\n<p>This re-entrancy could also possibly be considered a bug in Qt5 (ot PyQt5, I'm not sure). The <a data-is-external-link=\"true\" href=\"http://doc.qt.io/qt-5.6/qdragleaveevent.html\" rel=\"nofollow\">documentation for Qt</a> says for DragLeave events:</p>\n<blockquote>\n<p>This event is always preceded by a QDragEnterEvent and a series of QDragMoveEvents. It is not sent if a QDropEvent is sent instead.</p>\n</blockquote>\n<p>Which appears to not be true, since I seem to be pretty easily able to get the code to make multiple QDragLeave events without anything in between (without even finishing processing the previous QDragLeave).</p>\n<p>Anyway I think I should be able to fix it and hopefully have a robust dragdrop tab implementation by the end of it.</p>", "type": "rendered"}, "created_on": "2017-08-03T15:35:32.727408+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-08-03T15:35:32.731774+00:00", "type": "pullrequest_comment", "id": 42119530}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/42174543.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-42174543"}}, "parent": {"id": 42119530, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20/comments/42119530.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20/_/diff#comment-42119530"}}, "depth": 5}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 20, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/20.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/20"}}, "title": "qtutils 2.0.0 support and experimental PyQt5 support"}, "content": {"raw": "This is being addressed in pull request #21", "markup": "markdown", "html": "<p>This is being addressed in <a href=\"#!/labscript_suite/labscript_utils/pull-requests/21/dragdroptab\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #21</a></p>", "type": "rendered"}, "created_on": "2017-08-04T08:06:19.406499+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-08-04T08:06:19.410845+00:00", "type": "pullrequest_comment", "id": 42174543}], "page": 1, "size": 6}