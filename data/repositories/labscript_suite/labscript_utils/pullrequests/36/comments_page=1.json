{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59143833.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59143833"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 36, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36"}}, "title": "ConnectionTable improvements"}, "content": {"raw": "I'm not sure if `remove_device` is implemented correctly. It assumes that all BLACS tabs are top level devices, but that is not true as far as I'm aware. So I think that method will raise an exception in a lot of cases.\n\nIt might be good to outline what we want to achieve by removing the device from the connection table \\(so it's documented somewhere\\). I assume we are removing the device and all the children of that device from `self.table` but that we are leaving `self.raw_table` intact. I guess if the device is a top level device we should remove it from that list too. Do we also need to check if the device removed was the master pseudoclock and how do we handle that \\(and what roll-on effects does that have?\\).", "markup": "markdown", "html": "<p>I'm not sure if <code>remove_device</code> is implemented correctly. It assumes that all BLACS tabs are top level devices, but that is not true as far as I'm aware. So I think that method will raise an exception in a lot of cases.</p>\n<p>It might be good to outline what we want to achieve by removing the device from the connection table (so it's documented somewhere). I assume we are removing the device and all the children of that device from <code>self.table</code> but that we are leaving <code>self.raw_table</code> intact. I guess if the device is a top level device we should remove it from that list too. Do we also need to check if the device removed was the master pseudoclock and how do we handle that (and what roll-on effects does that have?).</p>", "type": "rendered"}, "created_on": "2018-03-19T02:41:07.356958+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2018-03-19T02:41:07.360897+00:00", "type": "pullrequest_comment", "id": 59143833}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59154664.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59154664"}}, "parent": {"id": 59143833, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59143833.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59143833"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 36, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36"}}, "title": "ConnectionTable improvements"}, "content": {"raw": "You are right I'll add a check for the key in `self.toplevel_children` before removing a device.\n\nRemove all child devices makes sense, I'll add that.\n\nI would leave `raw_table` intact independent of if the device was a top level device in order to keep the saved BLACS connection table the same. If we figure out later it is not that important to keep `self.raw_table` intact it should be easy to add that in later.\n\nNot sure, but I'll add a check and set `self.master_pseudoclock` to None just to be save.", "markup": "markdown", "html": "<p>You are right I'll add a check for the key in <code>self.toplevel_children</code> before removing a device.</p>\n<p>Remove all child devices makes sense, I'll add that.</p>\n<p>I would leave <code>raw_table</code> intact independent of if the device was a top level device in order to keep the saved BLACS connection table the same. If we figure out later it is not that important to keep <code>self.raw_table</code> intact it should be easy to add that in later.</p>\n<p>Not sure, but I'll add a check and set <code>self.master_pseudoclock</code> to None just to be save.</p>", "type": "rendered"}, "created_on": "2018-03-19T07:18:12.200730+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2018-03-19T07:18:12.255979+00:00", "type": "pullrequest_comment", "id": 59154664}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59154873.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59154873"}}, "parent": {"id": 59154664, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59154664.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59154664"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 36, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36"}}, "title": "ConnectionTable improvements"}, "content": {"raw": "Actually I'm not sure if we should remove child devices now... I'll think about it some more \\(or we can see what other people have to say\\)", "markup": "markdown", "html": "<p>Actually I'm not sure if we should remove child devices now... I'll think about it some more (or we can see what other people have to say)</p>", "type": "rendered"}, "created_on": "2018-03-19T07:21:06.867031+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2018-03-19T07:21:06.870145+00:00", "type": "pullrequest_comment", "id": 59154873}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59155638.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59155638"}}, "parent": {"id": 59154873, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59154873.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59154873"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 36, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36"}}, "title": "ConnectionTable improvements"}, "content": {"raw": "You are right removing children makes everything a lot more complex.\n\nExample:\n\nLets say that the Connectiontable contains a camera connected to a Parent Device. The parent device doesn't instantiate correctly, but BLACS already created the camera tab. This would lead to the camera being removed from the connectiontable but having a tab and that is a bad state to be in.", "markup": "markdown", "html": "<p>You are right removing children makes everything a lot more complex.</p>\n<p>Example:</p>\n<p>Lets say that the Connectiontable contains a camera connected to a Parent Device. The parent device doesn't instantiate correctly, but BLACS already created the camera tab. This would lead to the camera being removed from the connectiontable but having a tab and that is a bad state to be in.</p>", "type": "rendered"}, "created_on": "2018-03-19T07:29:49.732269+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2018-03-19T07:29:49.789948+00:00", "type": "pullrequest_comment", "id": 59155638}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59936174.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59936174"}}, "parent": {"id": 59154873, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59154873.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59154873"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 36, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36"}}, "title": "ConnectionTable improvements"}, "content": {"raw": "I vote don't remove them. I think this patch as it is makes sense. You get a bunch of errors, and a tree of devices where if you follow the links you can get to the parents - it's just that some parents may have been removed from the list of all devices. This is not dissimilar to other data structures - we've deleted a reference, that's all, and there may be other references. BLACS only looks at the top level list of references to devices to decide what to instantiate, but all the other links are intact so any data needed by child devices is still accessible. It's like how in linux when you delete a file, the reference to it in the filesystem vanishes, but linux keeps it around in memory until any processes that have it open close it.\n\nI've tested and this patch works well enough as is, I'm inclined to merge.", "markup": "markdown", "html": "<p>I vote don't remove them. I think this patch as it is makes sense. You get a bunch of errors, and a tree of devices where if you follow the links you can get to the parents - it's just that some parents may have been removed from the list of all devices. This is not dissimilar to other data structures - we've deleted a reference, that's all, and there may be other references. BLACS only looks at the top level list of references to devices to decide what to instantiate, but all the other links are intact so any data needed by child devices is still accessible. It's like how in linux when you delete a file, the reference to it in the filesystem vanishes, but linux keeps it around in memory until any processes that have it open close it.</p>\n<p>I've tested and this patch works well enough as is, I'm inclined to merge.</p>", "type": "rendered"}, "created_on": "2018-03-27T05:09:34.060486+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2018-03-27T05:09:34.064640+00:00", "type": "pullrequest_comment", "id": 59936174}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59936212.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59936212"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 36, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36"}}, "title": "ConnectionTable improvements"}, "content": {"raw": "If Phil is happy for it to be merged, I'll merge locally and add a version bump so that the corresponding BLACS patch can depend on it.", "markup": "markdown", "html": "<p>If Phil is happy for it to be merged, I'll merge locally and add a version bump so that the corresponding BLACS patch can depend on it.</p>", "type": "rendered"}, "created_on": "2018-03-27T05:10:34.348934+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2018-03-27T05:10:34.351674+00:00", "type": "pullrequest_comment", "id": 59936212}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59944398.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59944398"}}, "parent": {"id": 59936212, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59936212.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59936212"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 36, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36"}}, "title": "ConnectionTable improvements"}, "content": {"raw": "Yeah I think it's fine. Don't have time to test myself right now, but as far as the intended behaviour, I'm happy!", "markup": "markdown", "html": "<p>Yeah I think it's fine. Don't have time to test myself right now, but as far as the intended behaviour, I'm happy!</p>", "type": "rendered"}, "created_on": "2018-03-27T07:06:16.889142+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": "2018-03-27T07:06:16.893872+00:00", "type": "pullrequest_comment", "id": 59944398}, {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36/comments/59970690.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36/_/diff#comment-59970690"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 36, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/36.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/36"}}, "title": "ConnectionTable improvements"}, "content": {"raw": "I've done some testing, and merged. Thanks for the work!", "markup": "markdown", "html": "<p>I've done some testing, and merged. Thanks for the work!</p>", "type": "rendered"}, "created_on": "2018-03-27T10:31:38.988354+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2018-03-27T10:31:38.991652+00:00", "type": "pullrequest_comment", "id": 59970690}], "page": 1, "size": 8}