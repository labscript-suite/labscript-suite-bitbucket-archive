{"rendered": {"description": {"raw": "JSON does not distinguish between bytestrings and unicode strings, but Python\r\ndoes, and Python 3 has stricter requirements not to confuse the two.\r\n\r\nIn order for a bytestrings to survive serialisation and deserialisation, this\r\nchange encodes bytestrings as base64, adds a prefix, and the result is serialised\r\nin the JSON ouput the same as any unicode string. Upon deserialisation, strings\r\nare inspected for the prefix and decoded.\r\n\r\nThis is motivated by the labscript driver for NI IMAQdx-controlled cameras. Camera attributes\r\ncan be set, which are currently stored as connection table properties or device\r\nproperties. Currently they are stored as strings, even though this leads to\r\nvarious issues with the Python nivision API choking on some of them since they\r\nare not the right datatype. Not only can attributes be strings or integers or floats\r\netc, but nivision makes a distinction between byestrings and unicode strings.\r\nSo to correctly set these, our serialisation needs to allow this distinction to\r\nround-trip.\r\n\r\nThis encoding of bytestrings is only performed for Python 3. This is a perfectly backward-compatible change because in Python 3 the JSON serialiser previously threw an error if a value was a bytestring. (The NI IMAQdx camera driver is Python3-only in any case.)\r\n\r\neg:\r\n\r\n```python\r\n>>> print(serialise({'foo': b'bar'}))\r\nContent-Type: application/json {\"foo\": \"Content-Transfer-Encoding: base64 YmFy\"}\r\n```", "markup": "markdown", "html": "<p>JSON does not distinguish between bytestrings and unicode strings, but Python\ndoes, and Python 3 has stricter requirements not to confuse the two.</p>\n<p>In order for a bytestrings to survive serialisation and deserialisation, this\nchange encodes bytestrings as base64, adds a prefix, and the result is serialised\nin the JSON ouput the same as any unicode string. Upon deserialisation, strings\nare inspected for the prefix and decoded.</p>\n<p>This is motivated by the labscript driver for NI IMAQdx-controlled cameras. Camera attributes\ncan be set, which are currently stored as connection table properties or device\nproperties. Currently they are stored as strings, even though this leads to\nvarious issues with the Python nivision API choking on some of them since they\nare not the right datatype. Not only can attributes be strings or integers or floats\netc, but nivision makes a distinction between byestrings and unicode strings.\nSo to correctly set these, our serialisation needs to allow this distinction to\nround-trip.</p>\n<p>This encoding of bytestrings is only performed for Python 3. This is a perfectly backward-compatible change because in Python 3 the JSON serialiser previously threw an error if a value was a bytestring. (The NI IMAQdx camera driver is Python3-only in any case.)</p>\n<p>eg:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">serialise</span><span class=\"p\">({</span><span class=\"s1\">&#39;foo&#39;</span><span class=\"p\">:</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">}))</span>\n<span class=\"n\">Content</span><span class=\"o\">-</span><span class=\"n\">Type</span><span class=\"p\">:</span> <span class=\"n\">application</span><span class=\"o\">/</span><span class=\"n\">json</span> <span class=\"p\">{</span><span class=\"s2\">&quot;foo&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Content-Transfer-Encoding: base64 YmFy&quot;</span><span class=\"p\">}</span>\n</pre></div>", "type": "rendered"}, "title": {"raw": "Allow serialiser to serialise bytestings, by base64 encoding them with a prefix.", "markup": "markdown", "html": "<p>Allow serialiser to serialise bytestings, by base64 encoding them with a prefix.</p>", "type": "rendered"}}, "type": "pullrequest", "description": "JSON does not distinguish between bytestrings and unicode strings, but Python\r\ndoes, and Python 3 has stricter requirements not to confuse the two.\r\n\r\nIn order for a bytestrings to survive serialisation and deserialisation, this\r\nchange encodes bytestrings as base64, adds a prefix, and the result is serialised\r\nin the JSON ouput the same as any unicode string. Upon deserialisation, strings\r\nare inspected for the prefix and decoded.\r\n\r\nThis is motivated by the labscript driver for NI IMAQdx-controlled cameras. Camera attributes\r\ncan be set, which are currently stored as connection table properties or device\r\nproperties. Currently they are stored as strings, even though this leads to\r\nvarious issues with the Python nivision API choking on some of them since they\r\nare not the right datatype. Not only can attributes be strings or integers or floats\r\netc, but nivision makes a distinction between byestrings and unicode strings.\r\nSo to correctly set these, our serialisation needs to allow this distinction to\r\nround-trip.\r\n\r\nThis encoding of bytestrings is only performed for Python 3. This is a perfectly backward-compatible change because in Python 3 the JSON serialiser previously threw an error if a value was a bytestring. (The NI IMAQdx camera driver is Python3-only in any case.)\r\n\r\neg:\r\n\r\n```python\r\n>>> print(serialise({'foo': b'bar'}))\r\nContent-Type: application/json {\"foo\": \"Content-Transfer-Encoding: base64 YmFy\"}\r\n```", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/pullrequests/74/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/diffstat/labscript_suite/labscript_utils:45525cf8fd40%0Dc58c5cf83d26?from_pullrequest_id=74"}, "commits": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/74/commits.json"}, "self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/74.json"}, "comments": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/74/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/pullrequests/74/merge"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/74"}, "activity": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/74/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/diff/labscript_suite/labscript_utils:45525cf8fd40%0Dc58c5cf83d26?from_pullrequest_id=74"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/pullrequests/74/approve"}, "statuses": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/74/statuses_page=1.json"}}, "title": "Allow serialiser to serialise bytestings, by base64 encoding them with a prefix.", "close_source_branch": true, "reviewers": [{"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, {"display_name": "Philip Starkey", "uuid": "{0147401a-13ed-4e39-a0d0-63108c18738b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D"}, "html": {"href": "https://bitbucket.org/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/fa0698c306b3470c00717c146b5296e9d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "philipstarkey", "type": "user", "account_id": "557058:2f99420c-1dbd-4837-952c-82c421b8fbdd"}], "id": 74, "destination": {"commit": {"hash": "c58c5cf83d26", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/commit/c58c5cf83d26.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/commits/c58c5cf83d26"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils.json"}, "html": {"href": "#!/labscript_suite/labscript_utils"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68347210-fb1e-4b58-86c0-bd2c04396e63}ts=249922"}}, "type": "repository", "name": "labscript_utils", "full_name": "labscript_suite/labscript_utils", "uuid": "{68347210-fb1e-4b58-86c0-bd2c04396e63}"}, "branch": {"name": "default"}}, "created_on": "2019-03-29T17:35:03.814050+00:00", "summary": {"raw": "JSON does not distinguish between bytestrings and unicode strings, but Python\r\ndoes, and Python 3 has stricter requirements not to confuse the two.\r\n\r\nIn order for a bytestrings to survive serialisation and deserialisation, this\r\nchange encodes bytestrings as base64, adds a prefix, and the result is serialised\r\nin the JSON ouput the same as any unicode string. Upon deserialisation, strings\r\nare inspected for the prefix and decoded.\r\n\r\nThis is motivated by the labscript driver for NI IMAQdx-controlled cameras. Camera attributes\r\ncan be set, which are currently stored as connection table properties or device\r\nproperties. Currently they are stored as strings, even though this leads to\r\nvarious issues with the Python nivision API choking on some of them since they\r\nare not the right datatype. Not only can attributes be strings or integers or floats\r\netc, but nivision makes a distinction between byestrings and unicode strings.\r\nSo to correctly set these, our serialisation needs to allow this distinction to\r\nround-trip.\r\n\r\nThis encoding of bytestrings is only performed for Python 3. This is a perfectly backward-compatible change because in Python 3 the JSON serialiser previously threw an error if a value was a bytestring. (The NI IMAQdx camera driver is Python3-only in any case.)\r\n\r\neg:\r\n\r\n```python\r\n>>> print(serialise({'foo': b'bar'}))\r\nContent-Type: application/json {\"foo\": \"Content-Transfer-Encoding: base64 YmFy\"}\r\n```", "markup": "markdown", "html": "<p>JSON does not distinguish between bytestrings and unicode strings, but Python\ndoes, and Python 3 has stricter requirements not to confuse the two.</p>\n<p>In order for a bytestrings to survive serialisation and deserialisation, this\nchange encodes bytestrings as base64, adds a prefix, and the result is serialised\nin the JSON ouput the same as any unicode string. Upon deserialisation, strings\nare inspected for the prefix and decoded.</p>\n<p>This is motivated by the labscript driver for NI IMAQdx-controlled cameras. Camera attributes\ncan be set, which are currently stored as connection table properties or device\nproperties. Currently they are stored as strings, even though this leads to\nvarious issues with the Python nivision API choking on some of them since they\nare not the right datatype. Not only can attributes be strings or integers or floats\netc, but nivision makes a distinction between byestrings and unicode strings.\nSo to correctly set these, our serialisation needs to allow this distinction to\nround-trip.</p>\n<p>This encoding of bytestrings is only performed for Python 3. This is a perfectly backward-compatible change because in Python 3 the JSON serialiser previously threw an error if a value was a bytestring. (The NI IMAQdx camera driver is Python3-only in any case.)</p>\n<p>eg:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">serialise</span><span class=\"p\">({</span><span class=\"s1\">&#39;foo&#39;</span><span class=\"p\">:</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">}))</span>\n<span class=\"n\">Content</span><span class=\"o\">-</span><span class=\"n\">Type</span><span class=\"p\">:</span> <span class=\"n\">application</span><span class=\"o\">/</span><span class=\"n\">json</span> <span class=\"p\">{</span><span class=\"s2\">&quot;foo&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Content-Transfer-Encoding: base64 YmFy&quot;</span><span class=\"p\">}</span>\n</pre></div>", "type": "rendered"}, "source": {"commit": {"hash": "31e8af650817", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/labscript_utils/commit/31e8af650817"}, "html": {"href": "#!/cbillington/labscript_utils/commits/31e8af650817"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/labscript_utils"}, "html": {"href": "#!/cbillington/labscript_utils"}, "avatar": {"href": "data/bytebucket.org/ravatar/{455d0b5d-4852-4e4a-b8b1-f5ba77882210}ts=python"}}, "type": "repository", "name": "labscript_utils", "full_name": "cbillington/labscript_utils", "uuid": "{455d0b5d-4852-4e4a-b8b1-f5ba77882210}"}, "branch": {"name": "JSON_bytestrings"}}, "comment_count": 1, "state": "MERGED", "task_count": 0, "participants": [{"role": "REVIEWER", "participated_on": "2019-04-28T09:37:22.151637+00:00", "type": "participant", "approved": true, "user": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}}, {"role": "PARTICIPANT", "participated_on": "2019-03-29T20:06:52.281115+00:00", "type": "participant", "approved": false, "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}, {"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Philip Starkey", "uuid": "{0147401a-13ed-4e39-a0d0-63108c18738b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D"}, "html": {"href": "https://bitbucket.org/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/fa0698c306b3470c00717c146b5296e9d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "philipstarkey", "type": "user", "account_id": "557058:2f99420c-1dbd-4837-952c-82c421b8fbdd"}}], "reason": "", "updated_on": "2019-04-28T09:37:22.155512+00:00", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "merge_commit": {"hash": "45525cf8fd40", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/commit/45525cf8fd40.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/commits/45525cf8fd40"}}}, "closed_by": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}