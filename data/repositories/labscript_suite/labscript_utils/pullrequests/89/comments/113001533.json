{"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/89/comments/113001533.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/89/_/diff#comment-113001533"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 89, "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/89.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/89"}}, "title": "Add RCPServer and RPCCLient base clients for more organised communication between labscript programs"}, "content": {"raw": "I've now modified this to include two new base classes for servers and clients, that allow sending version requirement information with every request, as well as getting a sensible error if a new client contacts an old server. See [runmanager PR #42](#!/labscript_suite/runmanager/pull-requests/42/) for an example and some more information.\n\nCopying and pasting the commit message for convenience:\n\n```\nAdd RPCServer and RPCClient classes appropriate for labscript programs\nto use for their inter-process communication. These are modelled after the\nrunmanager remote client and server classes, providing a base class to implement\nthe same type of clients and servers in other applications.\n\nThe idea is that we will make a blacs.remote, runviewer.remote and lyse.remote\nmodule containing client classes for making these calls, instead of using\nzmq_get directly. Servers must be upgraded before clients.\n\nEvery request sends the required versions of any necessary components on the\nserver, which allows us to make modifications to protocols whilst raising\nhelpful version exceptions instead of just crashing unhelpfully. Fallback\nmethods allow new style servers to still handle old requests. However, new\nclients communicating with old servers will raise exceptions instructing the\nuser to update the server, since they cannot know in advance whether the server\nis old or new.\n\nSince every RPC call checks versions, add a cache to check_version so that it\ndoes not do disk access every time a version is checked. This makes the\nperformance hit of doing these checks for every call negligable.\n```\n\n", "markup": "markdown", "html": "<p>I've now modified this to include two new base classes for servers and clients, that allow sending version requirement information with every request, as well as getting a sensible error if a new client contacts an old server. See <a data-is-external-link=\"true\" href=\"#!/labscript_suite/runmanager/pull-requests/42/\" rel=\"nofollow\">runmanager PR #42</a> for an example and some more information.</p>\n<p>Copying and pasting the commit message for convenience:</p>\n<div class=\"codehilite\"><pre><span></span>Add RPCServer and RPCClient classes appropriate for labscript programs\nto use for their inter-process communication. These are modelled after the\nrunmanager remote client and server classes, providing a base class to implement\nthe same type of clients and servers in other applications.\n\nThe idea is that we will make a blacs.remote, runviewer.remote and lyse.remote\nmodule containing client classes for making these calls, instead of using\nzmq_get directly. Servers must be upgraded before clients.\n\nEvery request sends the required versions of any necessary components on the\nserver, which allows us to make modifications to protocols whilst raising\nhelpful version exceptions instead of just crashing unhelpfully. Fallback\nmethods allow new style servers to still handle old requests. However, new\nclients communicating with old servers will raise exceptions instructing the\nuser to update the server, since they cannot know in advance whether the server\nis old or new.\n\nSince every RPC call checks versions, add a cache to check_version so that it\ndoes not do disk access every time a version is checked. This makes the\nperformance hit of doing these checks for every call negligable.\n</pre></div>", "type": "rendered"}, "created_on": "2019-08-13T20:54:37.597185+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2019-08-13T21:04:56.986719+00:00", "type": "pullrequest_comment", "id": 113001533}