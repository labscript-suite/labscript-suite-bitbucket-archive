{"rendered": {"description": {"raw": "Bugfix for double_import_denier and better error message for h5_lock\r\n\r\n* Double import denier had a bug where a module that was already imported\r\n  when double import denier was enabled would be stored in its list of modules\r\n  by its `__file__` attribute. However, the import machinery as used later\r\n  by double import denier actually identifies modules by their directory for the\r\n  case of an `__init__.py` file. Therefore to match with later checks, this\r\n  directory should be stored instead when the module's file is `__init__.py`.\r\n\r\n* h5_lock must be imported before h5py, and raises an error if h5py is already\r\n  imported. This commit improves the error message by using the double import\r\n  denier, if enabled, to show the traceback it saved from when h5py was imported.\r\n\r\nThe motivation for this is a bug I've heard about from two people that they're\r\ngetting an error from h5_lock saying h5py was already imported, and I don't know\r\nwhere. There are hacks you can do to diagnose this locally, but making the error\r\nmessage better will allow us to handle such bugs easier in the future.\r\n\r\nLonger term we should probably stop monkey-patching h5py and instead just use\r\na subclass, but that's a change for another day.", "markup": "markdown", "html": "<p>Bugfix for double_import_denier and better error message for h5_lock</p>\n<ul>\n<li>\n<p>Double import denier had a bug where a module that was already imported\n  when double import denier was enabled would be stored in its list of modules\n  by its <code>__file__</code> attribute. However, the import machinery as used later\n  by double import denier actually identifies modules by their directory for the\n  case of an <code>__init__.py</code> file. Therefore to match with later checks, this\n  directory should be stored instead when the module's file is <code>__init__.py</code>.</p>\n</li>\n<li>\n<p>h5_lock must be imported before h5py, and raises an error if h5py is already\n  imported. This commit improves the error message by using the double import\n  denier, if enabled, to show the traceback it saved from when h5py was imported.</p>\n</li>\n</ul>\n<p>The motivation for this is a bug I've heard about from two people that they're\ngetting an error from h5_lock saying h5py was already imported, and I don't know\nwhere. There are hacks you can do to diagnose this locally, but making the error\nmessage better will allow us to handle such bugs easier in the future.</p>\n<p>Longer term we should probably stop monkey-patching h5py and instead just use\na subclass, but that's a change for another day.</p>", "type": "rendered"}, "title": {"raw": "Bugfix for double_import_denier and better error message for h5_lock", "markup": "markdown", "html": "<p>Bugfix for double_import_denier and better error message for h5_lock</p>", "type": "rendered"}}, "type": "pullrequest", "description": "Bugfix for double_import_denier and better error message for h5_lock\r\n\r\n* Double import denier had a bug where a module that was already imported\r\n  when double import denier was enabled would be stored in its list of modules\r\n  by its `__file__` attribute. However, the import machinery as used later\r\n  by double import denier actually identifies modules by their directory for the\r\n  case of an `__init__.py` file. Therefore to match with later checks, this\r\n  directory should be stored instead when the module's file is `__init__.py`.\r\n\r\n* h5_lock must be imported before h5py, and raises an error if h5py is already\r\n  imported. This commit improves the error message by using the double import\r\n  denier, if enabled, to show the traceback it saved from when h5py was imported.\r\n\r\nThe motivation for this is a bug I've heard about from two people that they're\r\ngetting an error from h5_lock saying h5py was already imported, and I don't know\r\nwhere. There are hacks you can do to diagnose this locally, but making the error\r\nmessage better will allow us to handle such bugs easier in the future.\r\n\r\nLonger term we should probably stop monkey-patching h5py and instead just use\r\na subclass, but that's a change for another day.", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/pullrequests/90/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/diffstat/labscript_suite/labscript_utils:c8879ce93e7d%0D61f4c846e51b?from_pullrequest_id=90"}, "commits": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/90/commits.json"}, "self": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/90.json"}, "comments": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/90/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/pullrequests/90/merge"}, "html": {"href": "#!/labscript_suite/labscript_utils/pull-requests/90"}, "activity": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/90/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/diff/labscript_suite/labscript_utils:c8879ce93e7d%0D61f4c846e51b?from_pullrequest_id=90"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/labscript_utils/pullrequests/90/approve"}, "statuses": {"href": "data/repositories/labscript_suite/labscript_utils/pullrequests/90/statuses_page=1.json"}}, "title": "Bugfix for double_import_denier and better error message for h5_lock", "close_source_branch": true, "reviewers": [{"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, {"display_name": "Shaun Johnstone", "uuid": "{652df738-313d-472c-b7b5-a3f8f98a3322}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D"}, "html": {"href": "https://bitbucket.org/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/38984f1761fc67ce892911496abee619d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSJ-3.png"}}, "nickname": "shjohnst", "type": "user", "account_id": "557058:1b9a15fb-8e4f-407e-b7b9-567c5e1fa1b4"}, {"display_name": "Philip Starkey", "uuid": "{0147401a-13ed-4e39-a0d0-63108c18738b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D"}, "html": {"href": "https://bitbucket.org/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/fa0698c306b3470c00717c146b5296e9d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "philipstarkey", "type": "user", "account_id": "557058:2f99420c-1dbd-4837-952c-82c421b8fbdd"}], "id": 90, "destination": {"commit": {"hash": "61f4c846e51b", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/commit/61f4c846e51b.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/commits/61f4c846e51b"}}}, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils.json"}, "html": {"href": "#!/labscript_suite/labscript_utils"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68347210-fb1e-4b58-86c0-bd2c04396e63}ts=249922"}}, "type": "repository", "name": "labscript_utils", "full_name": "labscript_suite/labscript_utils", "uuid": "{68347210-fb1e-4b58-86c0-bd2c04396e63}"}, "branch": {"name": "default"}}, "created_on": "2019-08-22T14:55:37.597917+00:00", "summary": {"raw": "Bugfix for double_import_denier and better error message for h5_lock\r\n\r\n* Double import denier had a bug where a module that was already imported\r\n  when double import denier was enabled would be stored in its list of modules\r\n  by its `__file__` attribute. However, the import machinery as used later\r\n  by double import denier actually identifies modules by their directory for the\r\n  case of an `__init__.py` file. Therefore to match with later checks, this\r\n  directory should be stored instead when the module's file is `__init__.py`.\r\n\r\n* h5_lock must be imported before h5py, and raises an error if h5py is already\r\n  imported. This commit improves the error message by using the double import\r\n  denier, if enabled, to show the traceback it saved from when h5py was imported.\r\n\r\nThe motivation for this is a bug I've heard about from two people that they're\r\ngetting an error from h5_lock saying h5py was already imported, and I don't know\r\nwhere. There are hacks you can do to diagnose this locally, but making the error\r\nmessage better will allow us to handle such bugs easier in the future.\r\n\r\nLonger term we should probably stop monkey-patching h5py and instead just use\r\na subclass, but that's a change for another day.", "markup": "markdown", "html": "<p>Bugfix for double_import_denier and better error message for h5_lock</p>\n<ul>\n<li>\n<p>Double import denier had a bug where a module that was already imported\n  when double import denier was enabled would be stored in its list of modules\n  by its <code>__file__</code> attribute. However, the import machinery as used later\n  by double import denier actually identifies modules by their directory for the\n  case of an <code>__init__.py</code> file. Therefore to match with later checks, this\n  directory should be stored instead when the module's file is <code>__init__.py</code>.</p>\n</li>\n<li>\n<p>h5_lock must be imported before h5py, and raises an error if h5py is already\n  imported. This commit improves the error message by using the double import\n  denier, if enabled, to show the traceback it saved from when h5py was imported.</p>\n</li>\n</ul>\n<p>The motivation for this is a bug I've heard about from two people that they're\ngetting an error from h5_lock saying h5py was already imported, and I don't know\nwhere. There are hacks you can do to diagnose this locally, but making the error\nmessage better will allow us to handle such bugs easier in the future.</p>\n<p>Longer term we should probably stop monkey-patching h5py and instead just use\na subclass, but that's a change for another day.</p>", "type": "rendered"}, "source": {"commit": {"hash": "68178dac527d", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/labscript_utils/commit/68178dac527d"}, "html": {"href": "#!/cbillington/labscript_utils/commits/68178dac527d"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/cbillington/labscript_utils"}, "html": {"href": "#!/cbillington/labscript_utils"}, "avatar": {"href": "data/bytebucket.org/ravatar/{455d0b5d-4852-4e4a-b8b1-f5ba77882210}ts=python"}}, "type": "repository", "name": "labscript_utils", "full_name": "cbillington/labscript_utils", "uuid": "{455d0b5d-4852-4e4a-b8b1-f5ba77882210}"}, "branch": {"name": "h5_lock_better_error"}}, "comment_count": 2, "state": "MERGED", "task_count": 0, "participants": [{"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Shaun Johnstone", "uuid": "{652df738-313d-472c-b7b5-a3f8f98a3322}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D"}, "html": {"href": "https://bitbucket.org/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/38984f1761fc67ce892911496abee619d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSJ-3.png"}}, "nickname": "shjohnst", "type": "user", "account_id": "557058:1b9a15fb-8e4f-407e-b7b9-567c5e1fa1b4"}}, {"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}}, {"role": "PARTICIPANT", "participated_on": "2019-08-22T17:56:50.192790+00:00", "type": "participant", "approved": false, "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}, {"role": "REVIEWER", "participated_on": null, "type": "participant", "approved": false, "user": {"display_name": "Philip Starkey", "uuid": "{0147401a-13ed-4e39-a0d0-63108c18738b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D"}, "html": {"href": "https://bitbucket.org/%7B0147401a-13ed-4e39-a0d0-63108c18738b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/fa0698c306b3470c00717c146b5296e9d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "philipstarkey", "type": "user", "account_id": "557058:2f99420c-1dbd-4837-952c-82c421b8fbdd"}}], "reason": "", "updated_on": "2019-09-13T20:33:25.784027+00:00", "author": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "merge_commit": {"hash": "c8879ce93e7d", "type": "commit", "links": {"self": {"href": "data/repositories/labscript_suite/labscript_utils/commit/c8879ce93e7d.json"}, "html": {"href": "#!/labscript_suite/labscript_utils/commits/c8879ce93e7d"}}}, "closed_by": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}}