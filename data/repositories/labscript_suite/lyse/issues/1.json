{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/lyse/issues/1/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/lyse/issues/1.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/lyse/issues/1/watch"}, "comments": {"href": "data/repositories/labscript_suite/lyse/issues/1/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/1/files-no-longer-added-to-list-after-file"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/lyse/issues/1/vote"}}, "reporter": {"display_name": "Shaun Johnstone", "uuid": "{652df738-313d-472c-b7b5-a3f8f98a3322}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D"}, "html": {"href": "https://bitbucket.org/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/38984f1761fc67ce892911496abee619d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSJ-3.png"}}, "nickname": "shjohnst", "type": "user", "account_id": "557058:1b9a15fb-8e4f-407e-b7b9-567c5e1fa1b4"}, "title": "Files no longer added to list after file access problem", "component": null, "votes": 0, "watches": 2, "content": {"raw": "lyse appears to fail to read a .h5 file that it is adding to its list, after which new incoming files fail to be added to the list.\r\nI can see them coming in in the terminal as Webserver requests, but then the usual \"INFO LYSE.FileBox.incoming: adding some files\" line never comes.\r\n\r\nThe traceback from the read fail is:\r\n\r\n```\r\n#!python\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\pythonlib\\labscript_utils\\excepthook\\__init__.py\", line 32, in run\r\n    run_old(*args, **kwargs)\r\n  File \"C:\\Python27\\lib\\threading.py\", line 483, in run\r\n    self.__target(*self.__args, **self.__kwargs)\r\n  File \"main.pyw\", line 570, in incoming_buffer_loop\r\n    self.add_files(filepaths, marked=True)\r\n  File \"main.pyw\", line 690, in add_files\r\n    row = get_dataframe_from_shot(filepath)\r\n  File \"C:\\pythonlib\\lyse\\dataframe_utilities.py\", line 165, in get_dataframe_from_shot\r\n    nested_dict = get_nested_dict_from_shot(filepath)\r\n  File \"C:\\pythonlib\\lyse\\dataframe_utilities.py\", line 62, in get_nested_dict_from_shot\r\n    with h5py.File(filepath,'r') as h5_file:\r\n  File \"C:\\pythonlib\\labscript_utils\\h5_lock.py\", line 42, in __init__\r\n    _orig_init(self, name, mode, driver, libver, **kwds)\r\n  File \"C:\\Python27\\lib\\site-packages\\h5py\\_hl\\files.py\", line 207, in __init__\r\n    fid = make_fid(name, mode, userblock_size, fapl)\r\n  File \"C:\\Python27\\lib\\site-packages\\h5py\\_hl\\files.py\", line 79, in make_fid\r\n    fid = h5f.open(name, h5f.ACC_RDONLY, fapl=fapl)\r\n  File \"h5f.pyx\", line 71, in h5py.h5f.open (h5py\\h5f.c:1745)\r\nIOError: unable to open file (File accessability: Unable to open file)\r\n\r\n```\r\n\r\nThis should fail more gracefully and allow lyse to continue operating rather than requiring a restart. As far as BLACS is concerned, everything is OK and lyse is accepting the files for analysis, so it doesn't even queue them up to send to lyse once it is restarted.", "markup": "markdown", "html": "<p>lyse appears to fail to read a .h5 file that it is adding to its list, after which new incoming files fail to be added to the list.\nI can see them coming in in the terminal as Webserver requests, but then the usual \"INFO LYSE.FileBox.incoming: adding some files\" line never comes.</p>\n<p>The traceback from the read fail is:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\pythonlib\\labscript_utils\\excepthook\\__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">32</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">run</span>\n    <span class=\"n\">run_old</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\Python27\\lib</span><span class=\"se\">\\t</span><span class=\"s2\">hreading.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">483</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">run</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__target</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__kwargs</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;main.pyw&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">570</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">incoming_buffer_loop</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add_files</span><span class=\"p\">(</span><span class=\"n\">filepaths</span><span class=\"p\">,</span> <span class=\"n\">marked</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;main.pyw&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">690</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">add_files</span>\n    <span class=\"n\">row</span> <span class=\"o\">=</span> <span class=\"n\">get_dataframe_from_shot</span><span class=\"p\">(</span><span class=\"n\">filepath</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\pythonlib\\lyse\\dataframe_utilities.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">165</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">get_dataframe_from_shot</span>\n    <span class=\"n\">nested_dict</span> <span class=\"o\">=</span> <span class=\"n\">get_nested_dict_from_shot</span><span class=\"p\">(</span><span class=\"n\">filepath</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\pythonlib\\lyse\\dataframe_utilities.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">62</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">get_nested_dict_from_shot</span>\n    <span class=\"k\">with</span> <span class=\"n\">h5py</span><span class=\"o\">.</span><span class=\"n\">File</span><span class=\"p\">(</span><span class=\"n\">filepath</span><span class=\"p\">,</span><span class=\"s1\">&#39;r&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">h5_file</span><span class=\"p\">:</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\pythonlib\\labscript_utils\\h5_lock.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">42</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__init__</span>\n    <span class=\"n\">_orig_init</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">driver</span><span class=\"p\">,</span> <span class=\"n\">libver</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwds</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\Python27\\lib\\site-packages\\h5py\\_hl</span><span class=\"se\">\\f</span><span class=\"s2\">iles.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">207</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__init__</span>\n    <span class=\"n\">fid</span> <span class=\"o\">=</span> <span class=\"n\">make_fid</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">userblock_size</span><span class=\"p\">,</span> <span class=\"n\">fapl</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\Python27\\lib\\site-packages\\h5py\\_hl</span><span class=\"se\">\\f</span><span class=\"s2\">iles.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">79</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">make_fid</span>\n    <span class=\"n\">fid</span> <span class=\"o\">=</span> <span class=\"n\">h5f</span><span class=\"o\">.</span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">h5f</span><span class=\"o\">.</span><span class=\"n\">ACC_RDONLY</span><span class=\"p\">,</span> <span class=\"n\">fapl</span><span class=\"o\">=</span><span class=\"n\">fapl</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;h5f.pyx&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">71</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">h5py</span><span class=\"o\">.</span><span class=\"n\">h5f</span><span class=\"o\">.</span><span class=\"n\">open</span> <span class=\"p\">(</span><span class=\"n\">h5py</span>\\<span class=\"n\">h5f</span><span class=\"o\">.</span><span class=\"n\">c</span><span class=\"p\">:</span><span class=\"mi\">1745</span><span class=\"p\">)</span>\n<span class=\"ne\">IOError</span><span class=\"p\">:</span> <span class=\"n\">unable</span> <span class=\"n\">to</span> <span class=\"nb\">open</span> <span class=\"nb\">file</span> <span class=\"p\">(</span><span class=\"n\">File</span> <span class=\"n\">accessability</span><span class=\"p\">:</span> <span class=\"n\">Unable</span> <span class=\"n\">to</span> <span class=\"nb\">open</span> <span class=\"nb\">file</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>This should fail more gracefully and allow lyse to continue operating rather than requiring a restart. As far as BLACS is concerned, everything is OK and lyse is accepting the files for analysis, so it doesn't even queue them up to send to lyse once it is restarted.</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2014-05-29T06:35:30.862945+00:00", "milestone": null, "updated_on": "2014-07-10T01:28:01.519376+00:00", "type": "issue", "id": 1}