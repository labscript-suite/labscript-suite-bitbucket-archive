{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13/comments/17334882.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/13#comment-17334882"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13.json"}}, "type": "issue", "id": 13, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Empty rows added to lyse dataframe, causing \"Multiple items found\" lookup error"}, "content": {"raw": "Sweet, found the bug. Lyse checks for duplicates when adding shots, and ignores them, but when I added batch processing (to speed up adding shots), I forgot to check for duplicates *within* each batch of files.\n\nBLACS submitted the same shot twice within a millisecond, so lyse went ahead and added it twice, not detecting that one was a dup'. But the adding didn't complete because the code for adding a shot hit upon the 'multiple items found' error that it gave a traceback about. So things were left in a dodgy state and the thread for adding files crashed.\n\nI've made lyse check for duplicates within batches, and wrapped the 'incoming files' loop in a giant try: except: that raises the error so you can see it, but keeps running. This is to catch unexpected errors only, and just because the error is caught doesn't mean things are in a state where lyse can keep running. But it's still better for that thread not to crash out.\n\nPushed to monashkrb fork, could you test there and then accept the pull request after a few days of use?", "markup": "markdown", "html": "<p>Sweet, found the bug. Lyse checks for duplicates when adding shots, and ignores them, but when I added batch processing (to speed up adding shots), I forgot to check for duplicates <em>within</em> each batch of files.</p>\n<p>BLACS submitted the same shot twice within a millisecond, so lyse went ahead and added it twice, not detecting that one was a dup'. But the adding didn't complete because the code for adding a shot hit upon the 'multiple items found' error that it gave a traceback about. So things were left in a dodgy state and the thread for adding files crashed.</p>\n<p>I've made lyse check for duplicates within batches, and wrapped the 'incoming files' loop in a giant try: except: that raises the error so you can see it, but keeps running. This is to catch unexpected errors only, and just because the error is caught doesn't mean things are in a state where lyse can keep running. But it's still better for that thread not to crash out.</p>\n<p>Pushed to monashkrb fork, could you test there and then accept the pull request after a few days of use?</p>", "type": "rendered"}, "created_on": "2015-04-13T04:49:49.615919+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 17334882}