{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13/comments/17333436.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/13#comment-17333436"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13.json"}}, "type": "issue", "id": 13, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Empty rows added to lyse dataframe, causing \"Multiple items found\" lookup error"}, "content": {"raw": "Also, while lyse was in this error state, BLACS still thought that it was successfully adding more shots, rather than holding off until lyse was fixed", "markup": "markdown", "html": "<p>Also, while lyse was in this error state, BLACS still thought that it was successfully adding more shots, rather than holding off until lyse was fixed</p>", "type": "rendered"}, "created_on": "2015-04-13T02:00:05.635285+00:00", "user": {"display_name": "Shaun Johnstone", "uuid": "{652df738-313d-472c-b7b5-a3f8f98a3322}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D"}, "html": {"href": "https://bitbucket.org/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/38984f1761fc67ce892911496abee619d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSJ-3.png"}}, "nickname": "shjohnst", "type": "user", "account_id": "557058:1b9a15fb-8e4f-407e-b7b9-567c5e1fa1b4"}, "updated_on": null, "type": "issue_comment", "id": 17333436}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13/comments/17333452.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/13#comment-17333452"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13.json"}}, "type": "issue", "id": 13, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Empty rows added to lyse dataframe, causing \"Multiple items found\" lookup error"}, "content": {"raw": "Chris, is there a lock in lyse that prevents simultaneous access to the dataframe from multiple threads (not necessarily a dataframe specific one, but is access at least serialised through inmain or something similar)?\n\nPandas dataframes are not thread safe, so it is possible a race condition led to this behaviour.", "markup": "markdown", "html": "<p>Chris, is there a lock in lyse that prevents simultaneous access to the dataframe from multiple threads (not necessarily a dataframe specific one, but is access at least serialised through inmain or something similar)?</p>\n<p>Pandas dataframes are not thread safe, so it is possible a race condition led to this behaviour.</p>", "type": "rendered"}, "created_on": "2015-04-13T02:01:46.018984+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": null, "type": "issue_comment", "id": 17333452}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13/comments/17333633.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/13#comment-17333633"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13.json"}}, "type": "issue", "id": 13, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Empty rows added to lyse dataframe, causing \"Multiple items found\" lookup error"}, "content": {"raw": "All modifications to the dataframe are done in the main thread via inmain() and friends. Most reading of the dataframe is also done with inmain(), though the server sending the dataframe to analysis subprocesses is not done in the main thread. I should investigate whether pickling is atomic, like, if it holds the GIL and thus the dataframe can't be modified mid-pickle.\n\nBut that's not the issue we've seen today, since writing to the dataframe was f'd up at some point. I'm not seeing any obvious causes of this bug so far. I'm starting to wonder if lyse was sent malformed data.", "markup": "markdown", "html": "<p>All modifications to the dataframe are done in the main thread via inmain() and friends. Most reading of the dataframe is also done with inmain(), though the server sending the dataframe to analysis subprocesses is not done in the main thread. I should investigate whether pickling is atomic, like, if it holds the GIL and thus the dataframe can't be modified mid-pickle.</p>\n<p>But that's not the issue we've seen today, since writing to the dataframe was f'd up at some point. I'm not seeing any obvious causes of this bug so far. I'm starting to wonder if lyse was sent malformed data.</p>", "type": "rendered"}, "created_on": "2015-04-13T02:24:09.331368+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 17333633}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13/comments/17333751.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/13#comment-17333751"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13.json"}}, "type": "issue", "id": 13, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Empty rows added to lyse dataframe, causing \"Multiple items found\" lookup error"}, "content": {"raw": "Do you have a logfile from the crash?", "markup": "markdown", "html": "<p>Do you have a logfile from the crash?</p>", "type": "rendered"}, "created_on": "2015-04-13T02:38:22.864588+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 17333751}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13/comments/17334461.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/13#comment-17334461"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13.json"}}, "type": "issue", "id": 13, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Empty rows added to lyse dataframe, causing \"Multiple items found\" lookup error"}, "content": {"raw": "I have attached a subset of lyse.log from a few minutes before the bug through to a few minutes after. It looks as though BLACS told lyse to add the file twice. Unfortunately the BLACS log appears to only have the last half hour worth of data, so no longer contains anything from this event", "markup": "markdown", "html": "<p>I have attached a subset of lyse.log from a few minutes before the bug through to a few minutes after. It looks as though BLACS told lyse to add the file twice. Unfortunately the BLACS log appears to only have the last half hour worth of data, so no longer contains anything from this event</p>", "type": "rendered"}, "created_on": "2015-04-13T03:58:29.033905+00:00", "user": {"display_name": "Shaun Johnstone", "uuid": "{652df738-313d-472c-b7b5-a3f8f98a3322}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D"}, "html": {"href": "https://bitbucket.org/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/38984f1761fc67ce892911496abee619d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSJ-3.png"}}, "nickname": "shjohnst", "type": "user", "account_id": "557058:1b9a15fb-8e4f-407e-b7b9-567c5e1fa1b4"}, "updated_on": "2015-04-13T03:58:29.065815+00:00", "type": "issue_comment", "id": 17334461}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13/comments/17334882.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/13#comment-17334882"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13.json"}}, "type": "issue", "id": 13, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Empty rows added to lyse dataframe, causing \"Multiple items found\" lookup error"}, "content": {"raw": "Sweet, found the bug. Lyse checks for duplicates when adding shots, and ignores them, but when I added batch processing (to speed up adding shots), I forgot to check for duplicates *within* each batch of files.\n\nBLACS submitted the same shot twice within a millisecond, so lyse went ahead and added it twice, not detecting that one was a dup'. But the adding didn't complete because the code for adding a shot hit upon the 'multiple items found' error that it gave a traceback about. So things were left in a dodgy state and the thread for adding files crashed.\n\nI've made lyse check for duplicates within batches, and wrapped the 'incoming files' loop in a giant try: except: that raises the error so you can see it, but keeps running. This is to catch unexpected errors only, and just because the error is caught doesn't mean things are in a state where lyse can keep running. But it's still better for that thread not to crash out.\n\nPushed to monashkrb fork, could you test there and then accept the pull request after a few days of use?", "markup": "markdown", "html": "<p>Sweet, found the bug. Lyse checks for duplicates when adding shots, and ignores them, but when I added batch processing (to speed up adding shots), I forgot to check for duplicates <em>within</em> each batch of files.</p>\n<p>BLACS submitted the same shot twice within a millisecond, so lyse went ahead and added it twice, not detecting that one was a dup'. But the adding didn't complete because the code for adding a shot hit upon the 'multiple items found' error that it gave a traceback about. So things were left in a dodgy state and the thread for adding files crashed.</p>\n<p>I've made lyse check for duplicates within batches, and wrapped the 'incoming files' loop in a giant try: except: that raises the error so you can see it, but keeps running. This is to catch unexpected errors only, and just because the error is caught doesn't mean things are in a state where lyse can keep running. But it's still better for that thread not to crash out.</p>\n<p>Pushed to monashkrb fork, could you test there and then accept the pull request after a few days of use?</p>", "type": "rendered"}, "created_on": "2015-04-13T04:49:49.615919+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 17334882}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13/comments/17334884.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/13#comment-17334884"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13.json"}}, "type": "issue", "id": 13, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Empty rows added to lyse dataframe, causing \"Multiple items found\" lookup error"}, "content": {"raw": null, "markup": "markdown", "html": "", "type": "rendered"}, "created_on": "2015-04-13T04:50:06.052550+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": null, "type": "issue_comment", "id": 17334884}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13/comments/18327254.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/13#comment-18327254"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/13.json"}}, "type": "issue", "id": 13, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Empty rows added to lyse dataframe, causing \"Multiple items found\" lookup error"}, "content": {"raw": "Fixed bug #13 where lyse did not check for duplicate shots when they arrived at\nthe same time.\n\nAlso wrapped incoming files loop in try: except: so it keeps running in case of\nsimilar problems in the future.\n\n\u2192 <<cset 8fb777194385>>", "markup": "markdown", "html": "<p>Fixed bug <a href=\"#!/labscript_suite/lyse/issues/13/empty-rows-added-to-lyse-dataframe-causing\" rel=\"nofollow\" title=\"Empty rows added to lyse dataframe, causing &quot;Multiple items found&quot; lookup error\" class=\"ap-connect-link\"><s>#13</s></a> where lyse did not check for duplicate shots when they arrived at\nthe same time.</p>\n<p>Also wrapped incoming files loop in try: except: so it keeps running in case of\nsimilar problems in the future.</p>\n<p>\u2192 &lt;&lt;cset <a href=\"#!/labscript_suite/lyse/commits/8fb777194385\" rel=\"nofollow\" class=\"ap-connect-link\">8fb777194385</a>&gt;&gt;</p>", "type": "rendered"}, "created_on": "2015-05-25T07:17:28.454987+00:00", "user": {"display_name": "Shaun Johnstone", "uuid": "{652df738-313d-472c-b7b5-a3f8f98a3322}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D"}, "html": {"href": "https://bitbucket.org/%7B652df738-313d-472c-b7b5-a3f8f98a3322%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/38984f1761fc67ce892911496abee619d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSJ-3.png"}}, "nickname": "shjohnst", "type": "user", "account_id": "557058:1b9a15fb-8e4f-407e-b7b9-567c5e1fa1b4"}, "updated_on": null, "type": "issue_comment", "id": 18327254}], "page": 1, "size": 8}