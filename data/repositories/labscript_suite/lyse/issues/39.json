{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/lyse/issues/39/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/lyse/issues/39.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/lyse/issues/39/watch"}, "comments": {"href": "data/repositories/labscript_suite/lyse/issues/39/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/39/bug-with-module-watcher-reloading-when"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/lyse/issues/39/vote"}}, "reporter": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "title": "Bug with module watcher reloading when mpl_toolkit used", "component": null, "votes": 0, "watches": 2, "content": {"raw": "I get a weird exception that implies that `sys` is `None` when using the following import in a lyse script (and then modifying the contents of another imported script, triggering modulewatcher to reload)\r\n\r\nThe module to import is: `from mpl_toolkits.axes_grid.inset_locator import (inset_axes, InsetPosition, mark_inset)`.\r\n\r\nOnce you trigger module watcher to reload anything else used by the script, and re-run the analysis, you get the following traceback:\r\n\r\n\r\n```\r\n#!python\r\n\r\nTraceback (most recent call last):\r\n  File \"y_vs_auto.py\", line 24, in <module>\r\n    from mpl_toolkits.axes_grid.inset_locator import (inset_axes, InsetPosition,\r\n  File \"C:\\labscript_suite\\labscript_py27\\labscript_utils\\double_import_denier.py\", line 38, in load_module\r\n    return imp.load_module(name, self.fp, self.pathname, self.description)\r\n  File \"C:\\Anaconda3\\envs\\labscript_py27\\lib\\site-packages\\mpl_toolkits\\__init__.py\", line 2, in <module>\r\n    __import__('pkg_resources').declare_namespace(__name__)\r\n  File \"C:\\labscript_suite\\labscript_py27\\labscript_utils\\double_import_denier.py\", line 38, in load_module\r\n    return imp.load_module(name, self.fp, self.pathname, self.description)\r\n  File \"C:\\Anaconda3\\envs\\labscript_py27\\lib\\site-packages\\pkg_resources\\__init__.py\", line 50, in <module>\r\n    from pkg_resources.extern import six\r\n  File \"C:\\Anaconda3\\envs\\labscript_py27\\lib\\site-packages\\pkg_resources\\extern\\__init__.py\", line 44, in load_module\r\n    mod = sys.modules[extant]\r\nAttributeError: 'NoneType' object has no attribute 'modules'\r\n```\r\n\r\nIt would be nice to get this fixed soon so that the fix can be in the version of lyse we specify to use with the data collection for @shjohnst vortex paper.", "markup": "markdown", "html": "<p>I get a weird exception that implies that <code>sys</code> is <code>None</code> when using the following import in a lyse script (and then modifying the contents of another imported script, triggering modulewatcher to reload)</p>\n<p>The module to import is: <code>from mpl_toolkits.axes_grid.inset_locator import (inset_axes, InsetPosition, mark_inset)</code>.</p>\n<p>Once you trigger module watcher to reload anything else used by the script, and re-run the analysis, you get the following traceback:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;y_vs_auto.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">24</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"n\">module</span><span class=\"o\">&gt;</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">mpl_toolkits.axes_grid.inset_locator</span> <span class=\"kn\">import</span> <span class=\"p\">(</span><span class=\"n\">inset_axes</span><span class=\"p\">,</span> <span class=\"n\">InsetPosition</span><span class=\"p\">,</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\labscript_suite\\labscript_py27\\labscript_utils\\double_import_denier.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">38</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">load_module</span>\n    <span class=\"k\">return</span> <span class=\"n\">imp</span><span class=\"o\">.</span><span class=\"n\">load_module</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fp</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pathname</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">description</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\Anaconda3\\envs\\labscript_py27\\lib\\site-packages\\mpl_toolkits\\__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"n\">module</span><span class=\"o\">&gt;</span>\n    <span class=\"nb\">__import__</span><span class=\"p\">(</span><span class=\"s1\">&#39;pkg_resources&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">declare_namespace</span><span class=\"p\">(</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\labscript_suite\\labscript_py27\\labscript_utils\\double_import_denier.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">38</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">load_module</span>\n    <span class=\"k\">return</span> <span class=\"n\">imp</span><span class=\"o\">.</span><span class=\"n\">load_module</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fp</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pathname</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">description</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\Anaconda3\\envs\\labscript_py27\\lib\\site-packages\\pkg_resources\\__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">50</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"n\">module</span><span class=\"o\">&gt;</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">pkg_resources.extern</span> <span class=\"kn\">import</span> <span class=\"n\">six</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;C:\\Anaconda3\\envs\\labscript_py27\\lib\\site-packages\\pkg_resources\\extern\\__init__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">44</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">load_module</span>\n    <span class=\"n\">mod</span> <span class=\"o\">=</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">modules</span><span class=\"p\">[</span><span class=\"n\">extant</span><span class=\"p\">]</span>\n<span class=\"ne\">AttributeError</span><span class=\"p\">:</span> <span class=\"s1\">&#39;NoneType&#39;</span> <span class=\"nb\">object</span> <span class=\"n\">has</span> <span class=\"n\">no</span> <span class=\"n\">attribute</span> <span class=\"s1\">&#39;modules&#39;</span>\n</pre></div>\n\n\n<p>It would be nice to get this fixed soon so that the fix can be in the version of lyse we specify to use with the data collection for @shjohnst vortex paper.</p>", "type": "rendered"}, "assignee": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2018-10-24T07:22:31.970420+00:00", "milestone": null, "updated_on": "2019-06-03T13:42:51.896044+00:00", "type": "issue", "id": 39}