{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/48/comments/51904039.json"}, "html": {"href": "#!/labscript_suite/lyse/issues/48#comment-51904039"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/issues/48.json"}}, "type": "issue", "id": 48, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/lyse.json"}, "html": {"href": "#!/labscript_suite/lyse"}, "avatar": {"href": "data/bytebucket.org/ravatar/{55eebdfe-43d1-4ae8-9049-50c55b295397}ts=249921"}}, "type": "repository", "name": "lyse", "full_name": "labscript_suite/lyse", "uuid": "{55eebdfe-43d1-4ae8-9049-50c55b295397}"}, "title": "Unable to fork a process from a lyse script with multiprocessing"}, "content": {"raw": "So it runs the first time, the subprocess runs, it even displays \u201cPrint something\u201d \\(I wasn\u2019t expecting stdout to find its way home, but good stuff\\). And lyse shows the process as completed. \\(no eggtimer\\). \n\n\u200c\n\nHowever running it a second time produces the below traceback. It should be idempotent at this stage, not least because the subprocess prints something and then exits, but even if the subprocess was long-lived, I should be able to kick off a few of them at least! Of course this is not the ultimate aim, but something else is broken here \\(and Steven Li has got this KeyError a few times now in several different way \\(multithread and multiprocess\\) making me thing it is a lyse bug\u2026\n\n`Traceback (most recent call last):`  \n`File \"C:\\Program Files\\Anaconda3\\envs\\python37\\lib\\threading.py\", line 865, in run`  \n`self.target(*self.args, **self.kwargs)`  \n`File \"C:\\labscript_suite\\lyse_main.py\", line 721, in analysis_loop`  \n`self.do_analysis(filepath)`  \n`File \"C:\\labscript_suite\\lyse_main.py\", line 745, in do_analysis`  \n`success, updated_data = routine.do_analysis(filepath)`  \n`File \"C:\\labscript_suite\\lyse_main.py\", line 272, in do_analysis`  \n`signal, data = self.from_worker.get()`  \n`File \"C:\\Program Files\\Anaconda3\\envs\\python37\\lib\\site-packages\\zprocess\\process_tree.py\", line 313, in get`  \n`obj = self.sock.recv_pyobj()`  \n`File \"C:\\Program Files\\Anaconda3\\envs\\python37\\lib\\site-packages\\zmq\\sugar\\socket.py\", line 624, in recv_pyobj`  \n`return self._deserialize(msg, pickle.loads)`  \n`File \"C:\\Program Files\\Anaconda3\\envs\\python37\\lib\\site-packages\\zmq\\sugar\\socket.py\", line 491, in _deserialize`  \n`return load(recvd)`  \n`KeyError: 101`", "markup": "markdown", "html": "<p>So it runs the first time, the subprocess runs, it even displays \u201cPrint something\u201d (I wasn\u2019t expecting stdout to find its way home, but good stuff). And lyse shows the process as completed. (no eggtimer). </p>\n<p>\u200c</p>\n<p>However running it a second time produces the below traceback. It should be idempotent at this stage, not least because the subprocess prints something and then exits, but even if the subprocess was long-lived, I should be able to kick off a few of them at least! Of course this is not the ultimate aim, but something else is broken here (and Steven Li has got this KeyError a few times now in several different way (multithread and multiprocess) making me thing it is a lyse bug\u2026</p>\n<p><code>Traceback (most recent call last):</code><br />\n<code>File \"C:\\Program Files\\Anaconda3\\envs\\python37\\lib\\threading.py\", line 865, in run</code><br />\n<code>self.target(*self.args, **self.kwargs)</code><br />\n<code>File \"C:\\labscript_suite\\lyse_main.py\", line 721, in analysis_loop</code><br />\n<code>self.do_analysis(filepath)</code><br />\n<code>File \"C:\\labscript_suite\\lyse_main.py\", line 745, in do_analysis</code><br />\n<code>success, updated_data = routine.do_analysis(filepath)</code><br />\n<code>File \"C:\\labscript_suite\\lyse_main.py\", line 272, in do_analysis</code><br />\n<code>signal, data = self.from_worker.get()</code><br />\n<code>File \"C:\\Program Files\\Anaconda3\\envs\\python37\\lib\\site-packages\\zprocess\\process_tree.py\", line 313, in get</code><br />\n<code>obj = self.sock.recv_pyobj()</code><br />\n<code>File \"C:\\Program Files\\Anaconda3\\envs\\python37\\lib\\site-packages\\zmq\\sugar\\socket.py\", line 624, in recv_pyobj</code><br />\n<code>return self._deserialize(msg, pickle.loads)</code><br />\n<code>File \"C:\\Program Files\\Anaconda3\\envs\\python37\\lib\\site-packages\\zmq\\sugar\\socket.py\", line 491, in _deserialize</code><br />\n<code>return load(recvd)</code><br />\n<code>KeyError: 101</code></p>", "type": "rendered"}, "created_on": "2019-05-01T07:12:59.852913+00:00", "user": {"display_name": "Lincoln Turner", "uuid": "{dc6eefbb-6560-488e-bd24-b7cabe6e3fb2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdc6eefbb-6560-488e-bd24-b7cabe6e3fb2%7D"}, "html": {"href": "https://bitbucket.org/%7Bdc6eefbb-6560-488e-bd24-b7cabe6e3fb2%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/26c040adc170a4ec90cd9bc4f7ab0479d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsLT-2.png"}}, "nickname": "lincolnturner_monash", "type": "user", "account_id": "5ba47327653ec8726d2a0087"}, "updated_on": null, "type": "issue_comment", "id": 51904039}