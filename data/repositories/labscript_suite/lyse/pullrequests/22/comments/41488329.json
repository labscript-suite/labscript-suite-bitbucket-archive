{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/22/comments/41488329.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/22/_/diff#comment-41488329"}}, "parent": {"id": 41486481, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/22/comments/41486481.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/22/_/diff#comment-41486481"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 22, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/22.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/22"}}, "title": "Unicode strings and other Python 3 forward-compatible changes."}, "content": {"raw": "OK, I've added the working directory change, but it turns out that's not what was tripping up the linecache module - the linecache module was looking relative to entries in sys.path, and we had added the script's directory to sys.path but as a unicode string - it should be a bytestring. So now I'm adding to sys.path as a bytestring (on python 2 - it's a unicode string on Python 3).\n\nA remaining issue is if the filesystem encoding is *not* actually UTF8. I don't know if this is ever the case, so I'll have a quick read to see what the situation is on Windows. I suspect that even though Windows might not be UTF8, that from Python's perspective, for all intents and purposes it is.\n\nIf it's not UTF8 then we're in trouble because the filepath is going to be concatenated with the rest of the trackback in error messages as bytestrings, so if the filepath is say, UTF16, then that concatenation makes no sense and can't be decoded meaningfully.", "markup": "markdown", "html": "<p>OK, I've added the working directory change, but it turns out that's not what was tripping up the linecache module - the linecache module was looking relative to entries in sys.path, and we had added the script's directory to sys.path but as a unicode string - it should be a bytestring. So now I'm adding to sys.path as a bytestring (on python 2 - it's a unicode string on Python 3).</p>\n<p>A remaining issue is if the filesystem encoding is <em>not</em> actually UTF8. I don't know if this is ever the case, so I'll have a quick read to see what the situation is on Windows. I suspect that even though Windows might not be UTF8, that from Python's perspective, for all intents and purposes it is.</p>\n<p>If it's not UTF8 then we're in trouble because the filepath is going to be concatenated with the rest of the trackback in error messages as bytestrings, so if the filepath is say, UTF16, then that concatenation makes no sense and can't be decoded meaningfully.</p>", "type": "rendered"}, "created_on": "2017-07-25T22:48:53.897888+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-07-25T22:48:53.900001+00:00", "type": "pullrequest_comment", "id": 41488329}