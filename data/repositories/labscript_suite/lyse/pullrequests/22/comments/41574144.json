{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/22/comments/41574144.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/22/_/diff#comment-41574144"}}, "parent": {"id": 41573334, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/22/comments/41573334.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/22/_/diff#comment-41573334"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 22, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/22.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/22"}}, "title": "Unicode strings and other Python 3 forward-compatible changes."}, "content": {"raw": "Not sure what it was but justadding in all the changes of the dataframe repo to a clone of your branch by hand did the trick and everything is working fine. I might have just missed adding or removing a line when adding one of your commits earlier. Sorry for the confusion. (just to be sure I'll diff all lyse files on my computer with those in the lab tomorrow)\n\nUpdate: Ok so I'm in the lab now using a clone of your unicode branch(no additional changes) and I'm encountering the bug there. So it does seem to be linked to the unicode stuff. Here is what I'm doing:\n\n```\n#!python\n\nfrom lyse import *\nimport matplotlib.pyplot as plt\nimport numpy as np\n\ndf = data()\nprint(df['scan_freq'])\ndf = df.groupby('scan_freq').mean().reset_index()\n```\n\n\"scan_freq\" is just a float global. Without the unicod stuff there is no error and the output of the print looks like this:\n\n\n```\n#!python\n\nsequence                   run time                 \n2017-06-06 14:44:40+02:00  2017-06-06 14:45:09+02:00    2.7\n                           2017-06-06 14:45:10+02:00    2.7\n                           2017-06-06 14:45:11+02:00    2.7\n                           2017-06-06 14:45:12+02:00    2.7\n                           2017-06-06 14:45:13+02:00    2.7\n                           2017-06-06 14:45:14+02:00    2.8\n                           2017-06-06 14:45:15+02:00    2.8\n                           2017-06-06 14:45:16+02:00    2.8\n                           2017-06-06 14:45:18+02:00    2.8\n                           2017-06-06 14:45:19+02:00    2.8\nName: scan_freq, dtype: float64\n```\n\nWith unicode it looks like this and there is the error and the print looks like this:\n\n\n```\n#!python\n\nsequence                  run time                      \n2017-06-06 14:44:40+02:00 2017-06-06 14:45:09+02:00  2.7\n                          2017-06-06 14:45:10+02:00  2.7\n                          2017-06-06 14:45:11+02:00  2.7\n                          2017-06-06 14:45:12+02:00  2.7\n                          2017-06-06 14:45:13+02:00  2.7\n                          2017-06-06 14:45:14+02:00  2.8\n                          2017-06-06 14:45:15+02:00  2.8\n                          2017-06-06 14:45:16+02:00  2.8\n                          2017-06-06 14:45:18+02:00  2.8\n                          2017-06-06 14:45:19+02:00  2.8\n\n```\nIt's missing the line with Name and dtype for some reason.\n\nIf i change the index that I group by from 'scan_freq' to the tuple ('scan_freq', '') everything is fine. I'll investigate this error a bit more and report back if I find what is causing this. (Not sure why I was not seeing the error under mac yesterday after updating to the same clone of your branch)\n\nUpdate 2: Ok so I found another hacky fix that you will probably not be happy with in '''flat_dict_to_hierarchical_dataframe''' line 97-98 change it to this:\n```\n#!python\n\n        while len(newkey) < max_tuple_length:\n            newkey += (b'',)\n```\n\nI'm think pandas must treat empty byte strings in it's index differently from unicode strings.", "markup": "markdown", "html": "<p>Not sure what it was but justadding in all the changes of the dataframe repo to a clone of your branch by hand did the trick and everything is working fine. I might have just missed adding or removing a line when adding one of your commits earlier. Sorry for the confusion. (just to be sure I'll diff all lyse files on my computer with those in the lab tomorrow)</p>\n<p>Update: Ok so I'm in the lab now using a clone of your unicode branch(no additional changes) and I'm encountering the bug there. So it does seem to be linked to the unicode stuff. Here is what I'm doing:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">lyse</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n<span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"kn\">as</span> <span class=\"nn\">plt</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"kn\">as</span> <span class=\"nn\">np</span>\n\n<span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"p\">()</span>\n<span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;scan_freq&#39;</span><span class=\"p\">])</span>\n<span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;scan_freq&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">reset_index</span><span class=\"p\">()</span>\n</pre></div>\n\n\n<p>\"scan_freq\" is just a float global. Without the unicod stuff there is no error and the output of the print looks like this:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">sequence</span>                   <span class=\"n\">run</span> <span class=\"n\">time</span>                 \n<span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">44</span><span class=\"p\">:</span><span class=\"mi\">40</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">09</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.7</span>\n                           <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">10</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.7</span>\n                           <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">11</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.7</span>\n                           <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">12</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.7</span>\n                           <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">13</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.7</span>\n                           <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">14</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.8</span>\n                           <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.8</span>\n                           <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">16</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.8</span>\n                           <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">18</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.8</span>\n                           <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">19</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>    <span class=\"mf\">2.8</span>\n<span class=\"n\">Name</span><span class=\"p\">:</span> <span class=\"n\">scan_freq</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"p\">:</span> <span class=\"n\">float64</span>\n</pre></div>\n\n\n<p>With unicode it looks like this and there is the error and the print looks like this:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">sequence</span>                  <span class=\"n\">run</span> <span class=\"n\">time</span>                      \n<span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">44</span><span class=\"p\">:</span><span class=\"mi\">40</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span> <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">09</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.7</span>\n                          <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">10</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.7</span>\n                          <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">11</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.7</span>\n                          <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">12</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.7</span>\n                          <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">13</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.7</span>\n                          <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">14</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.8</span>\n                          <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.8</span>\n                          <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">16</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.8</span>\n                          <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">18</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.8</span>\n                          <span class=\"mi\">2017</span><span class=\"o\">-</span><span class=\"mo\">06</span><span class=\"o\">-</span><span class=\"mo\">06</span> <span class=\"mi\">14</span><span class=\"p\">:</span><span class=\"mi\">45</span><span class=\"p\">:</span><span class=\"mi\">19</span><span class=\"o\">+</span><span class=\"mo\">02</span><span class=\"p\">:</span><span class=\"mo\">00</span>  <span class=\"mf\">2.8</span>\n</pre></div>\n\n\n<p>It's missing the line with Name and dtype for some reason.</p>\n<p>If i change the index that I group by from 'scan_freq' to the tuple ('scan_freq', '') everything is fine. I'll investigate this error a bit more and report back if I find what is causing this. (Not sure why I was not seeing the error under mac yesterday after updating to the same clone of your branch)</p>\n<p>Update 2: Ok so I found another hacky fix that you will probably not be happy with in '''flat_dict_to_hierarchical_dataframe''' line 97-98 change it to this:</p>\n<div class=\"codehilite language-python\"><pre><span></span>        <span class=\"k\">while</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">newkey</span><span class=\"p\">)</span> <span class=\"o\">&lt;</span> <span class=\"n\">max_tuple_length</span><span class=\"p\">:</span>\n            <span class=\"n\">newkey</span> <span class=\"o\">+=</span> <span class=\"p\">(</span><span class=\"sa\">b</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">,)</span>\n</pre></div>\n\n\n<p>I'm think pandas must treat empty byte strings in it's index differently from unicode strings.</p>", "type": "rendered"}, "created_on": "2017-07-26T19:21:03.703512+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2017-07-27T12:28:14.733434+00:00", "type": "pullrequest_comment", "id": 41574144}