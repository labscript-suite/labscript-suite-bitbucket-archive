{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/22/comments/41655678.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/22/_/diff#comment-41655678"}}, "parent": {"id": 41649565, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/22/comments/41649565.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/22/_/diff#comment-41649565"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 22, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/22.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/22"}}, "title": "Unicode strings and other Python 3 forward-compatible changes."}, "content": {"raw": "I've fixed the bug in pandas:\n\n\n```\n#!diff\n\ndiff --git a/pandas/core/frame.py b/pandas/core/frame.py\nindex e546e96..586d431 100644\n--- a/pandas/core/frame.py\n+++ b/pandas/core/frame.py\n@@ -2112,8 +2112,9 @@ it is assumed to be aliases for the column names')\n                 result = result.__finalize__(self)\n             if len(result.columns) == 1:\n                 top = result.columns[0]\n-                if ((type(top) == str and top == '') or\n-                        (type(top) == tuple and top[0] == '')):\n+                if isinstance(top, tuple):\n+                    top = top[0]\n+                if top == '':\n                     result = result['']\n                     if isinstance(result, Series):\n                         result = self._constructor_sliced(result,\n```\nYou can see that the problem was that the code only looked for empty strings of type `str`, which in Python 2 excludes unicode strings. Instead it should accept anything that passes an equality check with `''`. And indeed this is my fault - I wrote these lines originally to allow for the abbreviated syntax `df['test']` for `df['test', '']`.\n \nI'll make sure the pandas test suite passes and then make a pull request with them. Looks like they're on a monthly-ish release cycle so if we're lucky the fix might be in pandas 0.20.4 in early August.", "markup": "markdown", "html": "<p>I've fixed the bug in pandas:</p>\n<div class=\"codehilite language-diff\"><pre><span></span><span class=\"gh\">diff --git a/pandas/core/frame.py b/pandas/core/frame.py</span>\n<span class=\"gh\">index e546e96..586d431 100644</span>\n<span class=\"gd\">--- a/pandas/core/frame.py</span>\n<span class=\"gi\">+++ b/pandas/core/frame.py</span>\n<span class=\"gu\">@@ -2112,8 +2112,9 @@ it is assumed to be aliases for the column names&#39;)</span>\n                 result = result.__finalize__(self)\n             if len(result.columns) == 1:\n                 top = result.columns[0]\n<span class=\"gd\">-                if ((type(top) == str and top == &#39;&#39;) or</span>\n<span class=\"gd\">-                        (type(top) == tuple and top[0] == &#39;&#39;)):</span>\n<span class=\"gi\">+                if isinstance(top, tuple):</span>\n<span class=\"gi\">+                    top = top[0]</span>\n<span class=\"gi\">+                if top == &#39;&#39;:</span>\n                     result = result[&#39;&#39;]\n                     if isinstance(result, Series):\n                         result = self._constructor_sliced(result,\n</pre></div>\n\n\n<p>You can see that the problem was that the code only looked for empty strings of type <code>str</code>, which in Python 2 excludes unicode strings. Instead it should accept anything that passes an equality check with <code>''</code>. And indeed this is my fault - I wrote these lines originally to allow for the abbreviated syntax <code>df['test']</code> for <code>df['test', '']</code>.</p>\n<p>I'll make sure the pandas test suite passes and then make a pull request with them. Looks like they're on a monthly-ish release cycle so if we're lucky the fix might be in pandas 0.20.4 in early August.</p>", "type": "rendered"}, "created_on": "2017-07-27T16:35:49.664533+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-07-27T16:38:25.257512+00:00", "type": "pullrequest_comment", "id": 41655678}