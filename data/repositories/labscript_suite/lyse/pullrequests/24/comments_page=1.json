{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/42954119.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-42954119"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 24, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24"}}, "title": "Performance"}, "content": {"raw": "If it's any help this is also running for about 2 or 3 weeks without problems in our lab.", "markup": "markdown", "html": "<p>If it's any help this is also running for about 2 or 3 weeks without problems in our lab.</p>", "type": "rendered"}, "created_on": "2017-08-16T19:17:12.313728+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2017-08-16T19:17:12.369422+00:00", "type": "pullrequest_comment", "id": 42954119}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/42954440.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-42954440"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 24, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24"}}, "title": "Performance"}, "content": {"raw": "This one I haven't reviewed, so I will need to read through it first, but it's good to hear it's well-tested.", "markup": "markdown", "html": "<p>This one I haven't reviewed, so I will need to read through it first, but it's good to hear it's well-tested.</p>", "type": "rendered"}, "created_on": "2017-08-16T19:22:13.863136+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-08-16T19:22:25.577461+00:00", "type": "pullrequest_comment", "id": 42954440}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/42955029.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-42955029"}}, "parent": {"id": 42954440, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/42954440.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-42954440"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 24, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24"}}, "title": "Performance"}, "content": {"raw": "Most of it we already discussed over at #29.\n\nBut take your time :) I just wanted to point out that this is tested for a while.", "markup": "markdown", "html": "<p>Most of it we already discussed over at <a href=\"#!/labscript_suite/lyse/issues/29/speed-up-shot-loading\" rel=\"nofollow\" title=\"speed up shot loading\" class=\"ap-connect-link\">#29</a>.</p>\n<p>But take your time :) I just wanted to point out that this is tested for a while.</p>", "type": "rendered"}, "created_on": "2017-08-16T19:30:15.293780+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2017-08-16T19:30:15.370022+00:00", "type": "pullrequest_comment", "id": 42955029}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/42956730.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-42956730"}}, "parent": {"id": 42954440, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/42954440.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-42954440"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 24, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24"}}, "title": "Performance"}, "content": {"raw": "Oh and to test this with lots of rows at once you can either set your add_files queue to something greater then 5 or use this [pull requests code](#!/labscript_suite/lyse/pull-requests/26/save-dataframes/diff). Later should be quicker.", "markup": "markdown", "html": "<p>Oh and to test this with lots of rows at once you can either set your add_files queue to something greater then 5 or use this <a data-is-external-link=\"true\" href=\"#!/labscript_suite/lyse/pull-requests/26/save-dataframes/diff\" rel=\"nofollow\">pull requests code</a>. Later should be quicker.</p>", "type": "rendered"}, "created_on": "2017-08-16T19:57:31.995112+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2017-08-16T19:57:32.055591+00:00", "type": "pullrequest_comment", "id": 42956730}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/49235729.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-49235729"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 24, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24"}}, "title": "Performance"}, "content": {"raw": "Did anyone ever get around to test this?", "markup": "markdown", "html": "<p>Did anyone ever get around to test this?</p>", "type": "rendered"}, "created_on": "2017-11-09T20:22:51.541879+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2017-11-09T20:22:51.581979+00:00", "type": "pullrequest_comment", "id": 49235729}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/54149806.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-54149806"}}, "parent": {"id": 49235729, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/49235729.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-49235729"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 24, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24"}}, "title": "Performance"}, "content": {"raw": "We're finally looking in to speeding up analysis of a lot of images from separate shots and figured we'd give this a try. It seems to be working for us just fine and provides ~10% speed-up even when using the 5 shot chunking. I'd call that a success.", "markup": "markdown", "html": "<p>We're finally looking in to speeding up analysis of a lot of images from separate shots and figured we'd give this a try. It seems to be working for us just fine and provides ~10% speed-up even when using the 5 shot chunking. I'd call that a success.</p>", "type": "rendered"}, "created_on": "2018-01-19T16:00:14.715196+00:00", "user": {"display_name": "David Meyer", "uuid": "{8df655d6-8661-4957-b4ba-669cef19bf2d}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B8df655d6-8661-4957-b4ba-669cef19bf2d%7D"}, "html": {"href": "https://bitbucket.org/%7B8df655d6-8661-4957-b4ba-669cef19bf2d%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/2a4efe81a17e5aeccdbc4ef2ca2cc463d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsDM-0.png"}}, "nickname": "dihm", "type": "user", "account_id": "557058:411f7712-e1fa-438c-b578-0359da2d9f06"}, "updated_on": "2018-01-19T16:00:14.766225+00:00", "type": "pullrequest_comment", "id": 54149806}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/57244434.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-57244434"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 24, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24"}}, "title": "Performance"}, "content": {"raw": "There seem to be some problems (or suboptimal/unnecessary things) with this  at the moment, which I believe I've fixed.\n\n1. `self.rows_dict` doesn't appear to be updated when shots are deleted, leaving it with invalid data. Fix is to update it when shots are deleted. Some additional functionality added in the meantime already does some tracking of row numbers, so I've just integrated it with that.\n\n2. `add_files()` providing a `df_row_index` argument doesn't add much if we are switching to dictionary lookups rather than searching the dataframe for getting the index. Dictionary lookups are crazy fast. I've removed `df_row_index` and just had a dictionary lookup within `update_row()`. This removes any further fear of race conditions.\n\n3. The set comparison business to detect duplicates is faster than manually searching, but if there are a large number of files in lyse requires copying the whole list of files to do the set operations. Checking for membership a few times in an existing set or dict is faster than making a whole new set, and so we should check for membership in  the dictionary of row numbers that we already have.\n\n4.  `do_multishot_analysis()` doesn't run in the main thread, so using `df_row_index` is vulnerable to race conditions. Removed this since I removed `df_row_index` anyway. \n\nWhat this comes down to is that most of the benefits of this pull request are by caching the row indices instead of looking them up. I've made a new pull request for the remaining changes (and fixes) that this entails, as well as a more efficient batch-processing of loading files and make the renumber_rows() function not loop over all rows when only some have changed.\n\nSo I'll close this one, and would appreciate any testing of pull request #40, which I have put through some testing already but more is better.", "markup": "markdown", "html": "<p>There seem to be some problems (or suboptimal/unnecessary things) with this  at the moment, which I believe I've fixed.</p>\n<ol>\n<li>\n<p><code>self.rows_dict</code> doesn't appear to be updated when shots are deleted, leaving it with invalid data. Fix is to update it when shots are deleted. Some additional functionality added in the meantime already does some tracking of row numbers, so I've just integrated it with that.</p>\n</li>\n<li>\n<p><code>add_files()</code> providing a <code>df_row_index</code> argument doesn't add much if we are switching to dictionary lookups rather than searching the dataframe for getting the index. Dictionary lookups are crazy fast. I've removed <code>df_row_index</code> and just had a dictionary lookup within <code>update_row()</code>. This removes any further fear of race conditions.</p>\n</li>\n<li>\n<p>The set comparison business to detect duplicates is faster than manually searching, but if there are a large number of files in lyse requires copying the whole list of files to do the set operations. Checking for membership a few times in an existing set or dict is faster than making a whole new set, and so we should check for membership in  the dictionary of row numbers that we already have.</p>\n</li>\n<li>\n<p><code>do_multishot_analysis()</code> doesn't run in the main thread, so using <code>df_row_index</code> is vulnerable to race conditions. Removed this since I removed <code>df_row_index</code> anyway. </p>\n</li>\n</ol>\n<p>What this comes down to is that most of the benefits of this pull request are by caching the row indices instead of looking them up. I've made a new pull request for the remaining changes (and fixes) that this entails, as well as a more efficient batch-processing of loading files and make the renumber_rows() function not loop over all rows when only some have changed.</p>\n<p>So I'll close this one, and would appreciate any testing of <a href=\"#!/labscript_suite/lyse/pull-requests/40/performance-optimisation\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #40</a>, which I have put through some testing already but more is better.</p>", "type": "rendered"}, "created_on": "2018-02-26T06:18:47.070192+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2018-02-26T06:21:32.698877+00:00", "type": "pullrequest_comment", "id": 57244434}, {"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/57256775.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-57256775"}}, "parent": {"id": 57244434, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24/comments/57244434.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24/_/diff#comment-57244434"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 24, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/24.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/24"}}, "title": "Performance"}, "content": {"raw": "Good to see that you are back  :slight_smile: \n\n1. This is correct I must have missed to add this.\n2. Sounds about right. I'll test the changes you made in your pull request later today and see if I notice any speedup or slow down when it comes to mulitshot routines saving data.\n3. This sounds like it might be faster than what I originally did I'll also test this.\n4. As mentioned in 2 I will have a look into if this slows down anything for us.\n\nI'll report back on my results testing your new pull request.", "markup": "markdown", "html": "<p>Good to see that you are back  <img class=\"emoji\" src=\"data/pf-emoji-service--cdn.us-east-1.prod.public.atl-paas.net/standard/551c9814-1d37-4573-819d-afab3afeaf32/48x48/1f642.png\" alt=\"\ud83d\ude42\" title=\":slight_smile:\" data-emoji-short-name=\":slight_smile:\" /> </p>\n<ol>\n<li>This is correct I must have missed to add this.</li>\n<li>Sounds about right. I'll test the changes you made in your pull request later today and see if I notice any speedup or slow down when it comes to mulitshot routines saving data.</li>\n<li>This sounds like it might be faster than what I originally did I'll also test this.</li>\n<li>As mentioned in 2 I will have a look into if this slows down anything for us.</li>\n</ol>\n<p>I'll report back on my results testing your new pull request.</p>", "type": "rendered"}, "created_on": "2018-02-26T09:02:22.066947+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2018-02-26T09:02:22.136146+00:00", "type": "pullrequest_comment", "id": 57256775}], "page": 1, "size": 8}