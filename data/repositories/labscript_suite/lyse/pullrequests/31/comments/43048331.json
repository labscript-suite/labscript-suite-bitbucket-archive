{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/31/comments/43048331.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/31/_/diff#comment-43048331"}}, "parent": {"id": 43047947, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/31/comments/43047947.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/31/_/diff#comment-43047947"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 31, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/31.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/31"}}, "title": "Fix a bug in updating the dataframe"}, "content": {"raw": "After fix there are still exceptions being thrown. I ran the following script:\n\n\n```\n#!python\n\nfrom lyse import *\nser = data(path)\nrun = Run(path)\n\nrun.save_result('x', [1,2,3,4,5])\n```\n\nOn first run I get a exception with lyse analysis loop crashing. \n\n```\n#!python\n\nTraceback (most recent call last):\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/threading.py\", line 754, in run\n    self.__target(*self.__args, **self.__kwargs)\n  File \"/Users/janwerkmann/labscript_suite/lyse/__main__.py\", line 1726, in analysis_loop\n    self.do_singleshot_analysis(filepath)\n  File \"/Users/janwerkmann/labscript_suite/lyse/__main__.py\", line 1764, in do_singleshot_analysis\n    self.shots_model.update_row(file, updated_row_data=updated_data[file])\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/qtutils/invoke_in_main.py\", line 121, in f\n    return inmain(fn, *args, **kwargs)\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/qtutils/invoke_in_main.py\", line 76, in inmain\n    return get_inmain_result(in_main_later(fn, False, *args, **kwargs))\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/qtutils/invoke_in_main.py\", line 99, in get_inmain_result\n    exec('raise type, value, traceback')\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/qtutils/invoke_in_main.py\", line 53, in event\n    result = event.fn(*event.args, **event.kwargs)\n  File \"/Users/janwerkmann/labscript_suite/lyse/__main__.py\", line 1344, in update_row\n    self.dataframe.set_value(df_row_index, (group, name) + ('',) * (self.nlevels - 2), updated_row_data[group, name])\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/pandas/core/frame.py\", line 1861, in set_value\n    self.loc[index, col] = value\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/pandas/core/indexing.py\", line 179, in __setitem__\n    self._setitem_with_indexer(indexer, value)\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/pandas/core/indexing.py\", line 341, in _setitem_with_indexer\n    self._setitem_with_indexer(new_indexer, value)\n  File \"/Users/janwerkmann/anaconda/lib/python2.7/site-packages/pandas/core/indexing.py\", line 579, in _setitem_with_indexer\n    raise ValueError('Must have equal len keys and value '\nValueError: Must have equal len keys and value when setting with an iterable\n```\n\nIf I then restart lyse and load the same files as before everything works like a breeze. If I then restart lyse and add files that don't habe 'x' in them it crashes again.", "markup": "markdown", "html": "<p>After fix there are still exceptions being thrown. I ran the following script:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">lyse</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n<span class=\"n\">ser</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n<span class=\"n\">run</span> <span class=\"o\">=</span> <span class=\"n\">Run</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n\n<span class=\"n\">run</span><span class=\"o\">.</span><span class=\"n\">save_result</span><span class=\"p\">(</span><span class=\"s1\">&#39;x&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">5</span><span class=\"p\">])</span>\n</pre></div>\n\n\n<p>On first run I get a exception with lyse analysis loop crashing. </p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/threading.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">754</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">run</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__target</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__kwargs</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/lyse/__main__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1726</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">analysis_loop</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">do_singleshot_analysis</span><span class=\"p\">(</span><span class=\"n\">filepath</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/lyse/__main__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1764</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">do_singleshot_analysis</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shots_model</span><span class=\"o\">.</span><span class=\"n\">update_row</span><span class=\"p\">(</span><span class=\"nb\">file</span><span class=\"p\">,</span> <span class=\"n\">updated_row_data</span><span class=\"o\">=</span><span class=\"n\">updated_data</span><span class=\"p\">[</span><span class=\"nb\">file</span><span class=\"p\">])</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/qtutils/invoke_in_main.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">121</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">f</span>\n    <span class=\"k\">return</span> <span class=\"n\">inmain</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/qtutils/invoke_in_main.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">76</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">inmain</span>\n    <span class=\"k\">return</span> <span class=\"n\">get_inmain_result</span><span class=\"p\">(</span><span class=\"n\">in_main_later</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"bp\">False</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">))</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/qtutils/invoke_in_main.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">99</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">get_inmain_result</span>\n    <span class=\"k\">exec</span><span class=\"p\">(</span><span class=\"s1\">&#39;raise type, value, traceback&#39;</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/qtutils/invoke_in_main.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">53</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">event</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">fn</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/labscript_suite/lyse/__main__.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1344</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">update_row</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">dataframe</span><span class=\"o\">.</span><span class=\"n\">set_value</span><span class=\"p\">(</span><span class=\"n\">df_row_index</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">group</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">,)</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nlevels</span> <span class=\"o\">-</span> <span class=\"mi\">2</span><span class=\"p\">),</span> <span class=\"n\">updated_row_data</span><span class=\"p\">[</span><span class=\"n\">group</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">])</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/pandas/core/frame.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1861</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">set_value</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">loc</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">col</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/pandas/core/indexing.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">179</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__setitem__</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_setitem_with_indexer</span><span class=\"p\">(</span><span class=\"n\">indexer</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/pandas/core/indexing.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">341</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_setitem_with_indexer</span>\n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_setitem_with_indexer</span><span class=\"p\">(</span><span class=\"n\">new_indexer</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/Users/janwerkmann/anaconda/lib/python2.7/site-packages/pandas/core/indexing.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">579</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_setitem_with_indexer</span>\n    <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s1\">&#39;Must have equal len keys and value &#39;</span>\n<span class=\"ne\">ValueError</span><span class=\"p\">:</span> <span class=\"n\">Must</span> <span class=\"n\">have</span> <span class=\"n\">equal</span> <span class=\"nb\">len</span> <span class=\"n\">keys</span> <span class=\"ow\">and</span> <span class=\"n\">value</span> <span class=\"n\">when</span> <span class=\"n\">setting</span> <span class=\"k\">with</span> <span class=\"n\">an</span> <span class=\"n\">iterable</span>\n</pre></div>\n\n\n<p>If I then restart lyse and load the same files as before everything works like a breeze. If I then restart lyse and add files that don't habe 'x' in them it crashes again.</p>", "type": "rendered"}, "created_on": "2017-08-17T19:16:01.969527+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": "2017-08-17T19:16:02.162113+00:00", "type": "pullrequest_comment", "id": 43048331}