{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/61/comments/100827483.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/61/_/diff#comment-100827483"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 61, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/61.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/61"}}, "title": "Fix for #48: Make analysis_subprocess.py multiprocessing-friendly"}, "content": {"raw": "This PR is also threading-friendly. As per my comments on issue #48, this resolves the identical/related issue observed with `threading.Thread`. There are two subsequent issues if the thread is long-lived, however:\n\n1\\. When the analysis script is modified, `labscript_utils.modulewatcher` detects the latter and reloads all modules \\(at the\\) next run. I then get the following exception:\n\n```\nFile \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\win32\\lib\\pywintypes.py\", line 129, in import_pywin32_system_module\n  assert sys.modules[modname] is not old_mod\nAssertionError\n```\n\n2\\. The subprocess is terminated when the analysis routine is removed, but not when lyse is closed.", "markup": "markdown", "html": "<p>This PR is also threading-friendly. As per my comments on issue <a href=\"#!/labscript_suite/lyse/issues/48/unable-to-fork-a-process-from-a-lyse\" rel=\"nofollow\" title=\"Unable to fork a process from a lyse script with multiprocessing\" class=\"ap-connect-link\"><s>#48</s></a>, this resolves the identical/related issue observed with <code>threading.Thread</code>. There are two subsequent issues if the thread is long-lived, however:</p>\n<p>1. When the analysis script is modified, <code>labscript_utils.modulewatcher</code> detects the latter and reloads all modules (at the) next run. I then get the following exception:</p>\n<div class=\"codehilite\"><pre><span></span>File &quot;C:\\ProgramData\\Anaconda3\\lib\\site-packages\\win32\\lib\\pywintypes.py&quot;, line 129, in import_pywin32_system_module\n  assert sys.modules[modname] is not old_mod\nAssertionError\n</pre></div>\n\n\n<p>2. The subprocess is terminated when the analysis routine is removed, but not when lyse is closed.</p>", "type": "rendered"}, "created_on": "2019-05-03T10:49:47.728485+00:00", "user": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, "updated_on": "2019-05-03T10:49:47.735818+00:00", "type": "pullrequest_comment", "id": 100827483}