{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/61/comments/100884378.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/61/_/diff#comment-100884378"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 61, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/61.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/61"}}, "title": "Fix for #48: Make analysis_subprocess.py multiprocessing-friendly"}, "content": {"raw": "I\u2019m not able to reproduce the \u2018subprocess doesn\u2019t close when lyse closes' issue, assuming I interpreted it correctly. I tested with the following routine:\n\n```python\ndef farm():\n    import time\n    while True:\n        time.sleep(1)\n        print('farm running')\n\nfrom lyse import routine_storage\ntry:\n    thread = routine_storage.thread\nexcept AttributeError:\n    import threading\n    routine_storage.thread = threading.Thread(target=farm)\n    routine_storage.thread.start()\n```\n\nAnd I see in task manager that after closing lyse the analyis routine dies a few seconds later.\n\n\u200c\n\nActually I couldn't reproduce the pywin32 issue either, so I am guessing one or both of these issues depends on exactly what the thread is doing. If the pywin32 issue is not resolved by the aforementioned attempted fix, and in either case for the subprocess not closing, a minimum breaking example might help me reproduce the issue, then I\u2019ll look into it more.", "markup": "markdown", "html": "<p>I\u2019m not able to reproduce the \u2018subprocess doesn\u2019t close when lyse closes' issue, assuming I interpreted it correctly. I tested with the following routine:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">farm</span><span class=\"p\">():</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">time</span>\n    <span class=\"k\">while</span> <span class=\"bp\">True</span><span class=\"p\">:</span>\n        <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n        <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;farm running&#39;</span><span class=\"p\">)</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">lyse</span> <span class=\"kn\">import</span> <span class=\"n\">routine_storage</span>\n<span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"n\">thread</span> <span class=\"o\">=</span> <span class=\"n\">routine_storage</span><span class=\"o\">.</span><span class=\"n\">thread</span>\n<span class=\"k\">except</span> <span class=\"ne\">AttributeError</span><span class=\"p\">:</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">threading</span>\n    <span class=\"n\">routine_storage</span><span class=\"o\">.</span><span class=\"n\">thread</span> <span class=\"o\">=</span> <span class=\"n\">threading</span><span class=\"o\">.</span><span class=\"n\">Thread</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"o\">=</span><span class=\"n\">farm</span><span class=\"p\">)</span>\n    <span class=\"n\">routine_storage</span><span class=\"o\">.</span><span class=\"n\">thread</span><span class=\"o\">.</span><span class=\"n\">start</span><span class=\"p\">()</span>\n</pre></div>\n\n\n<p>And I see in task manager that after closing lyse the analyis routine dies a few seconds later.</p>\n<p>\u200c</p>\n<p>Actually I couldn't reproduce the pywin32 issue either, so I am guessing one or both of these issues depends on exactly what the thread is doing. If the pywin32 issue is not resolved by the aforementioned attempted fix, and in either case for the subprocess not closing, a minimum breaking example might help me reproduce the issue, then I\u2019ll look into it more.</p>", "type": "rendered"}, "created_on": "2019-05-03T18:31:34.037054+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2019-05-03T18:31:34.043784+00:00", "type": "pullrequest_comment", "id": 100884378}