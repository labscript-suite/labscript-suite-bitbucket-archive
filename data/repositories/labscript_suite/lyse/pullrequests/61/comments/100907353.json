{"links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/61/comments/100907353.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/61/_/diff#comment-100907353"}}, "parent": {"id": 100904961, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/61/comments/100904961.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/61/_/diff#comment-100904961"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 61, "links": {"self": {"href": "data/repositories/labscript_suite/lyse/pullrequests/61.json"}, "html": {"href": "#!/labscript_suite/lyse/pull-requests/61"}}, "title": "Fix for #48: Make analysis_subprocess.py multiprocessing-friendly"}, "content": {"raw": "Sorry, I\u2019ve struggled to get a minimal breaking example \u2018working\u2019. The unterminated subprocesses derive from subclasses of `multiprocessing.Process` in [M-LOOP/learners.py](https://github.com/michaelhush/M-LOOP/blob/master/mloop/learners.py). I have tried setting `daemon=True` upon instantiation of these objects, to no avail. [ProcessExplorer](https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer) reports the `ZPROCESS_PARENTINFO` for this process. I don\u2019t suppose that\u2019s of any use? I should also mention that the process terminates:\n\n1. when left to its own devices, i.e. an M-LOOP optimisation completes; or\n2. when the worker process for the analysis routine is restarted \\(right-click menu\\); or\n3. when the analysis routine is removed.\n\nIt seems as though if lyse can manage to terminate the subprocess in cases \\(2\\) and \\(3\\) above, it should also be able to do so at shutdown.", "markup": "markdown", "html": "<p>Sorry, I\u2019ve struggled to get a minimal breaking example \u2018working\u2019. The unterminated subprocesses derive from subclasses of <code>multiprocessing.Process</code> in <a data-is-external-link=\"true\" href=\"https://github.com/michaelhush/M-LOOP/blob/master/mloop/learners.py\" rel=\"nofollow\">M-LOOP/learners.py</a>. I have tried setting <code>daemon=True</code> upon instantiation of these objects, to no avail. <a data-is-external-link=\"true\" href=\"https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer\" rel=\"nofollow\">ProcessExplorer</a> reports the <code>ZPROCESS_PARENTINFO</code> for this process. I don\u2019t suppose that\u2019s of any use? I should also mention that the process terminates:</p>\n<ol>\n<li>when left to its own devices, i.e. an M-LOOP optimisation completes; or</li>\n<li>when the worker process for the analysis routine is restarted (right-click menu); or</li>\n<li>when the analysis routine is removed.</li>\n</ol>\n<p>It seems as though if lyse can manage to terminate the subprocess in cases (2) and (3) above, it should also be able to do so at shutdown.</p>", "type": "rendered"}, "created_on": "2019-05-04T07:49:54.282907+00:00", "user": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, "updated_on": "2019-05-06T05:10:15.536986+00:00", "type": "pullrequest_comment", "id": 100907353}