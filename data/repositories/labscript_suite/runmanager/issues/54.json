{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/runmanager.json"}, "html": {"href": "#!/labscript_suite/runmanager"}, "avatar": {"href": "data/bytebucket.org/ravatar/{9b4f21e6-54b0-41ea-8f01-db1919f2f790}ts=249918"}}, "type": "repository", "name": "runmanager", "full_name": "labscript_suite/runmanager", "uuid": "{9b4f21e6-54b0-41ea-8f01-db1919f2f790}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/runmanager/issues/54/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/runmanager/issues/54.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/runmanager/issues/54/watch"}, "comments": {"href": "data/repositories/labscript_suite/runmanager/issues/54/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/runmanager/issues/54/runmanager-doesnt-cache-the-labscript-file"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/runmanager/issues/54/vote"}}, "reporter": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "title": "runmanager doesn't cache the labscript file when compiling shots", "component": null, "votes": 0, "watches": 1, "content": {"raw": "runmanager sequentially instructs the batch compiler to compile each shot in a sequence and sends the labscript file path and the HDF5 file path to the batch compiler process.\r\n\r\nBecause only the path to the labscript file is passed, if a user modifies and saves the labscript file **during** the compilation,  then some shots will use the old labscript file, and some will use the new labscript file, rendering the results of the sequence meaningless.\r\n\r\nI think in order to protect against this we need to:\r\n\r\n1. cache a copy of the labscript file rather than exec-ing the file itself\r\n2. Use module watcher to detect changes to modules used by the labscript file and abort a compilation sequence if anything changes.\r\n\r\nAlternatively, if #47 was implemented, we might be able to solve point 2 above by holding the module watcher lock across the compilation of all shots.\r\n\r\nNote: There may be other corner cases I've missed in this analysis.", "markup": "markdown", "html": "<p>runmanager sequentially instructs the batch compiler to compile each shot in a sequence and sends the labscript file path and the HDF5 file path to the batch compiler process.</p>\n<p>Because only the path to the labscript file is passed, if a user modifies and saves the labscript file <strong>during</strong> the compilation,  then some shots will use the old labscript file, and some will use the new labscript file, rendering the results of the sequence meaningless.</p>\n<p>I think in order to protect against this we need to:</p>\n<ol>\n<li>cache a copy of the labscript file rather than exec-ing the file itself</li>\n<li>Use module watcher to detect changes to modules used by the labscript file and abort a compilation sequence if anything changes.</li>\n</ol>\n<p>Alternatively, if <a href=\"#!/labscript_suite/runmanager/issues/47/move-file-creation-to-compile-loop\" rel=\"nofollow\" title=\"Move file creation to compile loop\" class=\"ap-connect-link\">#47</a> was implemented, we might be able to solve point 2 above by holding the module watcher lock across the compilation of all shots.</p>\n<p>Note: There may be other corner cases I've missed in this analysis.</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2018-03-13T22:41:12.307659+00:00", "milestone": null, "updated_on": "2018-03-27T23:22:12.311290+00:00", "type": "issue", "id": 54}