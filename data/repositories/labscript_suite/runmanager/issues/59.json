{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/runmanager.json"}, "html": {"href": "#!/labscript_suite/runmanager"}, "avatar": {"href": "data/bytebucket.org/ravatar/{9b4f21e6-54b0-41ea-8f01-db1919f2f790}ts=249918"}}, "type": "repository", "name": "runmanager", "full_name": "labscript_suite/runmanager", "uuid": "{9b4f21e6-54b0-41ea-8f01-db1919f2f790}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/runmanager/issues/59/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/runmanager/issues/59.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/runmanager/issues/59/watch"}, "comments": {"href": "data/repositories/labscript_suite/runmanager/issues/59/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/runmanager/issues/59/keypresses-are-registered-twice"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/runmanager/issues/59/vote"}}, "reporter": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, "title": "Keypresses are registered twice", "component": null, "votes": 0, "watches": 1, "content": {"raw": "Since Qt5 (pull request #9), keypress events have been registered twice. Below I have debugged this by adding `logger.info` lines to [`on_keyPress`](#!/labscript_suite/runmanager/src/b77c04761d98bce8e15f41f109d37145264bacb9/__main__.py?at=default&fileviewer=file-view-default#__main__.py-1559) and [`on_keyRelease`](#!/labscript_suite/runmanager/src/b77c04761d98bce8e15f41f109d37145264bacb9/__main__.py?at=default&fileviewer=file-view-default#__main__.py-1579) .\r\n\r\nPressing F5 once used to (up to and including 7637500) result in:\r\n\r\n```\r\n2018-05-30 17:07:41,486 INFO runmanager: on_keyPress: F5\r\n2018-05-30 17:07:45,592 INFO runmanager: on_keyRelease: F5\r\n2018-05-30 17:07:45,594 INFO runmanager: Engage\r\n2018-05-30 17:07:45,595 INFO runmanager: Parsing globals...\r\n2018-05-30 17:07:45,607 INFO runmanager: Making h5 files\r\n2018-05-30 17:07:45,609 INFO runmanager: end engage\r\n```\r\n... but now results in (ba6441e and beyond):\r\n```\r\n2018-05-30 17:10:28,493 INFO runmanager: on_keyPress: F5\r\n2018-05-30 17:10:28,496 INFO runmanager: on_keyPress: F5\r\n2018-05-30 17:10:30,209 INFO runmanager: on_keyRelease: F5\r\n2018-05-30 17:10:30,210 INFO runmanager: Engage\r\n2018-05-30 17:10:30,210 INFO runmanager: Parsing globals...\r\n2018-05-30 17:10:30,415 INFO runmanager: Making h5 files\r\n2018-05-30 17:10:30,417 INFO runmanager: end engage\r\n2018-05-30 17:10:30,424 INFO runmanager: on_keyRelease: F5\r\n2018-05-30 17:10:30,424 INFO runmanager: Engage\r\n2018-05-30 17:10:30,424 INFO runmanager: Parsing globals...\r\n2018-05-30 17:10:30,430 INFO runmanager: Making h5 files\r\n2018-05-30 17:10:30,437 INFO runmanager: end engage\r\n```\r\nTo properly intercept the `QtCore.QEvent.KeyPress` and not have it handled twice, [`notify`](#!/labscript_suite/runmanager/src/b77c04761d98bce8e15f41f109d37145264bacb9/__main__.py?at=default&fileviewer=file-view-default#__main__.py-161) of `KeyPressQApplication` should return 1 (or `True`) for relevant events [SO](https://stackoverflow.com/a/45446380).", "markup": "markdown", "html": "<p>Since Qt5 (<a href=\"#!/labscript_suite/runmanager/pull-requests/9/qtutils-200-support-and-experimental-pyqt5\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #9</a>), keypress events have been registered twice. Below I have debugged this by adding <code>logger.info</code> lines to <a data-is-external-link=\"true\" href=\"#!/labscript_suite/runmanager/src/b77c04761d98bce8e15f41f109d37145264bacb9/__main__.py?at=default&amp;fileviewer=file-view-default#__main__.py-1559\" rel=\"nofollow\"><code>on_keyPress</code></a> and <a data-is-external-link=\"true\" href=\"#!/labscript_suite/runmanager/src/b77c04761d98bce8e15f41f109d37145264bacb9/__main__.py?at=default&amp;fileviewer=file-view-default#__main__.py-1579\" rel=\"nofollow\"><code>on_keyRelease</code></a> .</p>\n<p>Pressing F5 once used to (up to and including <a href=\"#!/labscript_suite/runmanager/commits/7637500\" rel=\"nofollow\" class=\"ap-connect-link\">7637500</a>) result in:</p>\n<div class=\"codehilite\"><pre><span></span>2018-05-30 17:07:41,486 INFO runmanager: on_keyPress: F5\n2018-05-30 17:07:45,592 INFO runmanager: on_keyRelease: F5\n2018-05-30 17:07:45,594 INFO runmanager: Engage\n2018-05-30 17:07:45,595 INFO runmanager: Parsing globals...\n2018-05-30 17:07:45,607 INFO runmanager: Making h5 files\n2018-05-30 17:07:45,609 INFO runmanager: end engage\n</pre></div>\n\n\n<p>... but now results in (<a href=\"#!/labscript_suite/runmanager/commits/ba6441e\" rel=\"nofollow\" class=\"ap-connect-link\">ba6441e</a> and beyond):</p>\n<div class=\"codehilite\"><pre><span></span>2018-05-30 17:10:28,493 INFO runmanager: on_keyPress: F5\n2018-05-30 17:10:28,496 INFO runmanager: on_keyPress: F5\n2018-05-30 17:10:30,209 INFO runmanager: on_keyRelease: F5\n2018-05-30 17:10:30,210 INFO runmanager: Engage\n2018-05-30 17:10:30,210 INFO runmanager: Parsing globals...\n2018-05-30 17:10:30,415 INFO runmanager: Making h5 files\n2018-05-30 17:10:30,417 INFO runmanager: end engage\n2018-05-30 17:10:30,424 INFO runmanager: on_keyRelease: F5\n2018-05-30 17:10:30,424 INFO runmanager: Engage\n2018-05-30 17:10:30,424 INFO runmanager: Parsing globals...\n2018-05-30 17:10:30,430 INFO runmanager: Making h5 files\n2018-05-30 17:10:30,437 INFO runmanager: end engage\n</pre></div>\n\n\n<p>To properly intercept the <code>QtCore.QEvent.KeyPress</code> and not have it handled twice, <a data-is-external-link=\"true\" href=\"#!/labscript_suite/runmanager/src/b77c04761d98bce8e15f41f109d37145264bacb9/__main__.py?at=default&amp;fileviewer=file-view-default#__main__.py-161\" rel=\"nofollow\"><code>notify</code></a> of <code>KeyPressQApplication</code> should return 1 (or <code>True</code>) for relevant events <a data-is-external-link=\"true\" href=\"https://stackoverflow.com/a/45446380\" rel=\"nofollow\">SO</a>.</p>", "type": "rendered"}, "assignee": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2018-05-30T07:44:37.218882+00:00", "milestone": null, "updated_on": "2018-05-30T11:51:01.788014+00:00", "type": "issue", "id": 59}