{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/runmanager.json"}, "html": {"href": "#!/labscript_suite/runmanager"}, "avatar": {"href": "data/bytebucket.org/ravatar/{9b4f21e6-54b0-41ea-8f01-db1919f2f790}ts=249918"}}, "type": "repository", "name": "runmanager", "full_name": "labscript_suite/runmanager", "uuid": "{9b4f21e6-54b0-41ea-8f01-db1919f2f790}"}, "links": {"attachments": {"href": "data/repositories/labscript_suite/runmanager/issues/64/attachments_page=1.json"}, "self": {"href": "data/repositories/labscript_suite/runmanager/issues/64.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/runmanager/issues/64/watch"}, "comments": {"href": "data/repositories/labscript_suite/runmanager/issues/64/comments_page=1.json"}, "html": {"href": "#!/labscript_suite/runmanager/issues/64/zip-argument-error-in-expand_globals"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/labscript_suite/runmanager/issues/64/vote"}}, "reporter": {"display_name": "Lars Kohfahl", "uuid": "{14b59397-cbc0-4d8c-8a4a-fe99fb4d2d4a}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B14b59397-cbc0-4d8c-8a4a-fe99fb4d2d4a%7D"}, "html": {"href": "https://bitbucket.org/%7B14b59397-cbc0-4d8c-8a4a-fe99fb4d2d4a%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/630642264cd55e22515678a3a0489ac7d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsLK-2.png"}}, "nickname": "lkohfahl", "type": "user", "account_id": "5aafc5d11396802a57aa7f3b"}, "title": "zip argument error in expand_globals", "component": null, "votes": 0, "watches": 1, "content": {"raw": "We have encountered a bug when having two groups with conflicting globals. To reproduce the error seems a bit tricky. This is the way it should work: \r\nOur example is that we have two groups named \"testing\" and \"testing_2\" with the same named globals (e.g. \"pb_time\") in it. Runmanager detects this error correctly. But when changing the global in both groups to a list and activating them, at some point an error is thrown (maybe try several times):\r\n\r\nThis is the errorcode originally thrown in the main experiment\r\nStart code:\r\n2019-03-20 17:36:51,668 ERROR runmanager: Got an exception:\r\nTraceback (most recent call last):\r\n  File \"C:\\labscript_suite\\runmanager\\__main__.py\", line 2725, in preparse_globa\r\nls_loop\r\n    self.preparse_globals()\r\n  File \"C:\\labscript_suite\\runmanager\\__main__.py\", line 2706, in preparse_globa\r\nls\r\n    results = self.parse_globals(active_groups, raise_exceptions=False, expand_g\r\nlobals=True, return_dimensions = True)\r\n  File \"C:\\labscript_suite\\runmanager\\__main__.py\", line 3386, in parse_globals\r\n    shots, dimensions = runmanager.expand_globals(sequence_globals, evaled_globa\r\nls, expansion_order, return_dimensions=return_dimensions)\r\n  File \"C:\\labscript_suite\\runmanager\\__init__.py\", line 552, in expand_globals\r\n    axis = list(zip(*axis))\r\nTypeError: zip argument #1 must support iteration\r\n\r\nEnd Code\r\n\r\nThis is the error code thrown with a test setup (error is always coming up again!):\r\nStart Code:\r\nTraceback (most recent call last):\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\threading.py\", line 864, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\zprocess\\utils.py\", line 25, in _reraise\r\n    raise value.with_traceback(traceback)\r\n  File \"C:\\labscript_suite\\runmanager\\__main__.py\", line 2726, in preparse_globals_loop\r\n    self.preparse_globals()\r\n  File \"C:\\labscript_suite\\runmanager\\__main__.py\", line 2707, in preparse_globals\r\n    results = self.parse_globals(active_groups, raise_exceptions=False, expand_globals=True, return_dimensions = True)\r\n  File \"C:\\labscript_suite\\runmanager\\__main__.py\", line 3387, in parse_globals\r\n    shots, dimensions = runmanager.expand_globals(sequence_globals, evaled_globals, expansion_order, return_dimensions=return_dimensions)\r\n  File \"C:\\labscript_suite\\runmanager\\__init__.py\", line 552, in expand_globals\r\n    axis = list(zip(*axis))\r\nTypeError: zip argument #1 must support iteration\r\n\r\nEnd Code\r\n\r\nIt seems that after the error has been thrown once, it is thrown even if no conflict between the globals is present anymore.\r\n\r\nWe have had a look at the \"axis\"-element in expand_globals and it is always a list of one-element-lists: [[0],[1],[2]]\r\nLet me know if more information is needed.", "markup": "markdown", "html": "<p>We have encountered a bug when having two groups with conflicting globals. To reproduce the error seems a bit tricky. This is the way it should work: \nOur example is that we have two groups named \"testing\" and \"testing_2\" with the same named globals (e.g. \"pb_time\") in it. Runmanager detects this error correctly. But when changing the global in both groups to a list and activating them, at some point an error is thrown (maybe try several times):</p>\n<p>This is the errorcode originally thrown in the main experiment\nStart code:\n2019-03-20 17:36:51,668 ERROR runmanager: Got an exception:\nTraceback (most recent call last):\n  File \"C:\\labscript_suite\\runmanager__main<strong>.py\", line 2725, in preparse_globa\nls_loop\n    self.preparse_globals()\n  File \"C:\\labscript_suite\\runmanager__main</strong>.py\", line 2706, in preparse_globa\nls\n    results = self.parse_globals(active_groups, raise_exceptions=False, expand_g\nlobals=True, return_dimensions = True)\n  File \"C:\\labscript_suite\\runmanager__main<strong>.py\", line 3386, in parse_globals\n    shots, dimensions = runmanager.expand_globals(sequence_globals, evaled_globa\nls, expansion_order, return_dimensions=return_dimensions)\n  File \"C:\\labscript_suite\\runmanager__init</strong>.py\", line 552, in expand_globals\n    axis = list(zip(*axis))\nTypeError: zip argument <a href=\"#!/labscript_suite/runmanager/issues/1/load-configuration-does-not-default-to\" rel=\"nofollow\" title=\"&quot;Load configuration&quot; does not default to current day&#39;s output directory\" class=\"ap-connect-link\"><s>#1</s></a> must support iteration</p>\n<p>End Code</p>\n<p>This is the error code thrown with a test setup (error is always coming up again!):\nStart Code:\nTraceback (most recent call last):\n  File \"C:\\ProgramData\\Anaconda3\\lib\\threading.py\", line 864, in run\n    self._target(<em>self._args, </em><em>self._kwargs)\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\zprocess\\utils.py\", line 25, in _reraise\n    raise value.with_traceback(traceback)\n  File \"C:\\labscript_suite\\runmanager__main<strong>.py\", line 2726, in preparse_globals_loop\n    self.preparse_globals()\n  File \"C:\\labscript_suite\\runmanager__main</strong>.py\", line 2707, in preparse_globals\n    results = self.parse_globals(active_groups, raise_exceptions=False, expand_globals=True, return_dimensions = True)\n  File \"C:\\labscript_suite\\runmanager__main<strong>.py\", line 3387, in parse_globals\n    shots, dimensions = runmanager.expand_globals(sequence_globals, evaled_globals, expansion_order, return_dimensions=return_dimensions)\n  File \"C:\\labscript_suite\\runmanager__init</strong>.py\", line 552, in expand_globals\n    axis = list(zip(</em>axis))\nTypeError: zip argument <a href=\"#!/labscript_suite/runmanager/issues/1/load-configuration-does-not-default-to\" rel=\"nofollow\" title=\"&quot;Load configuration&quot; does not default to current day&#39;s output directory\" class=\"ap-connect-link\"><s>#1</s></a> must support iteration</p>\n<p>End Code</p>\n<p>It seems that after the error has been thrown once, it is thrown even if no conflict between the globals is present anymore.</p>\n<p>We have had a look at the \"axis\"-element in expand_globals and it is always a list of one-element-lists: [[0],[1],[2]]\nLet me know if more information is needed.</p>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2019-03-20T18:04:07.483092+00:00", "milestone": null, "updated_on": "2019-03-27T23:40:18.966285+00:00", "type": "issue", "id": 64}