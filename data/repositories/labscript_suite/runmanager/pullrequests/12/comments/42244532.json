{"links": {"self": {"href": "data/repositories/labscript_suite/runmanager/pullrequests/12/comments/42244532.json"}, "html": {"href": "#!/labscript_suite/runmanager/pull-requests/12/_/diff#comment-42244532"}}, "parent": {"id": 42244522, "links": {"self": {"href": "data/repositories/labscript_suite/runmanager/pullrequests/12/comments/42244522.json"}, "html": {"href": "#!/labscript_suite/runmanager/pull-requests/12/_/diff#comment-42244522"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 12, "links": {"self": {"href": "data/repositories/labscript_suite/runmanager/pullrequests/12.json"}, "html": {"href": "#!/labscript_suite/runmanager/pull-requests/12"}}, "title": "Arrow Key switching"}, "content": {"raw": "That's intentional - it's supposed to force you to type units! Here's the code that does it, if you're curious:\n\n\n```\n#!python\n\ndef complete_change_global_value(self, global_name, previous_value, new_value, item, previous_background, previous_icon):\n        try:\n            runmanager.set_value(self.globals_file, self.group_name, global_name, new_value)\n        except Exception as e:\n            error_dialog(str(e))\n            # Set the item text back to the old name, since the change failed:\n            with self.globals_model_item_changed_disconnected:\n                item.setText(previous_value)\n                item.setData(previous_value, self.GLOBALS_ROLE_PREVIOUS_TEXT)\n                item.setData(previous_value, self.GLOBALS_ROLE_SORT_DATA)\n                item.setData(previous_background, QtCore.Qt.BackgroundRole)\n                item.setIcon(previous_icon)\n        else:\n            self.check_for_boolean_values(item)\n            self.do_model_sort()\n            item.setToolTip('Evaluating...')\n            self.globals_changed()\n            units_item = self.get_global_item_by_name(global_name, self.GLOBALS_COL_UNITS)\n            units = units_item.text()\n            if not units:\n                # Go into editing the units item automatically:\n                units_item_index = units_item.index()\n                self.ui.treeView_globals.setCurrentIndex(units_item_index)\n                self.ui.treeView_globals.edit(units_item_index)\n            else:\n                # If this changed the sort order, ensure the item is still visible:\n                scroll_treeview_to_row_if_current(self.ui.treeView_globals, item)\n```\n\nWe usually type \"arbitrary\" or something if it's something with no units. But we wanted to avoid people getting into the habit of leaving it blank, which is otherwise an easy habit to get into if it doesn't automatically take you there.", "markup": "markdown", "html": "<p>That's intentional - it's supposed to force you to type units! Here's the code that does it, if you're curious:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">complete_change_global_value</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">global_name</span><span class=\"p\">,</span> <span class=\"n\">previous_value</span><span class=\"p\">,</span> <span class=\"n\">new_value</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">previous_background</span><span class=\"p\">,</span> <span class=\"n\">previous_icon</span><span class=\"p\">):</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">runmanager</span><span class=\"o\">.</span><span class=\"n\">set_value</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">globals_file</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">group_name</span><span class=\"p\">,</span> <span class=\"n\">global_name</span><span class=\"p\">,</span> <span class=\"n\">new_value</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"ne\">Exception</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n            <span class=\"n\">error_dialog</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">))</span>\n            <span class=\"c1\"># Set the item text back to the old name, since the change failed:</span>\n            <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">globals_model_item_changed_disconnected</span><span class=\"p\">:</span>\n                <span class=\"n\">item</span><span class=\"o\">.</span><span class=\"n\">setText</span><span class=\"p\">(</span><span class=\"n\">previous_value</span><span class=\"p\">)</span>\n                <span class=\"n\">item</span><span class=\"o\">.</span><span class=\"n\">setData</span><span class=\"p\">(</span><span class=\"n\">previous_value</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">GLOBALS_ROLE_PREVIOUS_TEXT</span><span class=\"p\">)</span>\n                <span class=\"n\">item</span><span class=\"o\">.</span><span class=\"n\">setData</span><span class=\"p\">(</span><span class=\"n\">previous_value</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">GLOBALS_ROLE_SORT_DATA</span><span class=\"p\">)</span>\n                <span class=\"n\">item</span><span class=\"o\">.</span><span class=\"n\">setData</span><span class=\"p\">(</span><span class=\"n\">previous_background</span><span class=\"p\">,</span> <span class=\"n\">QtCore</span><span class=\"o\">.</span><span class=\"n\">Qt</span><span class=\"o\">.</span><span class=\"n\">BackgroundRole</span><span class=\"p\">)</span>\n                <span class=\"n\">item</span><span class=\"o\">.</span><span class=\"n\">setIcon</span><span class=\"p\">(</span><span class=\"n\">previous_icon</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">check_for_boolean_values</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">do_model_sort</span><span class=\"p\">()</span>\n            <span class=\"n\">item</span><span class=\"o\">.</span><span class=\"n\">setToolTip</span><span class=\"p\">(</span><span class=\"s1\">&#39;Evaluating...&#39;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">globals_changed</span><span class=\"p\">()</span>\n            <span class=\"n\">units_item</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_global_item_by_name</span><span class=\"p\">(</span><span class=\"n\">global_name</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">GLOBALS_COL_UNITS</span><span class=\"p\">)</span>\n            <span class=\"n\">units</span> <span class=\"o\">=</span> <span class=\"n\">units_item</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"p\">()</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">units</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Go into editing the units item automatically:</span>\n                <span class=\"n\">units_item_index</span> <span class=\"o\">=</span> <span class=\"n\">units_item</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"p\">()</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">treeView_globals</span><span class=\"o\">.</span><span class=\"n\">setCurrentIndex</span><span class=\"p\">(</span><span class=\"n\">units_item_index</span><span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">treeView_globals</span><span class=\"o\">.</span><span class=\"n\">edit</span><span class=\"p\">(</span><span class=\"n\">units_item_index</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"c1\"># If this changed the sort order, ensure the item is still visible:</span>\n                <span class=\"n\">scroll_treeview_to_row_if_current</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">treeView_globals</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>We usually type \"arbitrary\" or something if it's something with no units. But we wanted to avoid people getting into the habit of leaving it blank, which is otherwise an easy habit to get into if it doesn't automatically take you there.</p>", "type": "rendered"}, "created_on": "2017-08-05T19:20:56.321029+00:00", "user": {"display_name": "Chris Billington", "uuid": "{e363c5a9-5075-4656-afb5-88bd6a6dceeb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D"}, "html": {"href": "https://bitbucket.org/%7Be363c5a9-5075-4656-afb5-88bd6a6dceeb%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/9238baf7300c41c0e7294db922899e6ad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCB-1.png"}}, "nickname": "cbillington", "type": "user", "account_id": "557058:cbf1bc43-1dc2-477b-9e25-1a8f40fd7ee3"}, "updated_on": "2017-08-05T19:20:56.324304+00:00", "type": "pullrequest_comment", "id": 42244532}