{"links": {"self": {"href": "data/repositories/labscript_suite/runmanager/pullrequests/30/comments/96565343.json"}, "html": {"href": "#!/labscript_suite/runmanager/pull-requests/30/_/diff#comment-96565343"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 30, "links": {"self": {"href": "data/repositories/labscript_suite/runmanager/pullrequests/30.json"}, "html": {"href": "#!/labscript_suite/runmanager/pull-requests/30"}}, "title": "Add the concept of a sequence_index to runmanager."}, "content": {"raw": "The behaviour of this feature is a little unpredictable/modal if one manually changes the shot output folder. Here\u2019s an example:\n\n* Relevant labconfig bits read:\n\n```\n[default]\nexperiment_shot_storage = %(shared_drive)s\\Experiments%(experiment_name)s\n\n[runmanager]\noutput_folder_format = %%Y/%%m/%%d/{sequence_index:05d}\nfilename_prefix_format = %%Y-%%m-%%d_{sequence_index:05d}_{script_basename}\n```\n\n* Start with a default output folder \\(pressing the \u2018Reset to default output folder\u2019 next to the \u2018Shot output folder\u2019 in runmanager\\). In my case this is C:\\\\Experiments\\\\example\\_experiment\\\\test\\\\2019\\\\03\\\\27\\\\00001.\n\n    * `.next_sequence_index` gets created in C:\\\\Experiments\\\\example\\_experiment\\\\test.\n    * After each sequence compilation, the sequence index increments and the shot output folder changes accordingly. So far so good.\n    \n* Now click on the \u2018Select folder\u2026' button next to the shot output folder path \\(or just manually change the path\\). I chose C:\\\\Experiments\\\\example\\_experiment\\\\test:\n\n    * Folders of the form `{sequence_index:05d}` are not created for new sequences. \n    * The filename prefix is still honoured; the sequence index increments after each sequence compilation;\n    * There is no longer an indication of what the sequence index is in the runmanager GUI.\n    * The \u2018Reset to default output folder\u2019 becomes active \\(no longer greyed out\\).\n    \n*  Change the shot output folder to C:\\\\Experiments\\\\example\\_experiment\\\\test\\\\2019\\\\03\\\\27. Same behaviour as above.\n* Manually create a sub-folder of this path with the next sequence index, and select it in runmanager, i.e. C:\\\\Experiments\\\\example\\_experiment\\\\test\\\\2019\\\\03\\\\27\\\\00006.\n\n    * The \u2018Reset to default output folder\u2019 becomes greyed out once more.\n    * The output folder automatically changes along with the sequence index after each sequence compilation. \n    \n\nI suppose all of this behaviour is by design, and the indicator of the modality is the state of the \u2018Reset to default output folder\u2019 button. My only feedback is that this is not very prominent; perhaps a message about the shot output folder not conforming to the format specified by labconfig would be useful. I was concerned that this feature might have compromised the utility of manually choosing the shot output folder \\(if there ever was any\\), but I\u2019m not after having learnt how it works from the above soak testing.", "markup": "markdown", "html": "<p>The behaviour of this feature is a little unpredictable/modal if one manually changes the shot output folder. Here\u2019s an example:</p>\n<ul>\n<li>Relevant labconfig bits read:</li>\n</ul>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">[default]</span>\n<span class=\"na\">experiment_shot_storage</span> <span class=\"o\">=</span> <span class=\"s\">%(shared_drive)s\\Experiments%(experiment_name)s</span>\n\n<span class=\"k\">[runmanager]</span>\n<span class=\"na\">output_folder_format</span> <span class=\"o\">=</span> <span class=\"s\">%%Y/%%m/%%d/{sequence_index:05d}</span>\n<span class=\"na\">filename_prefix_format</span> <span class=\"o\">=</span> <span class=\"s\">%%Y-%%m-%%d_{sequence_index:05d}_{script_basename}</span>\n</pre></div>\n\n\n<ul>\n<li>\n<p>Start with a default output folder (pressing the \u2018Reset to default output folder\u2019 next to the \u2018Shot output folder\u2019 in runmanager). In my case this is C:\\Experiments\\example_experiment\\test\\2019\\03\\27\\00001.</p>\n<ul>\n<li><code>.next_sequence_index</code> gets created in C:\\Experiments\\example_experiment\\test.</li>\n<li>After each sequence compilation, the sequence index increments and the shot output folder changes accordingly. So far so good.</li>\n</ul>\n</li>\n<li>\n<p>Now click on the \u2018Select folder\u2026' button next to the shot output folder path (or just manually change the path). I chose C:\\Experiments\\example_experiment\\test:</p>\n<ul>\n<li>Folders of the form <code>{sequence_index:05d}</code> are not created for new sequences. </li>\n<li>The filename prefix is still honoured; the sequence index increments after each sequence compilation;</li>\n<li>There is no longer an indication of what the sequence index is in the runmanager GUI.</li>\n<li>The \u2018Reset to default output folder\u2019 becomes active (no longer greyed out).</li>\n</ul>\n</li>\n<li>\n<p>Change the shot output folder to C:\\Experiments\\example_experiment\\test\\2019\\03\\27. Same behaviour as above.</p>\n</li>\n<li>\n<p>Manually create a sub-folder of this path with the next sequence index, and select it in runmanager, i.e. C:\\Experiments\\example_experiment\\test\\2019\\03\\27\\00006.</p>\n<ul>\n<li>The \u2018Reset to default output folder\u2019 becomes greyed out once more.</li>\n<li>The output folder automatically changes along with the sequence index after each sequence compilation. </li>\n</ul>\n</li>\n</ul>\n<p>I suppose all of this behaviour is by design, and the indicator of the modality is the state of the \u2018Reset to default output folder\u2019 button. My only feedback is that this is not very prominent; perhaps a message about the shot output folder not conforming to the format specified by labconfig would be useful. I was concerned that this feature might have compromised the utility of manually choosing the shot output folder (if there ever was any), but I\u2019m not after having learnt how it works from the above soak testing.</p>", "type": "rendered"}, "created_on": "2019-03-27T12:15:04.220491+00:00", "user": {"display_name": "Russell Anderson", "uuid": "{6c12ac6e-1980-466d-86fe-6c163bd116c2}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D"}, "html": {"href": "https://bitbucket.org/%7B6c12ac6e-1980-466d-86fe-6c163bd116c2%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e/e307ce36-5fb6-4418-8090-b9e533eab225/128"}}, "nickname": "rpanderson", "type": "user", "account_id": "557058:443e4cd1-86c9-4cd5-8034-22bab14d9d1e"}, "updated_on": "2019-03-27T12:15:04.233946+00:00", "type": "pullrequest_comment", "id": 96565343}