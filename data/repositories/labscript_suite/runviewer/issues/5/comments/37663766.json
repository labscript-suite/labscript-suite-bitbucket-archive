{"links": {"self": {"href": "data/repositories/labscript_suite/runviewer/issues/5/comments/37663766.json"}, "html": {"href": "#!/labscript_suite/runviewer/issues/5#comment-37663766"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/runviewer/issues/5.json"}}, "type": "issue", "id": 5, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/runviewer.json"}, "html": {"href": "#!/labscript_suite/runviewer"}, "avatar": {"href": "data/bytebucket.org/ravatar/{71215673-ad3e-425c-ae04-84cc6c2ca7da}ts=445022"}}, "type": "repository", "name": "runviewer", "full_name": "labscript_suite/runviewer", "uuid": "{71215673-ad3e-425c-ae04-84cc6c2ca7da}"}, "title": "Markers and nonlinear timescale"}, "content": {"raw": "The code needs a bit of cleaning up and a few changes which I'll be doing in the next few days before writing a pull request. \nIt is still possible to select multiple files and the variable self.selected_shot is not being use and assigned in a good way.\nA feature I also forgot to mention is that the Shutter Outputs display also have markers that display the actual open and close time.\n\nBut to get a feel for the changes  you can take a look at [my code](#!/PhyNerd/runviewer-1/src/65efb80f91569856af421dbfb9d3360da1ca0f9e/__main__.py?at=default&fileviewer=file-view-default) but as I said this is still work in progress\n\nAs for the changes to labscript.py\n\n```\n#!python\n\ndef add_marker(t, label, color=(0,0,0)):\n    #color in rgb\n    markers[t] = {\"label\":label, \"color\":color}\n\ndef save_markers(hdf5_file):\n    markers_dataset = hdf5_file['runviewer'].create_dataset('markers', shape=(1,))\n    for i in markers:\n        markers_dataset.attrs[str(i)] = str(markers[i])\n\ndef save_shutter_times(hdf5_file):\n    shutter_times_dataset = hdf5_file['runviewer'].create_dataset('shutter_times', shape=(1,))\n    for i in shutter_times:\n        shutter_times_dataset.attrs[str(i)] = str(shutter_times[i])\n```\n\nAddition to labscript_init()\n```\n#!python\n\n#markers and shutter times#\n    markers = {}\n    _builtins_dict[\"markers\"] = markers\n    shutter_times = {}\n    _builtins_dict[\"shutter_times\"] = shutter_times\n```\n\nAddition to Shutter.open()\n```\n#!python\n\n        # save the actual open time (when the shutter should be opened)\n        if self.name in shutter_times:\n            shutter_times[self.name][t] = 1\n        else:\n            shutter_times[self.name] = {t:1}\n```\n\nAddition to Shutter.close()\n```\n#!python\n\n        # save the actual close time (when the shutter should be closed)\n        if self.name in shutter_times:\n            shutter_times[self.name][t] = 0\n        else:\n            shutter_times[self.name] = {t:0}\n```\n\nGenerate Code:\n```\n#!python\n\n        save_markers(hdf5_file)\n        save_shutter_times(hdf5_file)\n```", "markup": "markdown", "html": "<p>The code needs a bit of cleaning up and a few changes which I'll be doing in the next few days before writing a pull request. \nIt is still possible to select multiple files and the variable self.selected_shot is not being use and assigned in a good way.\nA feature I also forgot to mention is that the Shutter Outputs display also have markers that display the actual open and close time.</p>\n<p>But to get a feel for the changes  you can take a look at <a data-is-external-link=\"true\" href=\"#!/PhyNerd/runviewer-1/src/65efb80f91569856af421dbfb9d3360da1ca0f9e/__main__.py?at=default&amp;fileviewer=file-view-default\" rel=\"nofollow\">my code</a> but as I said this is still work in progress</p>\n<p>As for the changes to labscript.py</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">add_marker</span><span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">)):</span>\n    <span class=\"c1\">#color in rgb</span>\n    <span class=\"n\">markers</span><span class=\"p\">[</span><span class=\"n\">t</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;label&quot;</span><span class=\"p\">:</span><span class=\"n\">label</span><span class=\"p\">,</span> <span class=\"s2\">&quot;color&quot;</span><span class=\"p\">:</span><span class=\"n\">color</span><span class=\"p\">}</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">save_markers</span><span class=\"p\">(</span><span class=\"n\">hdf5_file</span><span class=\"p\">):</span>\n    <span class=\"n\">markers_dataset</span> <span class=\"o\">=</span> <span class=\"n\">hdf5_file</span><span class=\"p\">[</span><span class=\"s1\">&#39;runviewer&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">create_dataset</span><span class=\"p\">(</span><span class=\"s1\">&#39;markers&#39;</span><span class=\"p\">,</span> <span class=\"n\">shape</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,))</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">markers</span><span class=\"p\">:</span>\n        <span class=\"n\">markers_dataset</span><span class=\"o\">.</span><span class=\"n\">attrs</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)]</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">markers</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">])</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">save_shutter_times</span><span class=\"p\">(</span><span class=\"n\">hdf5_file</span><span class=\"p\">):</span>\n    <span class=\"n\">shutter_times_dataset</span> <span class=\"o\">=</span> <span class=\"n\">hdf5_file</span><span class=\"p\">[</span><span class=\"s1\">&#39;runviewer&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">create_dataset</span><span class=\"p\">(</span><span class=\"s1\">&#39;shutter_times&#39;</span><span class=\"p\">,</span> <span class=\"n\">shape</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,))</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">shutter_times</span><span class=\"p\">:</span>\n        <span class=\"n\">shutter_times_dataset</span><span class=\"o\">.</span><span class=\"n\">attrs</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)]</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">shutter_times</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">])</span>\n</pre></div>\n\n\n<p>Addition to labscript_init()</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"c1\">#markers and shutter times#</span>\n    <span class=\"n\">markers</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"n\">_builtins_dict</span><span class=\"p\">[</span><span class=\"s2\">&quot;markers&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">markers</span>\n    <span class=\"n\">shutter_times</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"n\">_builtins_dict</span><span class=\"p\">[</span><span class=\"s2\">&quot;shutter_times&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">shutter_times</span>\n</pre></div>\n\n\n<p>Addition to Shutter.open()</p>\n<div class=\"codehilite language-python\"><pre><span></span>        <span class=\"c1\"># save the actual open time (when the shutter should be opened)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">shutter_times</span><span class=\"p\">:</span>\n            <span class=\"n\">shutter_times</span><span class=\"p\">[</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">][</span><span class=\"n\">t</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">shutter_times</span><span class=\"p\">[</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">t</span><span class=\"p\">:</span><span class=\"mi\">1</span><span class=\"p\">}</span>\n</pre></div>\n\n\n<p>Addition to Shutter.close()</p>\n<div class=\"codehilite language-python\"><pre><span></span>        <span class=\"c1\"># save the actual close time (when the shutter should be closed)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">shutter_times</span><span class=\"p\">:</span>\n            <span class=\"n\">shutter_times</span><span class=\"p\">[</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">][</span><span class=\"n\">t</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">shutter_times</span><span class=\"p\">[</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">t</span><span class=\"p\">:</span><span class=\"mi\">0</span><span class=\"p\">}</span>\n</pre></div>\n\n\n<p>Generate Code:</p>\n<div class=\"codehilite language-python\"><pre><span></span>        <span class=\"n\">save_markers</span><span class=\"p\">(</span><span class=\"n\">hdf5_file</span><span class=\"p\">)</span>\n        <span class=\"n\">save_shutter_times</span><span class=\"p\">(</span><span class=\"n\">hdf5_file</span><span class=\"p\">)</span>\n</pre></div>", "type": "rendered"}, "created_on": "2017-06-17T21:22:43.938416+00:00", "user": {"display_name": "Jan Werkmann", "uuid": "{44c4905c-2b90-4045-a5f1-652b8e228626}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D"}, "html": {"href": "https://bitbucket.org/%7B44c4905c-2b90-4045-a5f1-652b8e228626%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5/07e5095a-4741-4dc0-a462-9c7d455f961d/128"}}, "nickname": "PhyNerd", "type": "user", "account_id": "557058:a70cc9cf-684e-4849-a61a-9ade4d7218b5"}, "updated_on": null, "type": "issue_comment", "id": 37663766}