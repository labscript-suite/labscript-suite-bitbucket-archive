{"links": {"self": {"href": "data/repositories/labscript_suite/runviewer/issues/7/comments/37701546.json"}, "html": {"href": "#!/labscript_suite/runviewer/issues/7#comment-37701546"}}, "issue": {"links": {"self": {"href": "data/repositories/labscript_suite/runviewer/issues/7.json"}}, "type": "issue", "id": 7, "repository": {"links": {"self": {"href": "data/repositories/labscript_suite/runviewer.json"}, "html": {"href": "#!/labscript_suite/runviewer"}, "avatar": {"href": "data/bytebucket.org/ravatar/{71215673-ad3e-425c-ae04-84cc6c2ca7da}ts=445022"}}, "type": "repository", "name": "runviewer", "full_name": "labscript_suite/runviewer", "uuid": "{71215673-ad3e-425c-ae04-84cc6c2ca7da}"}, "title": "Error when ticking/unticking multiple shots"}, "content": {"raw": "Ok, It must be to do with the slightly different PyQt versions we have. I'm on 4.11.1, which really shouldn't be having so much trouble with doing `QColor(None)`. Apparently that doesn't work anymore!\n\nI'm going to suggest we don't 'uncolour' a shot when we untick it. That way it will keep it's the same colour when you retick it. \n\nProposed patch for the `on_shot_selection_changed` method:\n\n```\n#!python\n\n        if self.shot_model.indexFromItem(item).column() == SHOT_MODEL__CHECKBOX_INDEX:\n\n            # add or remove a colour for this shot\n            checked = item.checkState()\n            row = self.shot_model.indexFromItem(item).row()\n            colour_item = self.shot_model.item(row, SHOT_MODEL__COLOUR_INDEX)\n\n            if checked:            \n                colour = colour_item.data(Qt.UserRole)\n                if qt_type == 'PyQt4':\n                    colour = colour.toPyObject()\n                    \n                if colour is not None:\n                    colour = colour()\n                else:                    \n                    colour = self.shot_colour_delegate.get_next_colour()\n                    \n                colour_item.setEditable(True)\n                pixmap = QPixmap(20, 20)\n                pixmap.fill(colour)\n                icon = QIcon(pixmap)\n                colour_item.setData(lambda clist=self.shot_colour_delegate._colours, colour=colour: int_to_enum(clist, colour), Qt.UserRole)\n                colour_item.setData(icon, Qt.DecorationRole)\n            else:\n                # colour = None\n                # icon = None\n                colour_item.setEditable(False)\n\n            # model.setData(index, editor.itemIcon(editor.currentIndex()),\n            # model.setData(index, editor.itemData(editor.currentIndex()), Qt.UserRole)\n\n            self.update_channels_treeview()\n        elif.....\n```", "markup": "markdown", "html": "<p>Ok, It must be to do with the slightly different PyQt versions we have. I'm on 4.11.1, which really shouldn't be having so much trouble with doing <code>QColor(None)</code>. Apparently that doesn't work anymore!</p>\n<p>I'm going to suggest we don't 'uncolour' a shot when we untick it. That way it will keep it's the same colour when you retick it. </p>\n<p>Proposed patch for the <code>on_shot_selection_changed</code> method:</p>\n<div class=\"codehilite language-python\"><pre><span></span>        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shot_model</span><span class=\"o\">.</span><span class=\"n\">indexFromItem</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">column</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"n\">SHOT_MODEL__CHECKBOX_INDEX</span><span class=\"p\">:</span>\n\n            <span class=\"c1\"># add or remove a colour for this shot</span>\n            <span class=\"n\">checked</span> <span class=\"o\">=</span> <span class=\"n\">item</span><span class=\"o\">.</span><span class=\"n\">checkState</span><span class=\"p\">()</span>\n            <span class=\"n\">row</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shot_model</span><span class=\"o\">.</span><span class=\"n\">indexFromItem</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">row</span><span class=\"p\">()</span>\n            <span class=\"n\">colour_item</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shot_model</span><span class=\"o\">.</span><span class=\"n\">item</span><span class=\"p\">(</span><span class=\"n\">row</span><span class=\"p\">,</span> <span class=\"n\">SHOT_MODEL__COLOUR_INDEX</span><span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">checked</span><span class=\"p\">:</span>            \n                <span class=\"n\">colour</span> <span class=\"o\">=</span> <span class=\"n\">colour_item</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">(</span><span class=\"n\">Qt</span><span class=\"o\">.</span><span class=\"n\">UserRole</span><span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"n\">qt_type</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;PyQt4&#39;</span><span class=\"p\">:</span>\n                    <span class=\"n\">colour</span> <span class=\"o\">=</span> <span class=\"n\">colour</span><span class=\"o\">.</span><span class=\"n\">toPyObject</span><span class=\"p\">()</span>\n\n                <span class=\"k\">if</span> <span class=\"n\">colour</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n                    <span class=\"n\">colour</span> <span class=\"o\">=</span> <span class=\"n\">colour</span><span class=\"p\">()</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>                    \n                    <span class=\"n\">colour</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shot_colour_delegate</span><span class=\"o\">.</span><span class=\"n\">get_next_colour</span><span class=\"p\">()</span>\n\n                <span class=\"n\">colour_item</span><span class=\"o\">.</span><span class=\"n\">setEditable</span><span class=\"p\">(</span><span class=\"bp\">True</span><span class=\"p\">)</span>\n                <span class=\"n\">pixmap</span> <span class=\"o\">=</span> <span class=\"n\">QPixmap</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">)</span>\n                <span class=\"n\">pixmap</span><span class=\"o\">.</span><span class=\"n\">fill</span><span class=\"p\">(</span><span class=\"n\">colour</span><span class=\"p\">)</span>\n                <span class=\"n\">icon</span> <span class=\"o\">=</span> <span class=\"n\">QIcon</span><span class=\"p\">(</span><span class=\"n\">pixmap</span><span class=\"p\">)</span>\n                <span class=\"n\">colour_item</span><span class=\"o\">.</span><span class=\"n\">setData</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">clist</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shot_colour_delegate</span><span class=\"o\">.</span><span class=\"n\">_colours</span><span class=\"p\">,</span> <span class=\"n\">colour</span><span class=\"o\">=</span><span class=\"n\">colour</span><span class=\"p\">:</span> <span class=\"n\">int_to_enum</span><span class=\"p\">(</span><span class=\"n\">clist</span><span class=\"p\">,</span> <span class=\"n\">colour</span><span class=\"p\">),</span> <span class=\"n\">Qt</span><span class=\"o\">.</span><span class=\"n\">UserRole</span><span class=\"p\">)</span>\n                <span class=\"n\">colour_item</span><span class=\"o\">.</span><span class=\"n\">setData</span><span class=\"p\">(</span><span class=\"n\">icon</span><span class=\"p\">,</span> <span class=\"n\">Qt</span><span class=\"o\">.</span><span class=\"n\">DecorationRole</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"c1\"># colour = None</span>\n                <span class=\"c1\"># icon = None</span>\n                <span class=\"n\">colour_item</span><span class=\"o\">.</span><span class=\"n\">setEditable</span><span class=\"p\">(</span><span class=\"bp\">False</span><span class=\"p\">)</span>\n\n            <span class=\"c1\"># model.setData(index, editor.itemIcon(editor.currentIndex()),</span>\n            <span class=\"c1\"># model.setData(index, editor.itemData(editor.currentIndex()), Qt.UserRole)</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">update_channels_treeview</span><span class=\"p\">()</span>\n        <span class=\"k\">elif</span><span class=\"o\">.....</span>\n</pre></div>", "type": "rendered"}, "created_on": "2017-06-20T00:55:38.529100+00:00", "user": {"display_name": "Philip Starkey", "uuid": "{48af65db-e5fc-459c-a7eb-52eb1f9a5690}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D"}, "html": {"href": "https://bitbucket.org/%7B48af65db-e5fc-459c-a7eb-52eb1f9a5690%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dc318537facc47ebe1ae98a7aabacecfd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsPS-0.png"}}, "nickname": "pstarkey", "type": "user", "account_id": "557058:52a111e4-40da-4441-9143-417f95f2db97"}, "updated_on": null, "type": "issue_comment", "id": 37701546}